!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){var e,t;e=void 0,t=function(){var _="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function e(e,t){return e(t={exports:{}},t.exports),t.exports}function t(e){return e&&e.Math==Math&&e}function m(e){try{return!!e()}catch(e){return!0}}function A(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function o(e){return s.call(e).slice(8,-1)}function p(e){if(null==e)throw TypeError("Can't call method on "+e);return e}function u(e){return w(p(e))}function O(e){return"object"==typeof e?null!==e:"function"==typeof e}function f(e,t){if(!O(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!O(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!O(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!O(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}function l(e,t){return y.call(e,t)}function n(e){return v?g.createElement(e):{}}function b(e){if(!O(e))throw TypeError(String(e)+" is not an object");return e}function h(t,r){try{M(B,t,r)}catch(e){B[t]=r}return r}var B=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof _&&_)||Function("return this")(),I=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),r={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,d={f:a&&!r.call({1:2},1)?function(e){var t=a(this,e);return!!t&&t.enumerable}:r},s={}.toString,c="".split,w=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==o(e)?c.call(e,""):Object(e)}:Object,y={}.hasOwnProperty,g=B.document,v=O(g)&&O(g.createElement),k=!I&&!m(function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}),x=Object.getOwnPropertyDescriptor,N={f:I?x:function(e,t){if(e=u(e),t=f(t,!0),k)try{return x(e,t)}catch(e){}if(l(e,t))return A(!d.f.call(e,t),e[t])}},S=Object.defineProperty,D={f:I?S:function(e,t,r){if(b(e),t=f(t,!0),b(r),k)try{return S(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},M=I?function(e,t,r){return D.f(e,t,A(1,r))}:function(e,t,r){return e[t]=r,e},C="__core-js_shared__",T=B[C]||h(C,{}),E=Function.toString;"function"!=typeof T.inspectSource&&(T.inspectSource=function(e){return E.call(e)});function P(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++W+V).toString(36)}function R(e){return G[e]||(G[e]=P(e))}var j,q,F,L=T.inspectSource,U=B.WeakMap,z="function"==typeof U&&/native code/.test(L(U)),H=e(function(e){(e.exports=function(e,t){return T[e]||(T[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.1",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),W=0,V=Math.random(),G=H("keys"),J={},Y=B.WeakMap;if(z){var X=new Y,K=X.get,$=X.has,Q=X.set;j=function(e,t){return Q.call(X,e,t),t},q=function(e){return K.call(X,e)||{}},F=function(e){return $.call(X,e)}}else{var Z=R("state");J[Z]=!0,j=function(e,t){return M(e,Z,t),t},q=function(e){return l(e,Z)?e[Z]:{}},F=function(e){return l(e,Z)}}function ee(e){return"function"==typeof e?e:void 0}function te(e,t){return arguments.length<2?ee(ve[e])||ee(B[e]):ve[e]&&ve[e][t]||B[e]&&B[e][t]}function re(e){return isNaN(e=+e)?0:(0<e?be:_e)(e)}function ne(e){return 0<e?we(re(e),9007199254740991):0}function oe(e,t){var r=re(e);return r<0?ke(r+t,0):xe(r,t)}function ie(s){return function(e,t,r){var n,o=u(e),i=ne(o.length),a=oe(r,i);if(s&&t!=t){for(;a<i;)if((n=o[a++])!=n)return!0}else for(;a<i;a++)if((s||a in o)&&o[a]===t)return s||a||0;return!s&&-1}}function ae(e,t){var r,n=u(e),o=0,i=[];for(r in n)!l(J,r)&&l(n,r)&&i.push(r);for(;t.length>o;)l(n,r=t[o++])&&(~Ce(i,r)||i.push(r));return i}function se(e,t){for(var r=Ae(t),n=D.f,o=N.f,i=0;i<r.length;i++){var a=r[i];l(e,a)||n(e,a,o(t,a))}}function ce(e,t){var r=Ie[Be(e)];return r==De||r!=Ne&&("function"==typeof t?m(t):!!t)}function ue(e,t){var r,n,o,i,a,s=e.target,c=e.global,u=e.stat;if(r=c?B:u?B[s]||h(s,{}):(B[s]||{}).prototype)for(n in t){if(i=t[n],o=e.noTargetGet?(a=je(r,n))&&a.value:r[n],!Me(c?n:s+(u?".":"#")+n,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;se(i,o)}(e.sham||o&&o.sham)&&M(i,"sham",!0),ge(r,n,i,e)}}function fe(e){return Object(p(e))}function pe(e){return l(Ue,e)||(Fe&&l(ze,e)?Ue[e]=ze[e]:Ue[e]=He("Symbol."+e)),Ue[e]}function le(e,t){var r;return qe(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!qe(r.prototype)?O(r)&&null===(r=r[We])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}function he(e,t,r){var n=f(t);n in e?D.f(e,n,A(0,r)):e[n]=r}var de,ye,me={set:j,get:q,has:F,enforce:function(e){return F(e)?q(e):j(e,{})},getterFor:function(r){return function(e){var t;if(!O(e)||(t=q(e)).type!==r)throw TypeError("Incompatible receiver, "+r+" required");return t}}},ge=e(function(e){var t=me.get,s=me.enforce,c=String(String).split("String");(e.exports=function(e,t,r,n){var o=!!n&&!!n.unsafe,i=!!n&&!!n.enumerable,a=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof t||l(r,"name")||M(r,"name",t),s(r).source=c.join("string"==typeof t?t:"")),e!==B?(o?!a&&e[t]&&(i=!0):delete e[t],i?e[t]=r:M(e,t,r)):i?e[t]=r:h(t,r)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||L(this)})}),ve=B,_e=Math.ceil,be=Math.floor,we=Math.min,ke=Math.max,xe=Math.min,Se={includes:ie(!0),indexOf:ie(!1)},Ce=Se.indexOf,Te=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ee=Te.concat("length","prototype"),Pe={f:Object.getOwnPropertyNames||function(e){return ae(e,Ee)}},Re={f:Object.getOwnPropertySymbols},Ae=te("Reflect","ownKeys")||function(e){var t=Pe.f(b(e)),r=Re.f;return r?t.concat(r(e)):t},Oe=/#|\.prototype\./,Be=ce.normalize=function(e){return String(e).replace(Oe,".").toLowerCase()},Ie=ce.data={},Ne=ce.NATIVE="N",De=ce.POLYFILL="P",Me=ce,je=N.f,qe=Array.isArray||function(e){return"Array"==o(e)},Fe=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),Le=Fe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ue=H("wks"),ze=B.Symbol,He=Le?ze:ze&&ze.withoutSetter||P,We=pe("species"),Ve=te("navigator","userAgent")||"",Ge=B.process,Je=Ge&&Ge.versions,Ye=Je&&Je.v8;Ye?ye=(de=Ye.split("."))[0]+de[1]:Ve&&(!(de=Ve.match(/Edge\/(\d+)/))||74<=de[1])&&(de=Ve.match(/Chrome\/(\d+)/))&&(ye=de[1]);function Xe(t){return 51<=Ke||!m(function(){var e=[];return(e.constructor={})[$e]=function(){return{foo:1}},1!==e[t](Boolean).foo})}var Ke=ye&&+ye,$e=pe("species"),Qe=Math.max,Ze=Math.min;ue({target:"Array",proto:!0,forced:!Xe("splice")},{splice:function(e,t){var r,n,o,i,a,s,c=fe(this),u=ne(c.length),f=oe(e,u),p=arguments.length;if(0===p?r=n=0:n=1===p?(r=0,u-f):(r=p-2,Ze(Qe(re(t),0),u-f)),9007199254740991<u+r-n)throw TypeError("Maximum allowed length exceeded");for(o=le(c,n),i=0;i<n;i++)(a=f+i)in c&&he(o,i,c[a]);if(r<(o.length=n)){for(i=f;i<u-n;i++)s=i+r,(a=i+n)in c?c[s]=c[a]:delete c[s];for(i=u;u-n+r<i;i--)delete c[i-1]}else if(n<r)for(i=u-n;f<i;i--)s=i+r-1,(a=i+n-1)in c?c[s]=c[a]:delete c[s];for(i=0;i<r;i++)c[i+f]=arguments[i+2];return c.length=u-n+r,o}});e(function(e){var t=function(i){var c,e=Object.prototype,u=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function a(e,t,r,n){var i,a,s,c,o=t&&t.prototype instanceof g?t:g,u=Object.create(o.prototype),f=new E(n||[]);return u._invoke=(i=e,a=r,s=f,c=l,function(e,t){if(c===d)throw new Error("Generator is already running");if(c===y){if("throw"===e)throw t;return R()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var n=S(r,s);if(n){if(n===m)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(c===l)throw c=y,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);c=d;var o=p(i,a,s);if("normal"===o.type){if(c=s.done?y:h,o.arg===m)continue;return{value:o.arg,done:s.done}}"throw"===o.type&&(c=y,s.method="throw",s.arg=o.arg)}}),u}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}i.wrap=a;var l="suspendedStart",h="suspendedYield",d="executing",y="completed",m={};function g(){}function s(){}function f(){}var v={};v[o]=function(){return this};var _=Object.getPrototypeOf,b=_&&_(_(P([])));b&&b!==e&&u.call(b,o)&&(v=b);var w=f.prototype=g.prototype=Object.create(v);function k(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function x(c){var t;this._invoke=function(r,n){function e(){return new Promise(function(e,t){!function t(e,r,n,o){var i=p(c[e],c,r);if("throw"!==i.type){var a=i.arg,s=a.value;return s&&"object"==typeof s&&u.call(s,"__await")?Promise.resolve(s.__await).then(function(e){t("next",e,n,o)},function(e){t("throw",e,n,o)}):Promise.resolve(s).then(function(e){a.value=e,n(a)},function(e){return t("throw",e,n,o)})}o(i.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}}function S(e,t){var r=e.iterator[t.method];if(r===c){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=c,S(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=p(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=c),t.delegate=null,m):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){function r(){for(;++n<e.length;)if(u.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=c,r.done=!0,r}var n=-1;return r.next=r}}return{next:R}}function R(){return{value:c,done:!0}}return s.prototype=w.constructor=f,f.constructor=s,f[n]=s.displayName="GeneratorFunction",i.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===s||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,n in e||(e[n]="GeneratorFunction")),e.prototype=Object.create(w),e},i.awrap=function(e){return{__await:e}},k(x.prototype),x.prototype[r]=function(){return this},i.AsyncIterator=x,i.async=function(e,t,r,n){var o=new x(a(e,t,r,n));return i.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},k(w),w[n]="Generator",w[o]=function(){return this},w.toString=function(){return"[object Generator]"},i.keys=function(r){var n=[];for(var e in r)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},i.values=P,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=c)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=c),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),s=u.call(o,"finallyLoc");if(a&&s){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=c),m}},i}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}});function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function rt(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function o(e){tt(n,t,r,o,i,"next",e)}function i(e){tt(n,t,r,o,i,"throw",e)}o(void 0)})}}function nt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ot(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function it(e,t,r){return t&&ot(e.prototype,t),r&&ot(e,r),e}function at(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ct(e,t)}function st(e){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ct(e,t){return(ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ut(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ft(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function pt(){}function lt(e){return"<script>"+e+"</"+vt+">"}var ht,dt=Object.keys||function(e){return ae(e,Te)},yt=I?Object.defineProperties:function(e,t){b(e);for(var r,n=dt(t),o=n.length,i=0;i<o;)D.f(e,r=n[i++],t[r]);return e},mt=te("document","documentElement"),gt="prototype",vt="script",_t=R("IE_PROTO"),bt=function(){try{ht=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;bt=ht?function(e){e.write(lt("")),e.close();var t=e.parentWindow.Object;return e=null,t}(ht):((t=n("iframe")).style.display="none",mt.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(lt("document.F=Object")),e.close(),e.F);for(var r=Te.length;r--;)delete bt[gt][Te[r]];return bt()};J[_t]=!0;var wt=Object.create||function(e,t){var r;return null!==e?(pt[gt]=b(e),r=new pt,pt[gt]=null,r[_t]=e):r=bt(),void 0===t?r:yt(r,t)},kt=pe("unscopables"),xt=Array.prototype;null==xt[kt]&&D.f(xt,kt,{configurable:!0,value:wt(null)});function St(e){xt[kt][e]=!0}var Ct,Tt,Et,Pt={},Rt=!m(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),At=R("IE_PROTO"),Ot=Object.prototype,Bt=Rt?Object.getPrototypeOf:function(e){return e=fe(e),l(e,At)?e[At]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Ot:null},It=pe("iterator"),Nt=!1;[].keys&&("next"in(Et=[].keys())?(Tt=Bt(Bt(Et)))!==Object.prototype&&(Ct=Tt):Nt=!0),null==Ct&&(Ct={}),l(Ct,It)||M(Ct,It,function(){return this});function Dt(e,t,r){e&&!l(e=r?e:e.prototype,Ut)&&Lt(e,Ut,{configurable:!0,value:t})}function Mt(){return this}function jt(){return this}function qt(e,t,r,n,o,i,a){var s,c,u;function f(e){if(e===o&&v)return v;if(!Vt&&e in m)return m[e];switch(e){case"keys":case Jt:case Yt:return function(){return new r(this,e)}}return function(){return new r(this)}}c=n,u=t+" Iterator",(s=r).prototype=wt(zt,{next:A(1,c)}),Dt(s,u,!1),Pt[u]=Mt;var p,l,h,d=t+" Iterator",y=!1,m=e.prototype,g=m[Gt]||m["@@iterator"]||o&&m[o],v=!Vt&&g||f(o),_="Array"==t&&m.entries||g;if(_&&(p=Bt(_.call(new e)),Wt!==Object.prototype&&p.next&&(Bt(p)!==Wt&&(Ht?Ht(p,Wt):"function"!=typeof p[Gt]&&M(p,Gt,jt)),Dt(p,d,!0))),o==Jt&&g&&g.name!==Jt&&(y=!0,v=function(){return g.call(this)}),m[Gt]!==v&&M(m,Gt,v),Pt[t]=v,o)if(l={values:f(Jt),keys:i?v:f("keys"),entries:f(Yt)},a)for(h in l)!Vt&&!y&&h in m||ge(m,h,l[h]);else ue({target:t,proto:!0,forced:Vt||y},l);return l}var Ft={IteratorPrototype:Ct,BUGGY_SAFARI_ITERATORS:Nt},Lt=D.f,Ut=pe("toStringTag"),zt=Ft.IteratorPrototype,Ht=Object.setPrototypeOf||("__proto__"in{}?function(){var r,n=!1,e={};try{(r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),n=e instanceof Array}catch(e){}return function(e,t){return b(e),function(e){if(!O(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(t),n?r.call(e,t):e.__proto__=t,e}}():void 0),Wt=Ft.IteratorPrototype,Vt=Ft.BUGGY_SAFARI_ITERATORS,Gt=pe("iterator"),Jt="values",Yt="entries",Xt="Array Iterator",Kt=me.set,$t=me.getterFor(Xt),Qt=qt(Array,"Array",function(e,t){Kt(this,{type:Xt,target:u(e),index:0,kind:t})},function(){var e=$t(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?{value:e.target=void 0,done:!0}:"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}},"values");Pt.Arguments=Pt.Array,St("keys"),St("values"),St("entries");function Zt(e){return void 0!==e&&(Pt.Array===e||ir[or]===e)}function er(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}function tr(n,o,e){if(er(n),void 0===o)return n;switch(e){case 0:return function(){return n.call(o)};case 1:return function(e){return n.call(o,e)};case 2:return function(e,t){return n.call(o,e,t)};case 3:return function(e,t,r){return n.call(o,e,t,r)}}return function(){return n.apply(o,arguments)}}var rr=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),nr=e(function(e){function r(e){t(e,n,{value:{objectID:"O"+ ++o,weakData:{}}})}var t=D.f,n=P("meta"),o=0,i=Object.isExtensible||function(){return!0},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!O(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!l(e,n)){if(!i(e))return"F";if(!t)return"E";r(e)}return e[n].objectID},getWeakData:function(e,t){if(!l(e,n)){if(!i(e))return!0;if(!t)return!1;r(e)}return e[n].weakData},onFreeze:function(e){return rr&&a.REQUIRED&&i(e)&&!l(e,n)&&r(e),e}};J[n]=!0}),or=(nr.REQUIRED,nr.fastKey,nr.getWeakData,nr.onFreeze,pe("iterator")),ir=Array.prototype,ar={};ar[pe("toStringTag")]="z";function sr(e){if(null!=e)return e[dr]||e["@@iterator"]||Pt[hr(e)]}function cr(t,e,r,n){try{return n?e(b(r)[0],r[1]):e(r)}catch(e){var o=t.return;throw void 0!==o&&b(o.call(t)),e}}function ur(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}var fr="[object z]"===String(ar),pr=pe("toStringTag"),lr="Arguments"==o(function(){return arguments}()),hr=fr?o:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),pr))?r:lr?o(t):"Object"==(n=o(t))&&"function"==typeof t.callee?"Arguments":n},dr=pe("iterator"),yr=e(function(e){function h(e,t){this.stopped=e,this.result=t}(e.exports=function(e,t,r,n,o){var i,a,s,c,u,f,p,l=tr(t,r,n?2:1);if(o)i=e;else{if("function"!=typeof(a=sr(e)))throw TypeError("Target is not iterable");if(Zt(a)){for(s=0,c=ne(e.length);s<c;s++)if((u=n?l(b(p=e[s])[0],p[1]):l(e[s]))&&u instanceof h)return u;return new h(!1)}i=a.call(e)}for(f=i.next;!(p=f.call(i)).done;)if("object"==typeof(u=cr(i,l,p.value,n))&&u&&u instanceof h)return u;return new h(!1)}).stop=function(e){return new h(!0,e)}}),mr=pe("iterator"),gr=!1;try{var vr=0,_r={next:function(){return{done:!!vr++}},return:function(){gr=!0}};_r[mr]=function(){return this},Array.from(_r,function(){throw 2})}catch(e){}function br(e,t){if(!t&&!gr)return!1;var r=!1;try{var n={};n[mr]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r}function wr(e,t,r){var n,o;return Ht&&"function"==typeof(n=t.constructor)&&n!==r&&O(o=n.prototype)&&o!==r.prototype&&Ht(e,o),e}function kr(n,e,t){function r(e){var r=c[e];ge(c,e,"add"==e?function(e){return r.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!O(e))&&r.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!O(e)?void 0:r.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!O(e))&&r.call(this,0===e?0:e)}:function(e,t){return r.call(this,0===e?0:e,t),this})}var o=-1!==n.indexOf("Map"),i=-1!==n.indexOf("Weak"),a=o?"set":"add",s=B[n],c=s&&s.prototype,u=s,f={};if(Me(n,"function"!=typeof s||!(i||c.forEach&&!m(function(){(new s).entries().next()}))))u=t.getConstructor(e,n,o,a),nr.REQUIRED=!0;else if(Me(n,!0)){var p=new u,l=p[a](i?{}:-0,1)!=p,h=m(function(){p.has(1)}),d=br(function(e){new s(e)}),y=!i&&m(function(){for(var e=new s,t=5;t--;)e[a](t,t);return!e.has(-0)});d||(((u=e(function(e,t){ur(e,u,n);var r=wr(new s,e,u);return null!=t&&yr(t,r[a],r,o),r})).prototype=c).constructor=u),(h||y)&&(r("delete"),r("has"),o&&r("get")),(y||l)&&r(a),i&&c.clear&&delete c.clear}return f[n]=u,ue({global:!0,forced:u!=s},f),Dt(u,n),i||t.setStrong(u,n,o),u}function xr(e,t,r){for(var n in t)ge(e,n,t[n],r);return e}function Sr(e){var t=te(e),r=D.f;I&&t&&!t[Cr]&&r(t,Cr,{configurable:!0,get:function(){return this}})}var Cr=pe("species"),Tr=D.f,Er=nr.fastKey,Pr=me.set,Rr=me.getterFor,Ar={getConstructor:function(e,r,n,o){function i(e,t,r){var n,o,i=s(e),a=c(e,t);return a?a.value=r:(i.last=a={index:o=Er(t,!0),key:t,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=a),n&&(n.next=a),I?i.size++:e.size++,"F"!==o&&(i.index[o]=a)),e}var a=e(function(e,t){ur(e,a,r),Pr(e,{type:r,index:wt(null),first:void 0,last:void 0,size:0}),I||(e.size=0),null!=t&&yr(t,e[o],e,n)}),s=Rr(r),c=function(e,t){var r,n=s(e),o=Er(t);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==t)return r};return xr(a.prototype,{clear:function(){for(var e=s(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,I?e.size=0:this.size=0},delete:function(e){var t=s(this),r=c(this,e);if(r){var n=r.next,o=r.previous;delete t.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),t.first==r&&(t.first=n),t.last==r&&(t.last=o),I?t.size--:this.size--}return!!r},forEach:function(e,t){for(var r,n=s(this),o=tr(e,1<arguments.length?t:void 0,3);r=r?r.next:n.first;)for(o(r.value,r.key,this);r&&r.removed;)r=r.previous},has:function(e){return!!c(this,e)}}),xr(a.prototype,n?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return i(this,0===e?0:e,t)}}:{add:function(e){return i(this,e=0===e?0:e,e)}}),I&&Tr(a.prototype,"size",{get:function(){return s(this).size}}),a},setStrong:function(e,t,r){var n=t+" Iterator",o=Rr(t),i=Rr(n);qt(e,t,function(e,t){Pr(this,{type:n,target:e,state:o(e),kind:t,last:void 0})},function(){for(var e=i(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:{value:e.target=void 0,done:!0}},r?"entries":"values",!r,!0),Sr(t)}},Or=(kr("Map",function(t){return function(e){return t(this,arguments.length?e:void 0)}},Ar),fr?{}.toString:function(){return"[object "+hr(this)+"]"});fr||ge(Object.prototype,"toString",Or,{unsafe:!0});function Br(e,t){return RegExp(e,t)}var Ir,Nr,Dr={UNSUPPORTED_Y:m(function(){var e=Br("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),BROKEN_CARET:m(function(){var e=Br("^r","gy");return e.lastIndex=2,null!=e.exec("str")})},Mr=RegExp.prototype.exec,jr=String.prototype.replace,qr=Mr,Fr=(Ir=/a/,Nr=/b*/g,Mr.call(Ir,"a"),Mr.call(Nr,"a"),0!==Ir.lastIndex||0!==Nr.lastIndex),Lr=Dr.UNSUPPORTED_Y||Dr.BROKEN_CARET,Ur=void 0!==/()??/.exec("")[1];(Fr||Ur||Lr)&&(qr=function(e){var t,r,n,o,i=this,a=Lr&&i.sticky,s=function(){var e=b(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}.call(i),c=i.source,u=0,f=e;return a&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),f=String(e).slice(i.lastIndex),0<i.lastIndex&&(!i.multiline||i.multiline&&"\n"!==e[i.lastIndex-1])&&(c="(?: "+c+")",f=" "+f,u++),r=new RegExp("^(?:"+c+")",s)),Ur&&(r=new RegExp("^"+c+"$(?!\\s)",s)),Fr&&(t=i.lastIndex),n=Mr.call(a?r:i,f),a?n?(n.input=n.input.slice(u),n[0]=n[0].slice(u),n.index=i.lastIndex,i.lastIndex+=n[0].length):i.lastIndex=0:Fr&&n&&(i.lastIndex=i.global?n.index+n[0].length:t),Ur&&n&&1<n.length&&jr.call(n[0],r,function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(n[o]=void 0)}),n});var zr=qr;ue({target:"RegExp",proto:!0,forced:/./.exec!==zr},{exec:zr});function Hr(s){return function(e,t){var r,n,o=String(p(e)),i=re(t),a=o.length;return i<0||a<=i?s?"":void 0:(r=o.charCodeAt(i))<55296||56319<r||i+1===a||(n=o.charCodeAt(i+1))<56320||57343<n?s?o.charAt(i):r:s?o.slice(i,i+2):n-56320+(r-55296<<10)+65536}}var Wr={codeAt:Hr(!1),charAt:Hr(!0)},Vr=Wr.charAt,Gr="String Iterator",Jr=me.set,Yr=me.getterFor(Gr);qt(String,"String",function(e){Jr(this,{type:Gr,string:String(e),index:0})},function(){var e,t=Yr(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=Vr(r,n),t.index+=e.length,{value:e,done:!1})});function Xr(r,e,t,n){var o=pe(r),i=!m(function(){var e={};return e[o]=function(){return 7},7!=""[r](e)}),a=i&&!m(function(){var e=!1,t=/a/;return"split"===r&&((t={constructor:{}}).constructor[Qr]=function(){return t},t.flags="",t[o]=/./[o]),t.exec=function(){return e=!0,null},t[o](""),!e});if(!i||!a||"replace"===r&&(!Zr||!en)||"split"===r&&!tn){var s=/./[o],c=t(o,""[r],function(e,t,r,n,o){return t.exec===zr?i&&!o?{done:!0,value:s.call(t,r,n)}:{done:!0,value:e.call(r,t,n)}:{done:!1}},{REPLACE_KEEPS_$0:en}),u=c[0],f=c[1];ge(String.prototype,r,u),ge(RegExp.prototype,o,2==e?function(e,t){return f.call(e,this,t)}:function(e){return f.call(e,this)})}n&&M(RegExp.prototype[o],"sham",!0)}function Kr(e,t,r){return t+(r?rn(e,t).length:1)}function $r(e,t){var r=e.exec;if("function"==typeof r){var n=r.call(e,t);if("object"!=typeof n)throw TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==o(e))throw TypeError("RegExp#exec called on incompatible receiver");return zr.call(e,t)}var Qr=pe("species"),Zr=!m(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),en="$0"==="a".replace(/./,"$0"),tn=!m(function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}),rn=Wr.charAt;Xr("match",1,function(n,u,f){return[function(e){var t=p(this),r=null==e?void 0:e[n];return void 0!==r?r.call(e,t):new RegExp(e)[n](String(t))},function(e){var t=f(u,e,this);if(t.done)return t.value;var r=b(e),n=String(this);if(!r.global)return $r(r,n);for(var o,i=r.unicode,a=[],s=r.lastIndex=0;null!==(o=$r(r,n));){var c=String(o[0]);""===(a[s]=c)&&(r.lastIndex=Kr(n,ne(r.lastIndex),i)),s++}return 0===s?null:a}]});var nn={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},on=pe("iterator"),an=pe("toStringTag"),sn=Qt.values;for(var cn in nn){var un=B[cn],fn=un&&un.prototype;if(fn){if(fn[on]!==sn)try{M(fn,on,sn)}catch(e){fn[on]=sn}if(fn[an]||M(fn,an,cn),nn[cn])for(var pn in Qt)if(fn[pn]!==Qt[pn])try{M(fn,pn,Qt[pn])}catch(e){fn[pn]=Qt[pn]}}}function ln(e){if(!O(e))return!1;var t=e[hn];return void 0!==t?!!t:qe(e)}var hn=pe("isConcatSpreadable"),dn=9007199254740991,yn="Maximum allowed index exceeded",mn=51<=Ke||!m(function(){var e=[];return e[hn]=!1,e.concat()[0]!==e}),gn=Xe("concat");ue({target:"Array",proto:!0,forced:!mn||!gn},{concat:function(e){var t,r,n,o,i,a=fe(this),s=le(a,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(ln(i=-1===t?a:arguments[t])){if(o=ne(i.length),dn<c+o)throw TypeError(yn);for(r=0;r<o;r++,c++)r in i&&he(s,c,i[r])}else{if(dn<=c)throw TypeError(yn);he(s,c++,i)}return s.length=c,s}});function vn(h){var d=1==h,y=2==h,m=3==h,g=4==h,v=6==h,_=5==h||v;return function(e,t,r,n){for(var o,i,a=fe(e),s=w(a),c=tr(t,r,3),u=ne(s.length),f=0,p=n||le,l=d?p(e,u):y?p(e,0):void 0;f<u;f++)if((_||f in s)&&(i=c(o=s[f],f,a),h))if(d)l[f]=i;else if(i)switch(h){case 3:return!0;case 5:return o;case 6:return f;case 2:kn.call(l,o)}else if(g)return!1;return v?-1:m||g?g:l}}var _n=!1,bn=function(){function e(){nt(this,e)}return it(e,null,[{key:"isLoggingEnabled",value:function(){return _n}},{key:"setLoggingEnabled",value:function(e){_n=e}},{key:"maybeLog",value:function(e){if(this.isLoggingEnabled()){for(var t,r=new Date,n=arguments.length,o=new Array(1<n?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];(t=console).log.apply(t,["["+r.toLocaleString()+"][THETA]["+e+"]"].concat(o))}}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.maybeLog.apply(this,["log"].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.maybeLog.apply(this,["info"].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.maybeLog.apply(this,["warn"].concat(t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.maybeLog.apply(this,["debug"].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.maybeLog.apply(this,["error"].concat(t))}}]),e}(),wn=function(){function r(e){nt(this,r);var t="";navigator.userAgent&&(t=navigator.userAgent.match(/mobile/i)?"Mobile":navigator.userAgent.match(/iPad|Android|Touch/i)?"Tablet":navigator.userAgent.match(/Tizen/i)?"TV":"Desktop"),this.maxSize="Desktop"===t?50:10,this.cache_=new Map,this.cacheQueue_=[]}return it(r,[{key:"start",value:function(){this.cleanUpIntervalId=setInterval(this.cleanUp.bind(this),6e4)}},{key:"destroy",value:function(){this.clear(),this.cleanUpIntervalId&&clearInterval(this.cleanUpIntervalId)}},{key:"has",value:function(e){return this.cache_.has(e)}},{key:"get",value:function(e){return this.cache_.get(e)}},{key:"set",value:function(e,t){this.cache_.set(e,t),this.cacheQueue_.push(e)}},{key:"delete",value:function(e){this.cache_.delete(e)}},{key:"clear",value:function(){this.cache_.clear(),this.cacheQueue_=[]}},{key:"cleanUp",value:function(){var e=this.cache_,t=this.cacheQueue_;if(t.length>=this.maxSize){bn.info("Cache full. Cleaning up.");for(var r=0,n=t.length-this.maxSize;r<n;){var o=t.shift();e.delete(o),r++}}}}]),r}(),kn=[].push,xn={forEach:vn(0),map:vn(1),filter:vn(2),some:vn(3),every:vn(4),find:vn(5),findIndex:vn(6)},Sn=xn.filter,Cn=Xe("filter"),Tn=Cn&&!m(function(){[].filter.call({length:-1,0:1},function(e){throw e})});ue({target:"Array",proto:!0,forced:!Cn||!Tn},{filter:function(e,t){return Sn(this,e,1<arguments.length?t:void 0)}});var En=pe("species"),Pn=[].slice,Rn=Math.max;ue({target:"Array",proto:!0,forced:!Xe("slice")},{slice:function(e,t){var r,n,o,i=u(this),a=ne(i.length),s=oe(e,a),c=oe(void 0===t?a:t,a);if(qe(i)&&("function"!=typeof(r=i.constructor)||r!==Array&&!qe(r.prototype)?O(r)&&null===(r=r[En])&&(r=void 0):r=void 0,r===Array||void 0===r))return Pn.call(i,s,c);for(n=new(void 0===r?Array:r)(Rn(c-s,0)),o=0;s<c;s++,o++)s in i&&he(n,o,i[s]);return n.length=o,n}});function An(e){return O(e)&&l(Yn,hr(e))}var On,Bn=D.f,In=B.DataView,Nn=In&&In.prototype,Dn=B.Int8Array,Mn=Dn&&Dn.prototype,jn=B.Uint8ClampedArray,qn=jn&&jn.prototype,Fn=Dn&&Bt(Dn),Ln=Mn&&Bt(Mn),Un=Object.prototype,zn=Un.isPrototypeOf,Hn=pe("toStringTag"),Wn=P("TYPED_ARRAY_TAG"),Vn=!(!B.ArrayBuffer||!In),Gn=Vn&&!!Ht&&"Opera"!==hr(B.opera),Jn=!1,Yn={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(On in Yn)B[On]||(Gn=!1);if((!Gn||"function"!=typeof Fn||Fn===Function.prototype)&&(Fn=function(){throw TypeError("Incorrect invocation")},Gn))for(On in Yn)B[On]&&Ht(B[On],Fn);if((!Gn||!Ln||Ln===Un)&&(Ln=Fn.prototype,Gn))for(On in Yn)B[On]&&Ht(B[On].prototype,Ln);if(Gn&&Bt(qn)!==Ln&&Ht(qn,Ln),I&&!l(Ln,Hn))for(On in Jn=!0,Bn(Ln,Hn,{get:function(){return O(this)?this[Wn]:void 0}}),Yn)B[On]&&M(B[On],Wn,On);Vn&&Ht&&Bt(Nn)!==Un&&Ht(Nn,Un);function Xn(e){if(void 0===e)return 0;var t=re(e),r=ne(t);if(t!==r)throw RangeError("Wrong length or index");return r}function Kn(e,t,r){for(var n=fe(this),o=ne(n.length),i=arguments.length,a=oe(1<i?t:void 0,o),s=2<i?r:void 0,c=void 0===s?o:oe(s,o);a<c;)n[a++]=e;return n}function $n(e){return[255&e]}function Qn(e){return[255&e,e>>8&255]}function Zn(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function eo(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function to(e){return Po(e,23,4)}function ro(e){return Po(e,52,8)}function no(e,t){go(e[ko],t,{get:function(){return vo(this)[t]}})}function oo(e,t,r,n){var o=Xn(r),i=vo(e);if(o+t>i.byteLength)throw Eo(xo);var a=vo(i.buffer).bytes,s=o+i.byteOffset,c=a.slice(s,s+t);return n?c:c.reverse()}function io(e,t,r,n,o,i){var a=Xn(r),s=vo(e);if(a+t>s.byteLength)throw Eo(xo);for(var c=vo(s.buffer).bytes,u=a+s.byteOffset,f=n(+o),p=0;p<t;p++)c[u+p]=f[i?p:t-p-1]}var ao={NATIVE_ARRAY_BUFFER:Vn,NATIVE_ARRAY_BUFFER_VIEWS:Gn,TYPED_ARRAY_TAG:Jn&&Wn,aTypedArray:function(e){if(An(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Ht){if(zn.call(Fn,e))return e}else for(var t in Yn)if(l(Yn,On)){var r=B[t];if(r&&(e===r||zn.call(r,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r){if(I){if(r)for(var n in Yn){var o=B[n];o&&l(o.prototype,e)&&delete o.prototype[e]}Ln[e]&&!r||ge(Ln,e,r?t:Gn&&Mn[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var n,o;if(I){if(Ht){if(r)for(n in Yn)(o=B[n])&&l(o,e)&&delete o[e];if(Fn[e]&&!r)return;try{return ge(Fn,e,r?t:Gn&&Dn[e]||t)}catch(e){}}for(n in Yn)!(o=B[n])||o[e]&&!r||ge(o,e,t)}},isView:function(e){var t=hr(e);return"DataView"===t||l(Yn,t)},isTypedArray:An,TypedArray:Fn,TypedArrayPrototype:Ln},so=Math.abs,co=Math.pow,uo=Math.floor,fo=Math.log,po=Math.LN2,lo=function(e,t,r){var n,o,i,a=new Array(r),s=8*r-t-1,c=(1<<s)-1,u=c>>1,f=23===t?co(2,-24)-co(2,-77):0,p=e<0||0===e&&1/e<0?1:0,l=0;for((e=so(e))!=e||e===1/0?(o=e!=e?1:0,n=c):(n=uo(fo(e)/po),e*(i=co(2,-n))<1&&(n--,i*=2),2<=(e+=1<=n+u?f/i:f*co(2,1-u))*i&&(n++,i/=2),c<=n+u?(o=0,n=c):1<=n+u?(o=(e*i-1)*co(2,t),n+=u):(o=e*co(2,u-1)*co(2,t),n=0));8<=t;a[l++]=255&o,o/=256,t-=8);for(n=n<<t|o,s+=t;0<s;a[l++]=255&n,n/=256,s-=8);return a[--l]|=128*p,a},ho=function(e,t){var r,n=e.length,o=8*n-t-1,i=(1<<o)-1,a=i>>1,s=o-7,c=n-1,u=e[c--],f=127&u;for(u>>=7;0<s;f=256*f+e[c],c--,s-=8);for(r=f&(1<<-s)-1,f>>=-s,s+=t;0<s;r=256*r+e[c],c--,s-=8);if(0===f)f=1-a;else{if(f===i)return r?NaN:u?-1/0:1/0;r+=co(2,t),f-=a}return(u?-1:1)*r*co(2,f-t)},yo=ao.NATIVE_ARRAY_BUFFER,mo=Pe.f,go=D.f,vo=me.get,_o=me.set,bo="ArrayBuffer",wo="DataView",ko="prototype",xo="Wrong index",So=B[bo],Co=So,To=B[wo],Eo=B.RangeError,Po=lo,Ro=ho;if(yo){if(!m(function(){So(1)})||!m(function(){new So(-1)})||m(function(){return new So,new So(1.5),new So(NaN),So.name!=bo})){for(var Ao,Oo=(Co=function(e){return ur(this,Co),new So(Xn(e))})[ko]=So[ko],Bo=mo(So),Io=0;Bo.length>Io;)(Ao=Bo[Io++])in Co||M(Co,Ao,So[Ao]);Oo.constructor=Co}var No=new To(new Co(2)),Do=To[ko].setInt8;No.setInt8(0,2147483648),No.setInt8(1,2147483649),!No.getInt8(0)&&No.getInt8(1)||xr(To[ko],{setInt8:function(e,t){Do.call(this,e,t<<24>>24)},setUint8:function(e,t){Do.call(this,e,t<<24>>24)}},{unsafe:!0})}else Co=function(e){ur(this,Co,bo);var t=Xn(e);_o(this,{bytes:Kn.call(new Array(t),0),byteLength:t}),I||(this.byteLength=t)},To=function(e,t,r){ur(this,To,wo),ur(e,Co,wo);var n=vo(e).byteLength,o=re(t);if(o<0||n<o)throw Eo("Wrong offset");if(n<o+(r=void 0===r?n-o:ne(r)))throw Eo("Wrong length");_o(this,{buffer:e,byteLength:r,byteOffset:o}),I||(this.buffer=e,this.byteLength=r,this.byteOffset=o)},I&&(no(Co,"byteLength"),no(To,"buffer"),no(To,"byteLength"),no(To,"byteOffset")),xr(To[ko],{getInt8:function(e){return oo(this,1,e)[0]<<24>>24},getUint8:function(e){return oo(this,1,e)[0]},getInt16:function(e,t){var r=oo(this,2,e,1<arguments.length?t:void 0);return(r[1]<<8|r[0])<<16>>16},getUint16:function(e,t){var r=oo(this,2,e,1<arguments.length?t:void 0);return r[1]<<8|r[0]},getInt32:function(e,t){return eo(oo(this,4,e,1<arguments.length?t:void 0))},getUint32:function(e,t){return eo(oo(this,4,e,1<arguments.length?t:void 0))>>>0},getFloat32:function(e,t){return Ro(oo(this,4,e,1<arguments.length?t:void 0),23)},getFloat64:function(e,t){return Ro(oo(this,8,e,1<arguments.length?t:void 0),52)},setInt8:function(e,t){io(this,1,e,$n,t)},setUint8:function(e,t){io(this,1,e,$n,t)},setInt16:function(e,t,r){io(this,2,e,Qn,t,2<arguments.length?r:void 0)},setUint16:function(e,t,r){io(this,2,e,Qn,t,2<arguments.length?r:void 0)},setInt32:function(e,t,r){io(this,4,e,Zn,t,2<arguments.length?r:void 0)},setUint32:function(e,t,r){io(this,4,e,Zn,t,2<arguments.length?r:void 0)},setFloat32:function(e,t,r){io(this,4,e,to,t,2<arguments.length?r:void 0)},setFloat64:function(e,t,r){io(this,8,e,ro,t,2<arguments.length?r:void 0)}});Dt(Co,bo),Dt(To,wo);var Mo={ArrayBuffer:Co,DataView:To},jo="ArrayBuffer",qo=Mo[jo],Fo=B[jo];ue({global:!0,forced:Fo!==qo},{ArrayBuffer:qo}),Sr(jo);function Lo(r){return function(e){var t=String(p(e));return 1&r&&(t=t.replace(Ho,"")),2&r&&(t=t.replace(Wo,"")),t}}function Uo(e){var t,r,n,o,i,a,s,c,u=f(e,!1);if("string"==typeof u&&2<u.length)if(43===(t=(u=Xo(u)).charCodeAt(0))||45===t){if(88===(r=u.charCodeAt(2))||120===r)return NaN}else if(48===t){switch(u.charCodeAt(1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+u}for(a=(i=u.slice(2)).length,s=0;s<a;s++)if((c=i.charCodeAt(s))<48||o<c)return NaN;return parseInt(i,n)}return+u}var zo="[\t\n\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff]",Ho=RegExp("^"+zo+zo+"*"),Wo=RegExp(zo+zo+"*$"),Vo={start:Lo(1),end:Lo(2),trim:Lo(3)},Go=Pe.f,Jo=N.f,Yo=D.f,Xo=Vo.trim,Ko="Number",$o=B[Ko],Qo=$o.prototype,Zo=o(wt(Qo))==Ko;if(Me(Ko,!$o(" 0o1")||!$o("0b1")||$o("+0x1"))){for(var ei,ti=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof ti&&(Zo?m(function(){Qo.valueOf.call(r)}):o(r)!=Ko)?wr(new $o(Uo(t)),r,ti):Uo(t)},ri=I?Go($o):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),ni=0;ri.length>ni;ni++)l($o,ei=ri[ni])&&!l(ti,ei)&&Yo(ti,ei,Jo($o,ei));(ti.prototype=Qo).constructor=ti,ge(B,Ko,ti)}var oi=Math.floor;ue({target:"Number",stat:!0},{isInteger:function(e){return!O(e)&&isFinite(e)&&oi(e)===e}});var ii=m(function(){dt(1)});ue({target:"Object",stat:!0,forced:ii},{keys:function(e){return dt(fe(e))}});function ai(e,t){var r,n=b(e).constructor;return void 0===n||null==(r=b(n)[yi])?t:er(r)}function si(e){if(Si.hasOwnProperty(e)){var t=Si[e];delete Si[e],t()}}function ci(e){return function(){si(e)}}function ui(e){si(e.data)}function fi(e){B.postMessage(e+"",gi.protocol+"//"+gi.host)}var pi,li,hi,di=B.Promise,yi=pe("species"),mi=/(iphone|ipod|ipad).*applewebkit/i.test(Ve),gi=B.location,vi=B.setImmediate,_i=B.clearImmediate,bi=B.process,wi=B.MessageChannel,ki=B.Dispatch,xi=0,Si={},Ci="onreadystatechange";vi&&_i||(vi=function(e){for(var t=[],r=1;r<arguments.length;)t.push(arguments[r++]);return Si[++xi]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},pi(xi),xi},_i=function(e){delete Si[e]},"process"==o(bi)?pi=function(e){bi.nextTick(ci(e))}:ki&&ki.now?pi=function(e){ki.now(ci(e))}:wi&&!mi?(hi=(li=new wi).port2,li.port1.onmessage=ui,pi=tr(hi.postMessage,hi,1)):!B.addEventListener||"function"!=typeof postMessage||B.importScripts||m(fi)?pi=Ci in n("script")?function(e){mt.appendChild(n("script"))[Ci]=function(){mt.removeChild(this),si(e)}}:function(e){setTimeout(ci(e),0)}:(pi=fi,B.addEventListener("message",ui,!1)));var Ti,Ei,Pi,Ri,Ai,Oi,Bi,Ii,Ni={set:vi,clear:_i},Di=N.f,Mi=Ni.set,ji=B.MutationObserver||B.WebKitMutationObserver,qi=B.process,Fi=B.Promise,Li="process"==o(qi),Ui=Di(B,"queueMicrotask"),zi=Ui&&Ui.value;zi||(Ti=function(){var e,t;for(Li&&(e=qi.domain)&&e.exit();Ei;){t=Ei.fn,Ei=Ei.next;try{t()}catch(e){throw Ei?Ri():Pi=void 0,e}}Pi=void 0,e&&e.enter()},Ri=Li?function(){qi.nextTick(Ti)}:ji&&!mi?(Ai=!0,Oi=document.createTextNode(""),new ji(Ti).observe(Oi,{characterData:!0}),function(){Oi.data=Ai=!Ai}):Fi&&Fi.resolve?(Bi=Fi.resolve(void 0),Ii=Bi.then,function(){Ii.call(Bi,Ti)}):function(){Mi.call(B,Ti)});function Hi(e){var r,n;this.promise=new e(function(e,t){if(void 0!==r||void 0!==n)throw TypeError("Bad Promise constructor");r=e,n=t}),this.resolve=er(r),this.reject=er(n)}function Wi(e,t){if(b(e),O(t)&&t.constructor===e)return t;var r=ra.f(e);return(0,r.resolve)(t),r.promise}function Vi(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}function Gi(e){var t;return!(!O(e)||"function"!=typeof(t=e.then))&&t}function Ji(p,l,h){if(!l.notified){l.notified=!0;var d=l.reactions;ta(function(){for(var e=l.value,t=1==l.state,r=0;d.length>r;){var n,o,i,a=d[r++],s=t?a.ok:a.fail,c=a.resolve,u=a.reject,f=a.domain;try{s?(t||(2===l.rejection&&xa(p,l),l.rejection=1),!0===s?n=e:(f&&f.enter(),n=s(e),f&&(f.exit(),i=!0)),n===a.promise?u(fa("Promise-chain cycle")):(o=Gi(n))?o.call(n,c,u):c(n)):u(e)}catch(e){f&&!i&&f.exit(),u(e)}}l.reactions=[],l.notified=!1,h&&!l.rejection&&wa(p,l)})}}function Yi(e,t,r){var n,o;ga?((n=pa.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),B.dispatchEvent(n)):n={promise:t,reason:r},(o=B["on"+e])?o(n):e===va&&function(e,t){var r=B.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)}function Xi(t,r,n,o){return function(e){t(r,n,e,o)}}function Ki(e,t,r,n){t.done||(t.done=!0,n&&(t=n),t.value=r,t.state=2,Ji(e,t,!0))}var $i,Qi,Zi,ea,ta=zi||function(e){var t={fn:e,next:void 0};Pi&&(Pi.next=t),Ei||(Ei=t,Ri()),Pi=t},ra={f:function(e){return new Hi(e)}},na=Ni.set,oa=pe("species"),ia="Promise",aa=me.get,sa=me.set,ca=me.getterFor(ia),ua=di,fa=B.TypeError,pa=B.document,la=B.process,ha=te("fetch"),da=ra.f,ya=da,ma="process"==o(la),ga=!!(pa&&pa.createEvent&&B.dispatchEvent),va="unhandledrejection",_a=Me(ia,function(){if(!(L(ua)!==String(ua))){if(66===Ke)return!0;if(!ma&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=Ke&&/native code/.test(ua))return!1;function e(e){e(function(){},function(){})}var t=ua.resolve(1);return(t.constructor={})[oa]=e,!(t.then(function(){})instanceof e)}),ba=_a||!br(function(e){ua.all(e).catch(function(){})}),wa=function(r,n){na.call(B,function(){var e,t=n.value;if(ka(n)&&(e=Vi(function(){ma?la.emit("unhandledRejection",t,r):Yi(va,r,t)}),n.rejection=ma||ka(n)?2:1,e.error))throw e.value})},ka=function(e){return 1!==e.rejection&&!e.parent},xa=function(e,t){na.call(B,function(){ma?la.emit("rejectionHandled",e):Yi("rejectionhandled",e,t.value)})},Sa=function(r,n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(r===e)throw fa("Promise can't be resolved itself");var o=Gi(e);o?ta(function(){var t={done:!1};try{o.call(e,Xi(Sa,r,t,n),Xi(Ki,r,t,n))}catch(e){Ki(r,t,e,n)}}):(n.value=e,n.state=1,Ji(r,n,!1))}catch(e){Ki(r,{done:!1},e,n)}}};_a&&(ua=function(e){ur(this,ua,ia),er(e),$i.call(this);var t=aa(this);try{e(Xi(Sa,this,t),Xi(Ki,this,t))}catch(e){Ki(this,t,e)}},($i=function(){sa(this,{type:ia,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=xr(ua.prototype,{then:function(e,t){var r=ca(this),n=da(ai(this,ua));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=ma?la.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&Ji(this,r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),Qi=function(){var e=new $i,t=aa(e);this.promise=e,this.resolve=Xi(Sa,e,t),this.reject=Xi(Ki,e,t)},ra.f=da=function(e){return e===ua||e===Zi?new Qi(e):ya(e)},"function"==typeof di&&(ea=di.prototype.then,ge(di.prototype,"then",function(e,t){var r=this;return new ua(function(e,t){ea.call(r,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof ha&&ue({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Wi(ua,ha.apply(B,arguments))}}))),ue({global:!0,wrap:!0,forced:_a},{Promise:ua}),Dt(ua,ia,!1),Sr(ia),Zi=te(ia),ue({target:ia,stat:!0,forced:_a},{reject:function(e){var t=da(this);return t.reject.call(void 0,e),t.promise}}),ue({target:ia,stat:!0,forced:_a},{resolve:function(e){return Wi(this,e)}}),ue({target:ia,stat:!0,forced:ba},{all:function(e){var s=this,t=da(s),c=t.resolve,u=t.reject,r=Vi(function(){var n=er(s.resolve),o=[],i=0,a=1;yr(e,function(e){var t=i++,r=!1;o.push(void 0),a++,n.call(s,e).then(function(e){r||(r=!0,o[t]=e,--a||c(o))},u)}),--a||c(o)});return r.error&&u(r.value),t.promise},race:function(e){var r=this,n=da(r),o=n.reject,t=Vi(function(){var t=er(r.resolve);yr(e,function(e){t.call(r,e).then(n.resolve,o)})});return t.error&&o(t.value),n.promise}});kr("Set",function(t){return function(e){return t(this,arguments.length?e:void 0)}},Ar);function Ca(e){var t;return O(e)&&(void 0!==(t=e[Ta])?!!t:"RegExp"==o(e))}var Ta=pe("match"),Ea=[].push,Pa=Math.min,Ra=4294967295,Aa=!m(function(){return!RegExp(Ra,"y")});Xr("split",2,function(o,m,g){var v;return v="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,t){var r=String(p(this)),n=void 0===t?Ra:t>>>0;if(0==n)return[];if(void 0===e)return[r];if(!Ca(e))return m.call(r,e,n);for(var o,i,a,s=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),u=0,f=new RegExp(e.source,c+"g");(o=zr.call(f,r))&&!(u<(i=f.lastIndex)&&(s.push(r.slice(u,o.index)),1<o.length&&o.index<r.length&&Ea.apply(s,o.slice(1)),a=o[0].length,u=i,s.length>=n));)f.lastIndex===o.index&&f.lastIndex++;return u===r.length?!a&&f.test("")||s.push(""):s.push(r.slice(u)),s.length>n?s.slice(0,n):s}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:m.call(this,e,t)}:m,[function(e,t){var r=p(this),n=null==e?void 0:e[o];return void 0!==n?n.call(e,r,t):v.call(String(r),e,t)},function(e,t){var r=g(v,e,this,t,v!==m);if(r.done)return r.value;var n=b(e),o=String(this),i=ai(n,RegExp),a=n.unicode,s=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(Aa?"y":"g"),c=new i(Aa?n:"^(?:"+n.source+")",s),u=void 0===t?Ra:t>>>0;if(0==u)return[];if(0===o.length)return null===$r(c,o)?[o]:[];for(var f=0,p=0,l=[];p<o.length;){c.lastIndex=Aa?p:0;var h,d=$r(c,Aa?o:o.slice(p));if(null===d||(h=Pa(ne(c.lastIndex+(Aa?0:p)),o.length))===f)p=Kr(o,p,a);else{if(l.push(o.slice(f,p)),l.length===u)return l;for(var y=1;y<=d.length-1;y++)if(l.push(d[y]),l.length===u)return l;p=f=h}}return l.push(o.slice(f)),l}]},!Aa);function Oa(e,t){var r=function(e){var t=re(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}(e);if(r%t)throw RangeError("Wrong offset");return r}function Ba(e,t,r){var n,o,i,a,s,c,u=fe(e),f=arguments.length,p=1<f?t:void 0,l=void 0!==p,h=sr(u);if(null!=h&&!Zt(h))for(c=(s=h.call(u)).next,u=[];!(a=c.call(s)).done;)u.push(a.value);for(l&&2<f&&(p=tr(p,r,2)),o=ne(u.length),i=new(ja(this))(o),n=0;n<o;n++)i[n]=l?p(u[n],n):u[n];return i}var Ia=ao.NATIVE_ARRAY_BUFFER_VIEWS,Na=B.ArrayBuffer,Da=B.Int8Array,Ma=!Ia||!m(function(){Da(1)})||!m(function(){new Da(-1)})||!br(function(e){new Da,new Da(null),new Da(1.5),new Da(e)},!0)||m(function(){return 1!==new Da(new Na(2),1,void 0).length}),ja=ao.aTypedArrayConstructor;e(function(e){function d(e,t){for(var r=0,n=t.length,o=new(a(e))(n);r<n;)o[r]=t[r++];return o}function t(e,t){v(e,t,{get:function(){return m(this)[t]}})}function y(e){var t;return e instanceof w||"ArrayBuffer"==(t=hr(e))||"SharedArrayBuffer"==t}function n(e,t){return E(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)}function r(e,t){return n(e,t=f(t,!0))?A(2,e[t]):i(e,t)}function o(e,t,r){return!(n(e,t=f(t,!0))&&O(r)&&l(r,"value"))||l(r,"get")||l(r,"set")||r.configurable||l(r,"writable")&&!r.writable||l(r,"enumerable")&&!r.enumerable?v(e,t,r):(e[t]=r.value,e)}var c=Pe.f,u=xn.forEach,m=me.get,g=me.set,v=D.f,i=N.f,_=Math.round,b=B.RangeError,w=Mo.ArrayBuffer,k=Mo.DataView,x=ao.NATIVE_ARRAY_BUFFER_VIEWS,S=ao.TYPED_ARRAY_TAG,C=ao.TypedArray,T=ao.TypedArrayPrototype,a=ao.aTypedArrayConstructor,E=ao.isTypedArray,P="BYTES_PER_ELEMENT",R="Wrong length";I?(x||(N.f=r,D.f=o,t(T,"buffer"),t(T,"byteOffset"),t(T,"byteLength"),t(T,"length")),ue({target:"Object",stat:!0,forced:!x},{getOwnPropertyDescriptor:r,defineProperty:o}),e.exports=function(e,t,i){function f(e,o){v(e,o,{get:function(){return e=o,(t=m(this)).view[r](e*p+t.byteOffset,!0);var e,t},set:function(e){return t=o,r=e,n=m(this),i&&(r=(r=_(r))<0?0:255<r?255:255&r),void n.view[a](t*p+n.byteOffset,r,!0);var t,r,n},enumerable:!0})}var p=e.match(/\d+$/)[0]/8,l=e+(i?"Clamped":"")+"Array",r="get"+e,a="set"+e,o=B[l],h=o,n=h&&h.prototype,s={};x?Ma&&(h=t(function(e,t,r,n){return ur(e,h,l),wr(O(t)?y(t)?void 0!==n?new o(t,Oa(r,p),n):void 0!==r?new o(t,Oa(r,p)):new o(t):E(t)?d(h,t):Ba.call(h,t):new o(Xn(t)),e,h)}),Ht&&Ht(h,C),u(c(o),function(e){e in h||M(h,e,o[e])}),h.prototype=n):(h=t(function(e,t,r,n){ur(e,h,l);var o,i,a,s=0,c=0;if(O(t)){if(!y(t))return E(t)?d(h,t):Ba.call(h,t);o=t,c=Oa(r,p);var u=t.byteLength;if(void 0===n){if(u%p)throw b(R);if((i=u-c)<0)throw b(R)}else if(u<(i=ne(n)*p)+c)throw b(R);a=i/p}else a=Xn(t),o=new w(i=a*p);for(g(e,{buffer:o,byteOffset:c,byteLength:i,length:a,view:new k(o)});s<a;)f(e,s++)}),Ht&&Ht(h,C),n=h.prototype=wt(T)),n.constructor!==h&&M(n,"constructor",h),S&&M(n,S,l),s[l]=h,ue({global:!0,forced:h!=o,sham:!x},s),P in h||M(h,P,p),P in n||M(n,P,p),Sr(l)}):e.exports=function(){}})("Uint8",function(n){return function(e,t,r){return n(this,e,t,r)}});var qa=Math.min,Fa=[].copyWithin||function(e,t,r){var n=fe(this),o=ne(n.length),i=oe(e,o),a=oe(t,o),s=2<arguments.length?r:void 0,c=qa((void 0===s?o:oe(s,o))-a,o-i),u=1;for(a<i&&i<a+c&&(u=-1,a+=c-1,i+=c-1);0<c--;)a in n?n[i]=n[a]:delete n[i],i+=u,a+=u;return n},La=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("copyWithin",function(e,t,r){return Fa.call(La(this),e,t,2<arguments.length?r:void 0)});var Ua=xn.every,za=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("every",function(e,t){return Ua(za(this),e,1<arguments.length?t:void 0)});var Ha=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("fill",function(e){return Kn.apply(Ha(this),arguments)});var Wa=xn.filter,Va=ao.aTypedArray,Ga=ao.aTypedArrayConstructor;(0,ao.exportTypedArrayMethod)("filter",function(e,t){for(var r=Wa(Va(this),e,1<arguments.length?t:void 0),n=ai(this,this.constructor),o=0,i=r.length,a=new(Ga(n))(i);o<i;)a[o]=r[o++];return a});var Ja=xn.find,Ya=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("find",function(e,t){return Ja(Ya(this),e,1<arguments.length?t:void 0)});var Xa=xn.findIndex,Ka=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("findIndex",function(e,t){return Xa(Ka(this),e,1<arguments.length?t:void 0)});var $a=xn.forEach,Qa=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("forEach",function(e,t){$a(Qa(this),e,1<arguments.length?t:void 0)});var Za=Se.includes,es=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("includes",function(e,t){return Za(es(this),e,1<arguments.length?t:void 0)});var ts=Se.indexOf,rs=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("indexOf",function(e,t){return ts(rs(this),e,1<arguments.length?t:void 0)});function ns(){return as.call(us(this))}var os=pe("iterator"),is=B.Uint8Array,as=Qt.values,ss=Qt.keys,cs=Qt.entries,us=ao.aTypedArray,fs=ao.exportTypedArrayMethod,ps=is&&is.prototype[os],ls=!!ps&&("values"==ps.name||null==ps.name);fs("entries",function(){return cs.call(us(this))}),fs("keys",function(){return ss.call(us(this))}),fs("values",ns,!ls),fs(os,ns,!ls);var hs=ao.aTypedArray,ds=[].join;(0,ao.exportTypedArrayMethod)("join",function(e){return ds.apply(hs(this),arguments)});function ys(e,t){var r=[][e];return!r||!m(function(){r.call(null,t||function(){throw 1},1)})}var ms=Math.min,gs=[].lastIndexOf,vs=!!gs&&1/[1].lastIndexOf(1,-0)<0,_s=ys("lastIndexOf"),bs=vs||_s?function(e,t){if(vs)return gs.apply(this,arguments)||0;var r=u(this),n=ne(r.length),o=n-1;for(1<arguments.length&&(o=ms(o,re(t))),o<0&&(o=n+o);0<=o;o--)if(o in r&&r[o]===e)return o||0;return-1}:gs,ws=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("lastIndexOf",function(e){return bs.apply(ws(this),arguments)});var ks=xn.map,xs=ao.aTypedArray,Ss=ao.aTypedArrayConstructor;(0,ao.exportTypedArrayMethod)("map",function(e,t){return ks(xs(this),e,1<arguments.length?t:void 0,function(e,t){return new(Ss(ai(e,e.constructor)))(t)})});function Cs(u){return function(e,t,r,n){er(t);var o=fe(e),i=w(o),a=ne(o.length),s=u?a-1:0,c=u?-1:1;if(r<2)for(;;){if(s in i){n=i[s],s+=c;break}if(s+=c,u?s<0:a<=s)throw TypeError("Reduce of empty array with no initial value")}for(;u?0<=s:s<a;s+=c)s in i&&(n=t(n,i[s],s,o));return n}}var Ts={left:Cs(!1),right:Cs(!0)},Es=Ts.left,Ps=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("reduce",function(e,t){return Es(Ps(this),e,arguments.length,1<arguments.length?t:void 0)});var Rs=Ts.right,As=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("reduceRight",function(e,t){return Rs(As(this),e,arguments.length,1<arguments.length?t:void 0)});var Os=ao.aTypedArray,Bs=ao.exportTypedArrayMethod,Is=Math.floor;Bs("reverse",function(){for(var e,t=this,r=Os(t).length,n=Is(r/2),o=0;o<n;)e=t[o],t[o++]=t[--r],t[r]=e;return t});var Ns=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("set",function(e,t){Ns(this);var r=Oa(1<arguments.length?t:void 0,1),n=this.length,o=fe(e),i=ne(o.length),a=0;if(n<i+r)throw RangeError("Wrong length");for(;a<i;)this[r+a]=o[a++]},m(function(){new Int8Array(1).set({})}));var Ds=ao.aTypedArray,Ms=ao.aTypedArrayConstructor,js=[].slice;(0,ao.exportTypedArrayMethod)("slice",function(e,t){for(var r=js.call(Ds(this),e,t),n=ai(this,this.constructor),o=0,i=r.length,a=new(Ms(n))(i);o<i;)a[o]=r[o++];return a},m(function(){new Int8Array(1).slice()}));var qs=xn.some,Fs=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("some",function(e,t){return qs(Fs(this),e,1<arguments.length?t:void 0)});var Ls=ao.aTypedArray,Us=[].sort;(0,ao.exportTypedArrayMethod)("sort",function(e){return Us.call(Ls(this),e)});var zs=ao.aTypedArray;(0,ao.exportTypedArrayMethod)("subarray",function(e,t){var r=zs(this),n=r.length,o=oe(e,n);return new(ai(r,r.constructor))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,ne((void 0===t?n:oe(t,n))-o))});var Hs=B.Int8Array,Ws=ao.aTypedArray,Vs=ao.exportTypedArrayMethod,Gs=[].toLocaleString,Js=[].slice,Ys=!!Hs&&m(function(){Gs.call(new Hs(1))});Vs("toLocaleString",function(){return Gs.apply(Ys?Js.call(Ws(this)):Ws(this),arguments)},m(function(){return[1,2].toLocaleString()!=new Hs([1,2]).toLocaleString()})||!m(function(){Hs.prototype.toLocaleString.call([1,2])}));var Xs=ao.exportTypedArrayMethod,Ks=B.Uint8Array,$s=Ks&&Ks.prototype||{},Qs=[].toString,Zs=[].join;m(function(){Qs.call({})})&&(Qs=function(){return Zs.call(this)}),Xs("toString",Qs,$s.toString!=Qs);var ec=xn.forEach,tc=ys("forEach")?function(e,t){return ec(this,e,1<arguments.length?t:void 0)}:[].forEach;for(var rc in nn){var nc=B[rc],oc=nc&&nc.prototype;if(oc&&oc.forEach!==tc)try{M(oc,"forEach",tc)}catch(e){oc.forEach=tc}}ue({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});function ic(e){var t=ve.Symbol||(ve.Symbol={});l(t,e)||xc(t,e,{value:kc.f(e)})}function ac(e,t){var r=qc[e]=wt(Bc[Ec]);return Rc(r,{type:Tc,tag:e,description:t}),I||(r.description=t),r}function sc(t,e){b(t);var r=u(e),n=dt(r).concat(Xc(r));return Sc(n,function(e){I&&!Yc.call(r,e)||Jc(t,e,r[e])}),t}function cc(e,t){var r=u(e),n=f(t,!0);if(r!==Oc||!l(qc,n)||l(Fc,n)){var o=Nc(r,n);return!o||!l(qc,n)||l(r,Cc)&&r[Cc][n]||(o.enumerable=!0),o}}function uc(e){var t=Mc(u(e)),r=[];return Sc(t,function(e){l(qc,e)||l(J,e)||r.push(e)}),r}var fc,pc={P2P_INBOUND:"p2p_inbound",P2P_OUTBOUND:"p2p_outbound",CDN:"cdn"},lc={PEERS_CHANGED:"thetaPeersChanged",PEER_ID_CHANGED:"thetaPeerIDChanged",TRAFFIC:"thetaTraffic",ACCOUNT_UPDATED:"thetaAccountUpdated",PAYMENT_SENT:"thetaPaymentSent",PAYMENT_RECEIVED:"thetaPaymentReceived",SUBMITTED_RECEIVED_PAYMENTS:"thetaSubmittedReceivedPayments"},hc=e(function(o,e){parcelRequire=function(a,s,e){var t,c="function"==typeof parcelRequire&&parcelRequire,u=i;function f(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof parcelRequire&&parcelRequire;if(!e&&r)return r(t,!0);if(c)return c(t,!0);if(u&&"string"==typeof t)return u(t);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}i.resolve=function(e){return a[t][1][e]||e},i.cache={};var o=s[t]=new f.Module(t);a[t][0].call(o.exports,i,o,o.exports,this)}return s[t].exports;function i(e){return f(i.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=a,f.cache=s,f.parent=c,f.register=function(e,r){a[e]=[function(e,t){t.exports=r},{}]};for(var r=0;r<e.length;r++)try{f(e[r])}catch(a){t=t||a}if(e.length){var n=f(e[e.length-1]);o.exports=n}if(parcelRequire=f,t)throw t;return f}({vHo1:[function(e,t,r){var n={};n.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),n.useArrayBufferView=!n.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),t.exports.binaryFeatures=n;var o=t.exports.BlobBuilder;function i(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(o=t.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),i.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},i.prototype.flush=function(){if(0<this._pieces.length){var e=new Uint8Array(this._pieces);n.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),n.useBlobBuilder){for(var e=new o,t=0,r=this._parts.length;t<r;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},t.exports.BufferBuilder=i},{}],lHOc:[function(e,t,r){var n=e("./bufferbuilder").BufferBuilder,o=e("./bufferbuilder").binaryFeatures,i={unpack:function(e){return new a(e).unpack()},pack:function(e){var t=new s;return t.pack(e),t.getBuffer()}};function a(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function s(){this.bufferBuilder=new n}function c(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}t.exports=i,a.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},a.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},a.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},a.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},a.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},a.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},a.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},a.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},a.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},a.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},a.prototype.unpack_string=function(e){for(var t,r,n=this.read(e),o=0,i="";o<e;)(t=n[o])<128?(i+=String.fromCharCode(t),o++):(192^t)<32?(r=(192^t)<<6|63&n[o+1],i+=String.fromCharCode(r),o+=2):(r=(15&t)<<12|(63&n[o+1])<<6|63&n[o+2],i+=String.fromCharCode(r),o+=3);return this.index+=e,i},a.prototype.unpack_array=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=this.unpack();return t},a.prototype.unpack_map=function(e){for(var t={},r=0;r<e;r++){var n=this.unpack(),o=this.unpack();t[n]=o}return t},a.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=(e>>23&255)-127;return(0==e>>31?1:-1)*(8388607&e|8388608)*Math.pow(2,t-23)},a.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),r=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*Math.pow(2,r-20)+t*Math.pow(2,r-52))},a.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},s.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},s.prototype.pack=function(e){var t=typeof e;if("string"==t)this.pack_string(e);else if("number"==t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"==t)!0===e?this.bufferBuilder.append(195):!1===e&&this.bufferBuilder.append(194);else if("undefined"==t)this.bufferBuilder.append(192);else{if("object"!=t)throw new Error('Type "'+t+'" not yet supported');if(null===e)this.bufferBuilder.append(192);else{var r=e.constructor;if(r==Array)this.pack_array(e);else if(r==Blob||r==File)this.pack_bin(e);else if(r==ArrayBuffer)o.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)o.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(r==Object)this.pack_object(e);else if(r==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error('Type "'+r.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},s.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},s.prototype.pack_string=function(e){var t,r=600<(t=e).length?new Blob([t]).size:t.replace(/[^\u0000-\u007F]/g,c).length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this.bufferBuilder.append(216),this.pack_uint16(r);else{if(!(r<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(r)}this.bufferBuilder.append(e)},s.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var r=0;r<t;r++)this.pack(e[r])},s.prototype.pack_integer=function(e){if(-32<=e&&e<=127)this.bufferBuilder.append(255&e);else if(0<=e&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(-128<=e&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(0<=e&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(-32768<=e&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(0<=e&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(-2147483648<=e&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(-0x8000000000000000<=e&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(0<=e&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},s.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var r=Math.floor(Math.log(e)/Math.LN2),n=e/Math.pow(2,r)-1,o=Math.floor(n*Math.pow(2,52)),i=Math.pow(2,32),a=t<<31|r+1023<<20|o/i&1048575,s=o%i;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(s)},s.prototype.pack_object=function(e){var t=Object.keys(e).length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var r in e)e.hasOwnProperty(r)&&(this.pack(r),this.pack(e[r]))},s.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},s.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},s.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},s.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),r=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&r)>>>24),this.bufferBuilder.append((16711680&r)>>>16),this.bufferBuilder.append((65280&r)>>>8),this.bufferBuilder.append(255&r)},s.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},s.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},s.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},s.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),r=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&r)>>>24),this.bufferBuilder.append((16711680&r)>>>16),this.bufferBuilder.append((65280&r)>>>8),this.bufferBuilder.append(255&r)}},{"./bufferbuilder":"vHo1"}],sXtV:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,r.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,r.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],BHXf:[function(e,t,r){var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var o,i=n(e("js-binarypack")),c=e("./adapter"),u={iceServers:[{urls:"stun:stun.l.google.com:19302"}],sdpSemantics:"unified-plan"},a=(f.noop=function(){},f.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},f.chunk=function(e){for(var t,r=[],n=e.size,o=Math.ceil(n/f.chunkedMTU),i=t=0;i<n;){var a=Math.min(n,i+f.chunkedMTU),s=e.slice(i,a),c={__peerData:this._dataCount,n:t,data:s,total:o};r.push(c),i=a,t++}return this._dataCount++,r},f.blobToArrayBuffer=function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsArrayBuffer(e)},f.blobToBinaryString=function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsBinaryString(e)},f.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer},f.randomToken=function(){return Math.random().toString(36).substr(2)},f.isSecure=function(){return"https:"===location.protocol},f.CLOUD_HOST="0.peerjs.com",f.CLOUD_PORT=443,f.chunkedBrowsers={Chrome:1},f.chunkedMTU=16300,f.defaultConfig=u,f.browser=(o=window).mozRTCPeerConnection?"Firefox":o.webkitRTCPeerConnection?"Chrome":o.RTCPeerConnection?"Supported":"Unsupported",f.supports=function(){if(void 0===c.RTCPeerConnection)return{};var e,t,r=!0,n=!0,o=!1,i=!1,a=!!window.webkitRTCPeerConnection;try{e=new c.RTCPeerConnection(u,{optional:[{RtpDataChannels:!0}]})}catch(e){n=r=!1}if(r)try{t=e.createDataChannel("_PEERJSTEST")}catch(e){r=!1}if(r){try{t.binaryType="blob",o=!0}catch(e){}var s=new c.RTCPeerConnection(u,{});try{i=s.createDataChannel("_PEERJSRELIABLETEST",{}).ordered}catch(e){}s.close()}return n=n&&!!e.addStream,e&&e.close(),{audioVideo:n,data:r,binaryBlob:o,binary:i,reliable:i,sctp:i,onnegotiationneeded:a}}(),f.pack=i.pack,f.unpack=i.unpack,f._dataCount=1,f);function f(){}r.util=a},{"js-binarypack":"lHOc","./adapter":"sXtV"}],"2JJl":[function(e,t,r){var n=Object.prototype.hasOwnProperty,h="~";function o(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var i=new s(r,n||e,o),a=h?h+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],i]:e._events[a].push(i):(e._events[a]=i,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(h=!1)),a.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(h?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=h?h+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,i=new Array(o);n<o;n++)i[n]=r[n].fn;return i},a.prototype.listenerCount=function(e){var t=h?h+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,n,o,i){var a=h?h+e:e;if(!this._events[a])return!1;var s,c,u=this._events[a],f=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),f){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,o),!0;case 6:return u.fn.call(u.context,t,r,n,o,i),!0}for(c=1,s=new Array(f-1);c<f;c++)s[c-1]=arguments[c];u.fn.apply(u.context,s)}else{var p,l=u.length;for(c=0;c<l;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),f){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,n);break;default:if(!s)for(p=1,s=new Array(f-1);p<f;p++)s[p-1]=arguments[p];u[c].fn.apply(u[c].context,s)}}return!0},a.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,r,n){var o=h?h+e:e;if(!this._events[o])return this;if(!t)return u(this,o),this;var i=this._events[o];if(i.fn)i.fn!==t||n&&!i.once||r&&i.context!==r||u(this,o);else{for(var a=0,s=[],c=i.length;a<c;a++)(i[a].fn!==t||n&&!i[a].once||r&&i[a].context!==r)&&s.push(i[a]);s.length?this._events[o]=1===s.length?s[0]:s:u(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=h?h+e:e,this._events[t]&&u(this,t)):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=h,a.EventEmitter=a,void 0!==t&&(t.exports=a)},{}],"8WOs":[function(e,t,r){var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(r,"__esModule",{value:!0});var a,o;(o=a=r.LogLevel||(r.LogLevel={}))[o.Disabled=0]="Disabled",o[o.Errors=1]="Errors",o[o.Warnings=2]="Warnings",o[o.All=3]="All";var s=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!0,configurable:!0}),c.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=a.All&&this._print.apply(this,i([a.All],e))},c.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=a.Warnings&&this._print.apply(this,i([a.Warnings],e))},c.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=a.Errors&&this._print.apply(this,i([a.Errors],e))},c.prototype.setLogFunction=function(e){this._print=e},c.prototype._print=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=i(["PeerJS: "],t);for(var o in n)n[o]instanceof Error&&(n[o]="("+n[o].name+") "+n[o].message);a.All<=e?console.log.apply(console,i(n)):a.Warnings<=e?console.warn.apply(console,i(["WARNING"],n)):a.Errors<=e&&console.error.apply(console,i(["ERROR"],n))},c);function c(){this._logLevel=a.Disabled}r.default=new s},{}],"9ZRY":[function(e,t,r){var n,o,i,a,s,c,u;Object.defineProperty(r,"__esModule",{value:!0}),(u=r.ConnectionEventType||(r.ConnectionEventType={})).Open="open",u.Stream="stream",u.Data="data",u.Close="close",u.Error="error",u.IceStateChanged="iceStateChanged",(c=r.ConnectionType||(r.ConnectionType={})).Data="data",c.Media="media",(s=r.PeerEventType||(r.PeerEventType={})).Open="open",s.Close="close",s.Connection="connection",s.Call="call",s.Disconnected="disconnected",s.Error="error",(a=r.PeerErrorType||(r.PeerErrorType={})).BrowserIncompatible="browser-incompatible",a.Disconnected="disconnected",a.InvalidID="invalid-id",a.InvalidKey="invalid-key",a.Network="network",a.PeerUnavailable="peer-unavailable",a.SslUnavailable="ssl-unavailable",a.ServerError="server-error",a.SocketError="socket-error",a.SocketClosed="socket-closed",a.UnavailableID="unavailable-id",a.WebRTC="webrtc",(i=r.SerializationType||(r.SerializationType={})).Binary="binary",i.BinaryUTF8="binary-utf8",i.JSON="json",(o=r.SocketEventType||(r.SocketEventType={})).Message="message",o.Disconnected="disconnected",o.Error="error",o.Close="close",(n=r.ServerMessageType||(r.ServerMessageType={})).Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"},{}],wJlv:[function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u,f=e("eventemitter3"),p=c(e("./logger")),l=e("./enums"),h=(u=f.EventEmitter,o(d,u),d.prototype.start=function(e,t){this._id=e,this._wsUrl+="&id="+e+"&token="+t,this._startWebSocket()},d.prototype._startWebSocket=function(){var r=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(t){var e;try{e=JSON.parse(t.data)}catch(e){return void p.default.log("Invalid server message",t.data)}r.emit(l.SocketEventType.Message,e)},this._socket.onclose=function(e){p.default.log("Socket closed.",e),r._disconnected=!0,clearTimeout(r._wsPingTimer),r.emit(l.SocketEventType.Disconnected)},this._socket.onopen=function(){r._disconnected||(r._sendQueuedMessages(),p.default.log("Socket open"),r._scheduleHeartbeat())})},d.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},d.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:l.ServerMessageType.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else p.default.log("Cannot send heartbeat, because socket closed")},d.prototype._wsOpen=function(){return!!this._socket&&1==this._socket.readyState},d.prototype._sendQueuedMessages=function(){var t,e,r=a(this._messagesQueue);this._messagesQueue=[];try{for(var n=s(r),o=n.next();!o.done;o=n.next()){var i=o.value;this.send(i)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},d.prototype.send=function(e){if(!this._disconnected)if(this._id)if(e.type){if(this._wsOpen()){var t=JSON.stringify(e);this._socket.send(t)}}else this.emit(l.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(e)},d.prototype.close=function(){!this._disconnected&&this._socket&&(this._socket.close(),this._disconnected=!0,clearTimeout(this._wsPingTimer))},d);function d(e,t,r,n,o,i){void 0===i&&(i=5e3);var a=u.call(this)||this;a.pingInterval=i,a._disconnected=!1,a._messagesQueue=[];var s=e?"wss://":"ws://";return a._wsUrl=s+t+":"+r+n+"peerjs?key="+o,a}r.Socket=h},{eventemitter3:"2JJl","./logger":"8WOs","./enums":"9ZRY"}],T9kO:[function(e,t,r){var n,o,i,a=e("js-binarypack"),s={debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},pack:a.pack,unpack:a.unpack,log:function(){if(s.debug){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.unshift("Reliable: "),console.log.apply(console,e)}},setZeroTimeout:(o=[],i="zero-timeout-message",(n=this).addEventListener?n.addEventListener("message",c,!0):n.attachEvent&&n.attachEvent("onmessage",c),function(e){o.push(e),n.postMessage(i,"*")}),blobToArrayBuffer:function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};function c(e){e.source==n&&e.data==i&&(e.stopPropagation&&e.stopPropagation(),o.length&&o.shift()())}t.exports=s},{"js-binarypack":"lHOc"}],aYFJ:[function(e,t,r){var c=e("./util");function n(e,t){if(!(this instanceof n))return new n(e);this._dc=e,c.debug=t,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC()}n.prototype.send=function(e){var t=c.pack(e);t.size<this._mtu?this._handleSend(["no",t]):(this._outgoing[this._count]={ack:0,chunks:this._chunk(t)},c.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1)},n.prototype._setupInterval=function(){var n=this;this._timeout=setInterval(function(){var e=n._queue.shift();if(e._multiple)for(var t=0,r=e.length;t<r;t+=1)n._intervalSend(e[t]);else n._intervalSend(e)},this._interval)},n.prototype._intervalSend=function(e){var t=this;e=c.pack(e),c.blobToBinaryString(e,function(e){t._dc.send(e)}),0===t._queue.length&&(clearTimeout(t._timeout),t._timeout=null)},n.prototype._processAcks=function(){for(var e in this._outgoing)this._outgoing.hasOwnProperty(e)&&this._sendWindowedChunks(e)},n.prototype._handleSend=function(e){for(var t=!0,r=0,n=this._queue.length;r<n;r+=1){var o=this._queue[r];o===e?t=!1:o._multiple&&-1!==o.indexOf(e)&&(t=!1)}t&&(this._queue.push(e),this._timeout||this._setupInterval())},n.prototype._setupDC=function(){var n=this;this._dc.onmessage=function(e){var t=e.data;if(t.constructor===String){var r=c.binaryStringToArrayBuffer(t);t=c.unpack(r),n._handleMessage(t)}}},n.prototype._handleMessage=function(e){var t,r=e[1],n=this._incoming[r],o=this._outgoing[r];switch(e[0]){case"no":r&&this.onmessage(c.unpack(r));break;case"end":if(t=n,this._received[r]=e[2],!t)break;this._ack(r);break;case"ack":if(t=o){var i=e[2];t.ack=Math.max(i,t.ack),t.ack>=t.chunks.length?(c.log("Time: ",new Date-t.timer),delete this._outgoing[r]):this._processAcks()}break;case"chunk":if(!(t=n)){if(!0===this._received[r])break;t={ack:["ack",r,0],chunks:[]},this._incoming[r]=t}var a=e[2],s=e[3];t.chunks[a]=new Uint8Array(s),a===t.ack[2]&&this._calculateNextAck(r),this._ack(r);break;default:this._handleSend(e)}},n.prototype._chunk=function(e){for(var t=[],r=e.size,n=0;n<r;){var o=Math.min(r,n+this._mtu),i={payload:e.slice(n,o)};t.push(i),n=o}return c.log("Created",t.length,"chunks."),t},n.prototype._ack=function(e){var t=this._incoming[e].ack;this._received[e]===t[2]&&(this._complete(e),this._received[e]=!0),this._handleSend(t)},n.prototype._calculateNextAck=function(e){for(var t=this._incoming[e],r=t.chunks,n=0,o=r.length;n<o;n+=1)if(void 0===r[n])return void(t.ack[2]=n);t.ack[2]=r.length},n.prototype._sendWindowedChunks=function(e){c.log("sendWindowedChunks for: ",e);for(var t=this._outgoing[e],r=t.chunks,n=[],o=Math.min(t.ack+this._window,r.length),i=t.ack;i<o;i+=1)r[i].sent&&i!==t.ack||(r[i].sent=!0,n.push(["chunk",e,i,r[i].payload]));t.ack+this._window>=r.length&&n.push(["end",e,r.length]),n._multiple=!0,this._handleSend(n)},n.prototype._complete=function(e){c.log("Completed called for",e);var t=this,r=this._incoming[e].chunks,n=new Blob(r);c.blobToArrayBuffer(n,function(e){t.onmessage(c.unpack(e))}),delete this._incoming[e]},n.higherBandwidthSDP=function(e){var t=navigator.appVersion.match(/Chrome\/(.*?) /);if(t&&(t=parseInt(t[1].split(".").shift()))<31){var r=e.split("b=AS:30");if(1<r.length)return r[0]+"b=AS:102400"+r[1]}return e},n.prototype.onmessage=function(e){},t.exports=n},{"./util":"T9kO"}],HCdX:[function(e,t,r){var c=this&&this.__assign||function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},n=this&&this.__awaiter||function(i,a,s,c){return new(s=s||Promise)(function(e,t){function r(e){try{o(c.next(e))}catch(e){t(e)}}function n(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(r,n)}o((c=c.apply(i,a||[])).next())})},u=this&&this.__generator||function(r,n){var o,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var f=o(e("reliable")),p=e("./util"),l=i(e("./logger")),h=e("./adapter"),d=e("./enums"),a=(s.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===d.ConnectionType.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===d.ConnectionType.Data){var r=this.connection,n={};p.util.supports.sctp||(n={reliable:e.reliable});var o=t.createDataChannel(r.label,n);r.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},s.prototype._startPeerConnection=function(){l.default.log("Creating RTCPeerConnection.");var e={};this.connection.type!==d.ConnectionType.Data||p.util.supports.sctp?this.connection.type===d.ConnectionType.Media&&(e={optional:[{DtlsSrtpKeyAgreement:!0}]}):e={optional:[{RtpDataChannels:!0}]};var t=new h.RTCPeerConnection(this.connection.provider.options.config,e);return this._setupListeners(t),t},s.prototype._setupListeners=function(e){var o=this,i=this.connection.peer,a=this.connection.connectionId,t=this.connection.type,s=this.connection.provider;l.default.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&(l.default.log("Received ICE candidates for:",i),s.socket.send({type:d.ServerMessageType.Candidate,payload:{candidate:e.candidate,type:t,connectionId:a},dst:i}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":l.default.log("iceConnectionState is failed, closing connections to "+i),o.connection.emit(d.ConnectionEventType.Error,new Error("Negotiation of connection to "+i+" failed.")),o.connection.close();break;case"closed":l.default.log("iceConnectionState is closed, closing connections to "+i),o.connection.emit(d.ConnectionEventType.Error,new Error("Connection to "+i+" closed.")),o.connection.close();break;case"disconnected":l.default.log("iceConnectionState is disconnected, closing connections to "+i),o.connection.emit(d.ConnectionEventType.Error,new Error("Connection to "+i+" disconnected.")),o.connection.close();break;case"completed":e.onicecandidate=p.util.noop}o.connection.emit(d.ConnectionEventType.IceStateChanged,e.iceConnectionState)},l.default.log("Listening for data channel"),e.ondatachannel=function(e){l.default.log("Received data channel");var t=e.channel;s.getConnection(i,a).initialize(t)},l.default.log("Listening for remote stream"),e.ontrack=function(e){l.default.log("Received remote stream");var t=e.streams[0],r=s.getConnection(i,a);if(r.type===d.ConnectionType.Media){var n=r;o._addStreamToMediaConnection(t,n)}}},s.prototype.cleanup=function(){l.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t="closed"!==e.signalingState,r=!1;if(this.connection.type===d.ConnectionType.Data){var n=this.connection.dataChannel;n&&(r=!!n.readyState&&"closed"!==n.readyState)}(t||r)&&e.close()}},s.prototype._makeOffer=function(){return n(this,void 0,Promise,function(){var t,r,n,o,i,a,s;return u(this,function(e){switch(e.label){case 0:t=this.connection.peerConnection,r=this.connection.provider,e.label=1;case 1:return e.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:n=e.sent(),l.default.log("Created offer."),p.util.supports.sctp||this.connection.type!==d.ConnectionType.Data||(i=this.connection).reliable&&(n.sdp=f.higherBandwidthSDP(n.sdp)),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),e.label=3;case 3:return e.trys.push([3,5,,6]),[4,t.setLocalDescription(n)];case 4:return e.sent(),l.default.log("Set localDescription:",n,"for:"+this.connection.peer),o={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:p.util.browser},this.connection.type===d.ConnectionType.Data&&(i=this.connection,o=c({},o,{label:i.label,reliable:i.reliable,serialization:i.serialization})),r.socket.send({type:d.ServerMessageType.Offer,payload:o,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(a=e.sent())&&(r.emitError(d.PeerErrorType.WebRTC,a),l.default.log("Failed to setLocalDescription, ",a)),[3,6];case 6:return[3,8];case 7:return s=e.sent(),r.emitError(d.PeerErrorType.WebRTC,s),l.default.log("Failed to createOffer, ",s),[3,8];case 8:return[2]}})})},s.prototype._makeAnswer=function(){return n(this,void 0,Promise,function(){var t,r,n,o,i;return u(this,function(e){switch(e.label){case 0:t=this.connection.peerConnection,r=this.connection.provider,e.label=1;case 1:return e.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:n=e.sent(),l.default.log("Created answer."),p.util.supports.sctp||this.connection.type!==d.ConnectionType.Data||this.connection.reliable&&(n.sdp=f.higherBandwidthSDP(n.sdp)),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),e.label=3;case 3:return e.trys.push([3,5,,6]),[4,t.setLocalDescription(n)];case 4:return e.sent(),l.default.log("Set localDescription:",n,"for:"+this.connection.peer),r.socket.send({type:d.ServerMessageType.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:p.util.browser},dst:this.connection.peer}),[3,6];case 5:return o=e.sent(),r.emitError(d.PeerErrorType.WebRTC,o),l.default.log("Failed to setLocalDescription, ",o),[3,6];case 6:return[3,8];case 7:return i=e.sent(),r.emitError(d.PeerErrorType.WebRTC,i),l.default.log("Failed to create answer, ",i),[3,8];case 8:return[2]}})})},s.prototype.handleSDP=function(i,a){return n(this,void 0,Promise,function(){var t,r,n,o;return u(this,function(e){switch(e.label){case 0:a=new h.RTCSessionDescription(a),t=this.connection.peerConnection,r=this.connection.provider,l.default.log("Setting remote description",a),n=this,e.label=1;case 1:return e.trys.push([1,5,,6]),[4,t.setRemoteDescription(a)];case 2:return e.sent(),l.default.log("Set remoteDescription:"+i+" for:"+this.connection.peer),"OFFER"!==i?[3,4]:[4,n._makeAnswer()];case 3:e.sent(),e.label=4;case 4:return[3,6];case 5:return o=e.sent(),r.emitError(d.PeerErrorType.WebRTC,o),l.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},s.prototype.handleCandidate=function(s){return n(this,void 0,Promise,function(){var t,r,n,o,i,a;return u(this,function(e){switch(e.label){case 0:t=s.candidate,r=s.sdpMLineIndex,n=s.sdpMid,o=this.connection.peerConnection,i=this.connection.provider,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,o.addIceCandidate(new h.RTCIceCandidate({sdpMid:n,sdpMLineIndex:r,candidate:t}))];case 2:return e.sent(),l.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return a=e.sent(),i.emitError(d.PeerErrorType.WebRTC,a),l.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},s.prototype._addTracksToConnection=function(t,r){if(l.default.log("add tracks from stream "+t.id+" to peer connection"),!r.addTrack)return l.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(e){r.addTrack(e,t)})},s.prototype._addStreamToMediaConnection=function(e,t){l.default.log("add stream "+e.id+" to media connection "+t.connectionId),t.addStream(e)},s);function s(e){this.connection=e}r.Negotiator=a},{reliable:"aYFJ","./util":"BHXf","./logger":"8WOs","./adapter":"sXtV","./enums":"9ZRY"}],tQFK:[function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i,a=e("eventemitter3"),s=(i=a.EventEmitter,o(c,i),Object.defineProperty(c.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),c);function c(e,t,r){var n=i.call(this)||this;return n.peer=e,n.provider=t,n.options=r,n._open=!1,n.metadata=r.metadata,n}r.BaseConnection=s},{eventemitter3:"2JJl"}],dbHP:[function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),c=this&&this.__assign||function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},u=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a,s=e("./util"),f=i(e("./logger")),p=e("./negotiator"),l=e("./enums"),h=e("./baseconnection"),d=(a=h.BaseConnection,o(y,a),Object.defineProperty(y.prototype,"type",{get:function(){return l.ConnectionType.Media},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"localStream",{get:function(){return this._localStream},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!0,configurable:!0}),y.prototype.addStream=function(e){f.default.log("Receiving stream",e),this._remoteStream=e,a.prototype.emit.call(this,l.ConnectionEventType.Stream,e)},y.prototype.handleMessage=function(e){var t=e.type,r=e.payload;switch(e.type){case l.ServerMessageType.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case l.ServerMessageType.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:f.default.warn("Unrecognized message type:"+t+" from peer:"+this.peer)}},y.prototype.answer=function(e,t){var r,n;if(void 0===t&&(t={}),this._localStream)f.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection(c({},this.options._payload,{_stream:e}));var o=this.provider._getMessages(this.connectionId);try{for(var i=u(o),a=i.next();!a.done;a=i.next()){var s=a.value;this.handleMessage(s)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this._open=!0}},y.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,a.prototype.emit.call(this,l.ConnectionEventType.Close))},y.ID_PREFIX="mc_",y);function y(e,t,r){var n=a.call(this,e,t,r)||this;return n._localStream=n.options._stream,n.connectionId=n.options.connectionId||y.ID_PREFIX+s.util.randomToken(),n._negotiator=new p.Negotiator(n),n._localStream&&n._negotiator.startConnection({_stream:n._localStream,originator:!0}),n}r.MediaConnection=d},{"./util":"BHXf","./logger":"8WOs","./negotiator":"HCdX","./enums":"9ZRY","./baseconnection":"tQFK"}],GBTQ:[function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var a,c=e("reliable"),u=e("./util"),f=i(e("./logger")),p=e("./negotiator"),l=e("./enums"),h=e("./baseconnection"),d=(a=h.BaseConnection,o(y,a),Object.defineProperty(y.prototype,"type",{get:function(){return l.ConnectionType.Data},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!0,configurable:!0}),y.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},y.prototype._configureDataChannel=function(){var t=this;if(u.util.supports.sctp&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){f.default.log("Data channel connection success"),t._open=!0,t.emit(l.ConnectionEventType.Open)},!u.util.supports.sctp&&this.reliable){var e=f.default.logLevel>f.LogLevel.Disabled;this._reliable=new c.Reliable(this.dataChannel,e)}this._reliable?this._reliable.onmessage=function(e){t.emit(l.ConnectionEventType.Data,e)}:this.dataChannel.onmessage=function(e){t._handleDataMessage(e)},this.dataChannel.onclose=function(){f.default.log("DataChannel closed for:",t.peer),t.close()}},y.prototype._handleDataMessage=function(e){var r=this,t=e.data,n=t.constructor,o=t;if(this.serialization===l.SerializationType.Binary||this.serialization===l.SerializationType.BinaryUTF8){if(n===Blob)return void u.util.blobToArrayBuffer(t,function(e){var t=u.util.unpack(e);r.emit(l.ConnectionEventType.Data,t)});if(n===ArrayBuffer)o=u.util.unpack(t);else if(n===String){var i=u.util.binaryStringToArrayBuffer(t);o=u.util.unpack(i)}}else this.serialization===l.SerializationType.JSON&&(o=JSON.parse(t));o.__peerData?this._handleChunk(o):a.prototype.emit.call(this,l.ConnectionEventType.Data,o)},y.prototype._handleChunk=function(e){var t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=e.data,r.count++,(this._chunkedData[t]=r).total===r.count){delete this._chunkedData[t];var n=new Blob(r.data);this._handleDataMessage({data:n})}},y.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.open&&(this._open=!1,a.prototype.emit.call(this,l.ConnectionEventType.Close))},y.prototype.send=function(e,t){var r=this;if(this.open)if(this._reliable)this._reliable.send(e);else if(this.serialization===l.SerializationType.JSON)this._bufferedSend(JSON.stringify(e));else if(this.serialization===l.SerializationType.Binary||this.serialization===l.SerializationType.BinaryUTF8){var n=u.util.pack(e);if((u.util.chunkedBrowsers[this._peerBrowser]||u.util.chunkedBrowsers[u.util.browser])&&!t&&n.size>u.util.chunkedMTU)return void this._sendChunks(n);u.util.supports.sctp?u.util.supports.binaryBlob?this._bufferedSend(n):u.util.blobToArrayBuffer(n,function(e){r._bufferedSend(e)}):u.util.blobToBinaryString(n,function(e){r._bufferedSend(e)})}else this._bufferedSend(e);else a.prototype.emit.call(this,l.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},y.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)},y.prototype._trySend=function(e){var t=this;if(!this.open)return!1;try{this.dataChannel.send(e)}catch(e){return this._buffering=!0,setTimeout(function(){t._buffering=!1,t._tryBuffer()},100),!1}return!0},y.prototype._tryBuffer=function(){if(this.open&&0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},y.prototype._sendChunks=function(e){var t,r,n=u.util.chunk(e);try{for(var o=s(n),i=o.next();!i.done;i=o.next()){var a=i.value;this.send(a,!0)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},y.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case l.ServerMessageType.Answer:this._peerBrowser=t.browser,this._negotiator.handleSDP(e.type,t.sdp);break;case l.ServerMessageType.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:f.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},y.ID_PREFIX="dc_",y);function y(e,t,r){var n=a.call(this,e,t,r)||this;return n._buffer=[],n._bufferSize=0,n._buffering=!1,n._chunkedData={},n.connectionId=n.options.connectionId||y.ID_PREFIX+u.util.randomToken(),n.label=n.options.label||n.connectionId,n.serialization=n.options.serialization||l.SerializationType.Binary,n.reliable=n.options.reliable,n.options._payload&&(n._peerBrowser=n.options._payload.browser),n._negotiator=new p.Negotiator(n),n._negotiator.startConnection(n.options._payload||{originator:!0}),n}r.DataConnection=d},{reliable:"aYFJ","./util":"BHXf","./logger":"8WOs","./negotiator":"HCdX","./enums":"9ZRY","./baseconnection":"tQFK"}],in7L:[function(e,t,r){var n=this&&this.__awaiter||function(i,a,s,c){return new(s=s||Promise)(function(e,t){function r(e){try{o(c.next(e))}catch(e){t(e)}}function n(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(r,n)}o((c=c.apply(i,a||[])).next())})},i=this&&this.__generator||function(r,n){var o,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a=e("./util"),s=o(e("./logger")),c=(u.prototype._buildUrl=function(e){return(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+e+"?ts="+(new Date).getTime()+Math.random()},u.prototype.retrieveId=function(){return n(this,void 0,Promise,function(){var t,r,n,o;return i(this,function(e){switch(e.label){case 0:t=this._buildUrl("id"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,fetch(t)];case 2:if(200!==(r=e.sent()).status)throw new Error("Error. Status:"+r.status);return[2,r.text()];case 3:throw n=e.sent(),s.default.error("Error retrieving ID",n),o="","/"===this._options.path&&this._options.host!==a.util.CLOUD_HOST&&(o=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+o);case 4:return[2]}})})},u.prototype.listAllPeers=function(){return n(this,void 0,Promise,function(){var t,r,n,o;return i(this,function(e){switch(e.label){case 0:t=this._buildUrl("peers"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,fetch(t)];case 2:if(200===(r=e.sent()).status)return[2,r.json()];if(401===r.status)throw n=this._options.host===a.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n);throw new Error("Error. Status:"+r.status);case 3:throw o=e.sent(),s.default.error("Error retrieving list peers",o),new Error("Could not get list peers from the server."+o);case 4:return[2]}})})},u);function u(e){this._options=e}r.API=c},{"./util":"BHXf","./logger":"8WOs"}],Hxpd:[function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,u=e("eventemitter3"),f=e("./util"),h=a(e("./logger")),p=e("./socket"),d=e("./mediaconnection"),y=e("./dataconnection"),m=e("./enums"),g=e("./api"),v=(s=u.EventEmitter,o(_,s),Object.defineProperty(_.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"socket",{get:function(){return this._socket},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"connections",{get:function(){var t,e,r=Object.create(null);try{for(var n=l(this._connections),o=n.next();!o.done;o=n.next()){var i=c(o.value,2),a=i[0],s=i[1];r[a]=s}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return r},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!0,configurable:!0}),_.prototype._initializeServerConnection=function(){var t=this;this._socket=new p.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval),this.socket.on(m.SocketEventType.Message,function(e){t._handleMessage(e)}),this.socket.on(m.SocketEventType.Error,function(e){t._abort(m.PeerErrorType.SocketError,e)}),this.socket.on(m.SocketEventType.Disconnected,function(){t.disconnected||(t.emitError(m.PeerErrorType.Network,"Lost connection to server."),t.disconnect())}),this.socket.on(m.SocketEventType.Close,function(){t.disconnected||t._abort(m.PeerErrorType.SocketClosed,"Underlying socket is already closed.")})},_.prototype._initialize=function(e){this._id=e,this.socket.start(this.id,this._options.token)},_.prototype._handleMessage=function(e){var t,r,n=e.type,o=e.payload,i=e.src;switch(n){case m.ServerMessageType.Open:this.emit(m.PeerEventType.Open,this.id),this._open=!0;break;case m.ServerMessageType.Error:this._abort(m.PeerErrorType.ServerError,o.msg);break;case m.ServerMessageType.IdTaken:this._abort(m.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case m.ServerMessageType.InvalidKey:this._abort(m.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case m.ServerMessageType.Leave:h.default.log("Received leave message from",i),this._cleanupPeer(i),this._connections.delete(i);break;case m.ServerMessageType.Expire:this.emitError(m.PeerErrorType.PeerUnavailable,"Could not connect to peer "+i);break;case m.ServerMessageType.Offer:var a=o.connectionId;if((p=this.getConnection(i,a))&&(p.close(),h.default.warn("Offer received for existing Connection ID:",a)),o.type===m.ConnectionType.Media)p=new d.MediaConnection(i,this,{connectionId:a,_payload:o,metadata:o.metadata}),this._addConnection(i,p),this.emit(m.PeerEventType.Call,p);else{if(o.type!==m.ConnectionType.Data)return void h.default.warn("Received malformed connection type:",o.type);p=new y.DataConnection(i,this,{connectionId:a,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable}),this._addConnection(i,p),this.emit(m.PeerEventType.Connection,p)}var s=this._getMessages(a);try{for(var c=l(s),u=c.next();!u.done;u=c.next()){var f=u.value;p.handleMessage(f)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}break;default:if(!o)return void h.default.warn("You received a malformed message from "+i+" of type "+n);var p;a=o.connectionId,(p=this.getConnection(i,a))&&p.peerConnection?p.handleMessage(e):a?this._storeMessage(a,e):h.default.warn("You received an unrecognized message:",e)}},_.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},_.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},_.prototype.connect=function(e,t){if(void 0===t&&(t={}),this.disconnected)return h.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(m.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var r=new y.DataConnection(e,this,t);return this._addConnection(e,r),r},_.prototype.call=function(e,t,r){if(void 0===r&&(r={}),this.disconnected)return h.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(m.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(t){r._stream=t;var n=new d.MediaConnection(e,this,r);return this._addConnection(e,n),n}h.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},_.prototype._addConnection=function(e,t){h.default.log("add connection "+t.type+":"+t.connectionId+"\n       to peerId:"+e),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)},_.prototype._removeConnection=function(e){var t=this._connections.get(e.peer);if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)},_.prototype.getConnection=function(e,t){var r,n,o=this._connections.get(e);if(!o)return null;try{for(var i=l(o),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.connectionId===t)return s}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return null},_.prototype._delayedAbort=function(e,t){var r=this;setTimeout(function(){r._abort(e,t)},0)},_.prototype._abort=function(e,t){h.default.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(e,t)},_.prototype.emitError=function(e,t){h.default.error("Error:",t),"string"==typeof t&&(t=new Error(t)),t.type=e,this.emit(m.PeerEventType.Error,t)},_.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this._destroyed=!0)},_.prototype._cleanup=function(){var t,e;try{for(var r=l(this._connections.keys()),n=r.next();!n.done;n=r.next()){var o=n.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this.emit(m.PeerEventType.Close)},_.prototype._cleanupPeer=function(e){var t,r,n=this._connections.get(e);if(n)try{for(var o=l(n),i=o.next();!i.done;i=o.next())i.value.close()}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},_.prototype.disconnect=function(){var e=this;setTimeout(function(){e.disconnected||(e._disconnected=!0,e._open=!1,e.socket&&e.socket.close(),e.emit(m.PeerEventType.Disconnected,e.id),e._lastServerId=e.id,e._id=null)},0)},_.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)h.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");h.default.error("In a hurry? We're still trying to make the initial connection!")}},_.prototype.listAllPeers=function(t){var r=this;void 0===t&&(t=function(e){}),this._api.listAllPeers().then(function(e){return t(e)}).catch(function(e){return r._abort(m.PeerErrorType.ServerError,e)})},_.DEFAULT_KEY="peerjs",_);function _(e,t){var r=s.call(this)||this;return r._destroyed=!1,r._disconnected=!1,r._open=!1,r._connections=new Map,r._lostMessages=new Map,e=e&&e.constructor==Object?void(t=e):e&&e.toString(),t=i({debug:0,host:f.util.CLOUD_HOST,port:f.util.CLOUD_PORT,path:"/",key:_.DEFAULT_KEY,token:f.util.randomToken(),config:f.util.defaultConfig},t),"/"===(r._options=t).host&&(t.host=window.location.hostname),"/"!==t.path[0]&&(t.path="/"+t.path),"/"!==t.path[t.path.length-1]&&(t.path+="/"),void 0===t.secure&&t.host!==f.util.CLOUD_HOST?t.secure=f.util.isSecure():t.host==f.util.CLOUD_HOST&&(t.secure=!0),t.logFunction&&h.default.setLogFunction(t.logFunction),h.default.logLevel=t.debug,f.util.supports.audioVideo||f.util.supports.data?f.util.validateId(e)?(r._api=new g.API(t),r._initializeServerConnection(),e?r._initialize(e):r._api.retrieveId().then(function(e){return r._initialize(e)}).catch(function(e){return r._abort(m.PeerErrorType.ServerError,e)})):r._delayedAbort(m.PeerErrorType.InvalidID,'ID "'+e+'" is invalid'):r._delayedAbort(m.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),r}r.Peer=v},{eventemitter3:"2JJl","./util":"BHXf","./logger":"8WOs","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"9ZRY","./api":"in7L"}],iTK6:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./util"),o=e("./peer");r.peerjs={Peer:o.Peer,util:n.util},r.default=o.Peer,window.peerjs=r.peerjs,window.Peer=o.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"])}),dc=(fc=hc)&&fc.__esModule&&Object.prototype.hasOwnProperty.call(fc,"default")?fc.default:fc,yc=e(function(e){function M(e){var t=0|e;return 0<e||e===t?t:t-1}function j(e){for(var t,r,n=1,o=e.length,i=e[0]+"";n<o;){for(t=e[n++]+"",r=X-t.length;r--;t="0"+t);i+=t}for(o=i.length;48===i.charCodeAt(--o););return i.slice(0,o+1||1)}function q(e,t){var r,n,o=e.c,i=t.c,a=e.s,s=t.s,c=e.e,u=t.e;if(!a||!s)return null;if(r=o&&!o[0],n=i&&!i[0],r||n)return r?n?0:-s:a;if(a!=s)return a;if(r=a<0,n=c==u,!o||!i)return n?0:!o^r?1:-1;if(!n)return u<c^r?1:-1;for(s=(c=o.length)<(u=i.length)?c:u,a=0;a<s;a++)if(o[a]!=i[a])return o[a]>i[a]^r?1:-1;return c==u?0:u<c^r?1:-1}function F(e,t,r,n){if(e<t||r<e||e!==(e<0?W:V)(e))throw Error(G+(n||"Argument")+("number"==typeof e?e<t||r<e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function L(e){var t=e.c.length-1;return M(e.e/X)==t&&e.c[t]%2!=0}function U(e,t){return(1<e.length?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function z(e,t,r){var n,o;if(t<0){for(o=r+".";++t;o+=r);e=o+e}else if(++t>(n=e.length)){for(o=r,t-=n;--t;o+=r);e+=o}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}var t,r,H,W,V,G,J,Y,X,K,$,Q,Z;t=_,H=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,W=Math.ceil,V=Math.floor,J=(G="[BigNumber Error] ")+"Number primitive has more than 15 significant digits: ",Y=1e14,X=14,K=9007199254740991,$=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Q=1e7,Z=1e9,(r=function e(t){var m,p,l,r,u,g,a,s,c,f,h,n=T.prototype={constructor:T,toString:null,valueOf:null},y=new T(1),v=20,_=4,d=-7,o=21,b=-1e7,w=1e7,k=!1,i=1,x=0,S={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},C="0123456789abcdefghijklmnopqrstuvwxyz";function T(e,t){var r,n,o,i,a,s,c,u,f=this;if(!(f instanceof T))return new T(e,t);if(null==t){if(e instanceof T)return f.s=e.s,f.e=e.e,void(f.c=(e=e.c)?e.slice():e);if((s="number"==typeof e)&&0*e==0){if(f.s=1/e<0?(e=-e,-1):1,e===~~e){for(i=0,a=e;10<=a;a/=10,i++);return f.e=i,void(f.c=[e])}u=String(e)}else{if(u=String(e),!H.test(u))return l(f,u,s);f.s=45==u.charCodeAt(0)?(u=u.slice(1),-1):1}-1<(i=u.indexOf("."))&&(u=u.replace(".","")),0<(a=u.search(/e/i))?(i<0&&(i=a),i+=+u.slice(a+1),u=u.substring(0,a)):i<0&&(i=u.length)}else{if(F(t,2,C.length,"Base"),u=String(e),10==t)return N(f=new T(e instanceof T?e:u),v+f.e+1,_);if(s="number"==typeof e){if(0*e!=0)return l(f,u,s,t);if(f.s=1/e<0?(u=u.slice(1),-1):1,T.DEBUG&&15<u.replace(/^0\.0*|\./,"").length)throw Error(J+e);s=!1}else f.s=45===u.charCodeAt(0)?(u=u.slice(1),-1):1;for(r=C.slice(0,t),i=a=0,c=u.length;a<c;a++)if(r.indexOf(n=u.charAt(a))<0){if("."==n){if(i<a){i=c;continue}}else if(!o&&(u==u.toUpperCase()&&(u=u.toLowerCase())||u==u.toLowerCase()&&(u=u.toUpperCase()))){o=!0,a=-1,i=0;continue}return l(f,String(e),s,t)}-1<(i=(u=p(u,t,10,f.s)).indexOf("."))?u=u.replace(".",""):i=u.length}for(a=0;48===u.charCodeAt(a);a++);for(c=u.length;48===u.charCodeAt(--c););if(u=u.slice(a,++c)){if(c-=a,s&&T.DEBUG&&15<c&&(K<e||e!==V(e)))throw Error(J+f.s*e);if(w<(i=i-a-1))f.c=f.e=null;else if(i<b)f.c=[f.e=0];else{if(f.e=i,f.c=[],a=(i+1)%X,i<0&&(a+=X),a<c){for(a&&f.c.push(+u.slice(0,a)),c-=X;a<c;)f.c.push(+u.slice(a,a+=X));u=u.slice(a),a=X-u.length}else a-=c;for(;a--;u+="0");f.c.push(+u)}}else f.c=[f.e=0]}function E(e,t,r,n){for(var o,i,a=[0],s=0,c=e.length;s<c;){for(i=a.length;i--;a[i]*=t);for(a[0]+=n.indexOf(e.charAt(s++)),o=0;o<a.length;o++)a[o]>r-1&&(null==a[o+1]&&(a[o+1]=0),a[o+1]+=a[o]/r|0,a[o]%=r)}return a.reverse()}function P(e,t,r){var n,o,i,a,s=0,c=e.length,u=t%Q,f=t/Q|0;for(e=e.slice();c--;)s=((o=u*(i=e[c]%Q)+(n=f*i+(a=e[c]/Q|0)*u)%Q*Q+s)/r|0)+(n/Q|0)+f*a,e[c]=o%r;return s&&(e=[s].concat(e)),e}function R(e,t,r,n){var o,i;if(r!=n)i=n<r?1:-1;else for(o=i=0;o<r;o++)if(e[o]!=t[o]){i=e[o]>t[o]?1:-1;break}return i}function A(e,t,r,n){for(var o=0;r--;)e[r]-=o,o=e[r]<t[r]?1:0,e[r]=o*n+e[r]-t[r];for(;!e[0]&&1<e.length;e.splice(0,1));}function O(e,t,r,n){var o,i,a,s,c;if(null==r?r=_:F(r,0,8),!e.c)return e.toString();if(o=e.c[0],a=e.e,null==t)c=j(e.c),c=1==n||2==n&&a<=d?U(c,a):z(c,a,"0");else if(i=(e=N(new T(e),t,r)).e,s=(c=j(e.c)).length,1==n||2==n&&(t<=i||i<=d)){for(;s<t;c+="0",s++);c=U(c,i)}else if(t-=a,c=z(c,i,"0"),s<i+1){if(0<--t)for(c+=".";t--;c+="0");}else if(0<(t+=i-s))for(i+1==s&&(c+=".");t--;c+="0");return e.s<0&&o?"-"+c:c}function B(e,t){for(var r,n=1,o=new T(e[0]);n<e.length;n++){if(!(r=new T(e[n])).s){o=r;break}t.call(o,r)&&(o=r)}return o}function I(e,t,r){for(var n=1,o=t.length;!t[--o];t.pop());for(o=t[0];10<=o;o/=10,n++);return(r=n+r*X-1)>w?e.c=e.e=null:r<b?e.c=[e.e=0]:(e.e=r,e.c=t),e}function N(e,t,r,n){var o,i,a,s,c,u,f,p=e.c,l=$;if(p){e:{for(o=1,s=p[0];10<=s;s/=10,o++);if((i=t-o)<0)i+=X,a=t,f=(c=p[u=0])/l[o-a-1]%10|0;else if((u=W((i+1)/X))>=p.length){if(!n)break e;for(;p.length<=u;p.push(0));c=f=0,a=(i%=X)-X+(o=1)}else{for(c=s=p[u],o=1;10<=s;s/=10,o++);f=(a=(i%=X)-X+o)<0?0:c/l[o-a-1]%10|0}if(n=n||t<0||null!=p[u+1]||(a<0?c:c%l[o-a-1]),n=r<4?(f||n)&&(0==r||r==(e.s<0?3:2)):5<f||5==f&&(4==r||n||6==r&&(0<i?0<a?c/l[o-a]:0:p[u-1])%10&1||r==(e.s<0?8:7)),t<1||!p[0])return p.length=0,n?(t-=e.e+1,p[0]=l[(X-t%X)%X],e.e=-t||0):p[0]=e.e=0,e;if(0==i?(p.length=u,s=1,u--):(p.length=u+1,s=l[X-i],p[u]=0<a?V(c/l[o-a]%l[a])*s:0),n)for(;;){if(0==u){for(i=1,a=p[0];10<=a;a/=10,i++);for(a=p[0]+=s,s=1;10<=a;a/=10,s++);i!=s&&(e.e++,p[0]==Y&&(p[0]=1));break}if(p[u]+=s,p[u]!=Y)break;p[u--]=0,s=1}for(i=p.length;0===p[--i];p.pop());}e.e>w?e.c=e.e=null:e.e<b&&(e.c=[e.e=0])}return e}function D(e){var t,r=e.e;return null===r?e.toString():(t=j(e.c),t=r<=d||o<=r?U(t,r):z(t,r,"0"),e.s<0?"-"+t:t)}return T.clone=e,T.ROUND_UP=0,T.ROUND_DOWN=1,T.ROUND_CEIL=2,T.ROUND_FLOOR=3,T.ROUND_HALF_UP=4,T.ROUND_HALF_DOWN=5,T.ROUND_HALF_EVEN=6,T.ROUND_HALF_CEIL=7,T.ROUND_HALF_FLOOR=8,T.EUCLID=9,T.config=T.set=function(e){var t,r;if(null!=e){if("object"!=typeof e)throw Error(G+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(F(r=e[t],0,Z,t),v=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(F(r=e[t],0,8,t),_=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(F(r[0],-Z,0,t),F(r[1],0,Z,t),d=r[0],o=r[1]):(F(r,-Z,Z,t),d=-(o=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)F(r[0],-Z,-1,t),F(r[1],1,Z,t),b=r[0],w=r[1];else{if(F(r,-Z,Z,t),!r)throw Error(G+t+" cannot be zero: "+r);b=-(w=r<0?-r:r)}if(e.hasOwnProperty(t="CRYPTO")){if((r=e[t])!==!!r)throw Error(G+t+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw k=!r,Error(G+"crypto unavailable");k=r}else k=r}if(e.hasOwnProperty(t="MODULO_MODE")&&(F(r=e[t],0,9,t),i=r),e.hasOwnProperty(t="POW_PRECISION")&&(F(r=e[t],0,Z,t),x=r),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(r=e[t]))throw Error(G+t+" not an object: "+r);S=r}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.$|[+-.\s]|(.).*\1/.test(r))throw Error(G+t+" invalid: "+r);C=r}}return{DECIMAL_PLACES:v,ROUNDING_MODE:_,EXPONENTIAL_AT:[d,o],RANGE:[b,w],CRYPTO:k,MODULO_MODE:i,POW_PRECISION:x,FORMAT:S,ALPHABET:C}},T.isBigNumber=function(e){return e instanceof T||e&&!0===e._isBigNumber||!1},T.maximum=T.max=function(){return B(arguments,n.lt)},T.minimum=T.min=function(){return B(arguments,n.gt)},T.random=(r=9007199254740992,u=Math.random()*r&2097151?function(){return V(Math.random()*r)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,o,i,a=0,s=[],c=new T(y);if(null==e?e=v:F(e,0,Z),o=W(e/X),k)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));a<o;)9e15<=(i=131072*t[a]+(t[a+1]>>>11))?(r=crypto.getRandomValues(new Uint32Array(2)),t[a]=r[0],t[a+1]=r[1]):(s.push(i%1e14),a+=2);a=o/2}else{if(!crypto.randomBytes)throw k=!1,Error(G+"crypto unavailable");for(t=crypto.randomBytes(o*=7);a<o;)9e15<=(i=281474976710656*(31&t[a])+1099511627776*t[a+1]+4294967296*t[a+2]+16777216*t[a+3]+(t[a+4]<<16)+(t[a+5]<<8)+t[a+6])?crypto.randomBytes(7).copy(t,a):(s.push(i%1e14),a+=7);a=o/7}if(!k)for(;a<o;)(i=u())<9e15&&(s[a++]=i%1e14);for(o=s[--a],e%=X,o&&e&&(i=$[X-e],s[a]=V(o/i)*i);0===s[a];s.pop(),a--);if(a<0)s=[n=0];else{for(n=-1;0===s[0];s.splice(0,1),n-=X);for(a=1,i=s[0];10<=i;i/=10,a++);a<X&&(n-=X-a)}return c.e=n,c.c=s,c}),T.sum=function(){for(var e=1,t=arguments,r=new T(t[0]);e<t.length;)r=r.plus(t[e++]);return r},g="0123456789",p=function(e,t,r,n,o){var i,a,s,c,u,f,p,l,h=e.indexOf("."),d=v,y=_;for(0<=h&&(c=x,x=0,e=e.replace(".",""),f=(l=new T(t)).pow(e.length-h),x=c,l.c=E(z(j(f.c),f.e,"0"),10,r,g),l.e=l.c.length),s=c=(p=E(e,t,r,o?(i=C,g):(i=g,C))).length;0==p[--c];p.pop());if(!p[0])return i.charAt(0);if(h<0?--s:(f.c=p,f.e=s,f.s=n,p=(f=m(f,l,d,y,r)).c,u=f.r,s=f.e),h=p[a=s+d+1],c=r/2,u=u||a<0||null!=p[a+1],u=y<4?(null!=h||u)&&(0==y||y==(f.s<0?3:2)):c<h||h==c&&(4==y||u||6==y&&1&p[a-1]||y==(f.s<0?8:7)),a<1||!p[0])e=u?z(i.charAt(1),-d,i.charAt(0)):i.charAt(0);else{if(p.length=a,u)for(--r;++p[--a]>r;)p[a]=0,a||(++s,p=[1].concat(p));for(c=p.length;!p[--c];);for(h=0,e="";h<=c;e+=i.charAt(p[h++]));e=z(e,s,i.charAt(0))}return e},m=function(e,t,r,n,o){var i,a,s,c,u,f,p,l,h,d,y,m,g,v,_,b,w,k=e.s==t.s?1:-1,x=e.c,S=t.c;if(!(x&&x[0]&&S&&S[0]))return new T(e.s&&t.s&&(x?!S||x[0]!=S[0]:S)?x&&0==x[0]||!S?0*k:k/0:NaN);for(h=(l=new T(k)).c=[],k=r+(a=e.e-t.e)+1,o||(o=Y,a=M(e.e/X)-M(t.e/X),k=k/X|0),s=0;S[s]==(x[s]||0);s++);if(S[s]>(x[s]||0)&&a--,k<0)h.push(1),c=!0;else{for(v=x.length,b=S.length,k+=2,1<(u=V(o/(S[s=0]+1)))&&(S=P(S,u,o),x=P(x,u,o),b=S.length,v=x.length),g=b,y=(d=x.slice(0,b)).length;y<b;d[y++]=0);w=S.slice(),w=[0].concat(w),_=S[0],S[1]>=o/2&&_++;do{if(u=0,(i=R(S,d,b,y))<0){if(m=d[0],b!=y&&(m=m*o+(d[1]||0)),1<(u=V(m/_)))for(o<=u&&(u=o-1),p=(f=P(S,u,o)).length,y=d.length;1==R(f,d,p,y);)u--,A(f,b<p?w:S,p,o),p=f.length,i=1;else 0==u&&(i=u=1),p=(f=S.slice()).length;if(p<y&&(f=[0].concat(f)),A(d,f,y,o),y=d.length,-1==i)for(;R(S,d,b,y)<1;)u++,A(d,b<y?w:S,y,o),y=d.length}else 0===i&&(u++,d=[0]);h[s++]=u,d[0]?d[y++]=x[g]||0:(d=[x[g]],y=1)}while((g++<v||null!=d[0])&&k--);c=null!=d[0],h[0]||h.splice(0,1)}if(o==Y){for(s=1,k=h[0];10<=k;k/=10,s++);N(l,r+(l.e=s+a*X-1)+1,n,c)}else l.e=a,l.r=+c;return l},a=/^(-?)0([xbo])(?=\w[\w.]*$)/i,s=/^([^.]+)\.$/,c=/^\.([^.]+)$/,f=/^-?(Infinity|NaN)$/,h=/^\s*\+(?=[\w.])|^\s+|\s+$/g,l=function(e,t,r,n){var o,i=r?t:t.replace(h,"");if(f.test(i))e.s=isNaN(i)?null:i<0?-1:1,e.c=e.e=null;else{if(!r&&(i=i.replace(a,function(e,t,r){return o="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=o?e:t}),n&&(o=n,i=i.replace(s,"$1").replace(c,"0.$1")),t!=i))return new T(i,o);if(T.DEBUG)throw Error(G+"Not a"+(n?" base "+n:"")+" number: "+t);e.c=e.e=e.s=null}},n.absoluteValue=n.abs=function(){var e=new T(this);return e.s<0&&(e.s=1),e},n.comparedTo=function(e,t){return q(this,new T(e,t))},n.decimalPlaces=n.dp=function(e,t){var r,n,o;if(null!=e)return F(e,0,Z),null==t?t=_:F(t,0,8),N(new T(this),e+this.e+1,t);if(!(r=this.c))return null;if(n=((o=r.length-1)-M(this.e/X))*X,o=r[o])for(;o%10==0;o/=10,n--);return n<0&&(n=0),n},n.dividedBy=n.div=function(e,t){return m(this,new T(e,t),v,_)},n.dividedToIntegerBy=n.idiv=function(e,t){return m(this,new T(e,t),0,1)},n.exponentiatedBy=n.pow=function(e,t){var r,n,o,i,a,s,c,u,f=this;if((e=new T(e)).c&&!e.isInteger())throw Error(G+"Exponent not an integer: "+D(e));if(null!=t&&(t=new T(t)),a=14<e.e,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return u=new T(Math.pow(+D(f),a?2-L(e):+D(e))),t?u.mod(t):u;if(s=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new T(NaN);(n=!s&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(9<e.e&&(0<f.e||f.e<-1||(0==f.e?1<f.c[0]||a&&24e7<=f.c[1]:f.c[0]<8e13||a&&f.c[0]<=9999975e7)))return i=f.s<0&&L(e)?-0:0,-1<f.e&&(i=1/i),new T(s?1/i:i);x&&(i=W(x/X+2))}for(c=a?(r=new T(.5),s&&(e.s=1),L(e)):(o=Math.abs(+D(e)))%2,u=new T(y);;){if(c){if(!(u=u.times(f)).c)break;i?u.c.length>i&&(u.c.length=i):n&&(u=u.mod(t))}if(o){if(0===(o=V(o/2)))break;c=o%2}else if(N(e=e.times(r),e.e+1,1),14<e.e)c=L(e);else{if(0==(o=+D(e)))break;c=o%2}f=f.times(f),i?f.c&&f.c.length>i&&(f.c.length=i):n&&(f=f.mod(t))}return n?u:(s&&(u=y.div(u)),t?u.mod(t):i?N(u,x,_,void 0):u)},n.integerValue=function(e){var t=new T(this);return null==e?e=_:F(e,0,8),N(t,t.e+1,e)},n.isEqualTo=n.eq=function(e,t){return 0===q(this,new T(e,t))},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(e,t){return 0<q(this,new T(e,t))},n.isGreaterThanOrEqualTo=n.gte=function(e,t){return 1===(t=q(this,new T(e,t)))||0===t},n.isInteger=function(){return!!this.c&&M(this.e/X)>this.c.length-2},n.isLessThan=n.lt=function(e,t){return q(this,new T(e,t))<0},n.isLessThanOrEqualTo=n.lte=function(e,t){return-1===(t=q(this,new T(e,t)))||0===t},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return 0<this.s},n.isZero=function(){return!!this.c&&0==this.c[0]},n.minus=function(e,t){var r,n,o,i,a=this,s=a.s;if(t=(e=new T(e,t)).s,!s||!t)return new T(NaN);if(s!=t)return e.s=-t,a.plus(e);var c=a.e/X,u=e.e/X,f=a.c,p=e.c;if(!c||!u){if(!f||!p)return f?(e.s=-t,e):new T(p?a:NaN);if(!f[0]||!p[0])return p[0]?(e.s=-t,e):new T(f[0]?a:3==_?-0:0)}if(c=M(c),u=M(u),f=f.slice(),s=c-u){for((o=(i=s<0)?(s=-s,f):(u=c,p)).reverse(),t=s;t--;o.push(0));o.reverse()}else for(n=(i=(s=f.length)<(t=p.length))?s:t,s=t=0;t<n;t++)if(f[t]!=p[t]){i=f[t]<p[t];break}if(i&&(o=f,f=p,p=o,e.s=-e.s),0<(t=(n=p.length)-(r=f.length)))for(;t--;f[r++]=0);for(t=Y-1;s<n;){if(f[--n]<p[n]){for(r=n;r&&!f[--r];f[r]=t);--f[r],f[n]+=Y}f[n]-=p[n]}for(;0==f[0];f.splice(0,1),--u);return f[0]?I(e,f,u):(e.s=3==_?-1:1,e.c=[e.e=0],e)},n.modulo=n.mod=function(e,t){var r,n,o=this;return e=new T(e,t),!o.c||!e.s||e.c&&!e.c[0]?new T(NaN):!e.c||o.c&&!o.c[0]?new T(o):(9==i?(n=e.s,e.s=1,r=m(o,e,0,3),e.s=n,r.s*=n):r=m(o,e,0,i),(e=o.minus(r.times(e))).c[0]||1!=i||(e.s=o.s),e)},n.multipliedBy=n.times=function(e,t){var r,n,o,i,a,s,c,u,f,p,l,h,d,y,m,g=this,v=g.c,_=(e=new T(e,t)).c;if(!(v&&_&&v[0]&&_[0]))return!g.s||!e.s||v&&!v[0]&&!_||_&&!_[0]&&!v?e.c=e.e=e.s=null:(e.s*=g.s,v&&_?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=M(g.e/X)+M(e.e/X),e.s*=g.s,(c=v.length)<(p=_.length)&&(d=v,v=_,_=d,o=c,c=p,p=o),o=c+p,d=[];o--;d.push(0));for(y=Y,m=Q,o=p;0<=--o;){for(r=0,l=_[o]%m,h=_[o]/m|0,i=o+(a=c);o<i;)r=((u=l*(u=v[--a]%m)+(s=h*u+(f=v[a]/m|0)*l)%m*m+d[i]+r)/y|0)+(s/m|0)+h*f,d[i--]=u%y;d[i]=r}return r?++n:d.splice(0,1),I(e,d,n)},n.negated=function(){var e=new T(this);return e.s=-e.s||null,e},n.plus=function(e,t){var r,n=this,o=n.s;if(t=(e=new T(e,t)).s,!o||!t)return new T(NaN);if(o!=t)return e.s=-t,n.minus(e);var i=n.e/X,a=e.e/X,s=n.c,c=e.c;if(!i||!a){if(!s||!c)return new T(o/0);if(!s[0]||!c[0])return c[0]?e:new T(s[0]?n:0*o)}if(i=M(i),a=M(a),s=s.slice(),o=i-a){for((r=0<o?(a=i,c):(o=-o,s)).reverse();o--;r.push(0));r.reverse()}for((o=s.length)-(t=c.length)<0&&(r=c,c=s,s=r,t=o),o=0;t;)o=(s[--t]=s[t]+c[t]+o)/Y|0,s[t]=Y===s[t]?0:s[t]%Y;return o&&(s=[o].concat(s),++a),I(e,s,a)},n.precision=n.sd=function(e,t){var r,n,o;if(null!=e&&e!==!!e)return F(e,1,Z),null==t?t=_:F(t,0,8),N(new T(this),e,t);if(!(r=this.c))return null;if(n=(o=r.length-1)*X+1,o=r[o]){for(;o%10==0;o/=10,n--);for(o=r[0];10<=o;o/=10,n++);}return e&&this.e+1>n&&(n=this.e+1),n},n.shiftedBy=function(e){return F(e,-K,K),this.times("1e"+e)},n.squareRoot=n.sqrt=function(){var e,t,r,n,o,i=this,a=i.c,s=i.s,c=i.e,u=v+4,f=new T("0.5");if(1!==s||!a||!a[0])return new T(!s||s<0&&(!a||a[0])?NaN:a?i:1/0);if((r=0==(s=Math.sqrt(+D(i)))||s==1/0?(((t=j(a)).length+c)%2==0&&(t+="0"),s=Math.sqrt(+t),c=M((c+1)/2)-(c<0||c%2),new T(t=s==1/0?"1e"+c:(t=s.toExponential()).slice(0,t.indexOf("e")+1)+c)):new T(s+"")).c[0])for((s=(c=r.e)+u)<3&&(s=0);;)if(o=r,r=f.times(o.plus(m(i,o,u,1))),j(o.c).slice(0,s)===(t=j(r.c)).slice(0,s)){if(r.e<c&&--s,"9999"!=(t=t.slice(s-3,s+1))&&(n||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(N(r,r.e+v+2,1),e=!r.times(r).eq(i));break}if(!n&&(N(o,o.e+v+2,0),o.times(o).eq(i))){r=o;break}u+=4,s+=4,n=1}return N(r,r.e+v+1,_,e)},n.toExponential=function(e,t){return null!=e&&(F(e,0,Z),e++),O(this,e,t,1)},n.toFixed=function(e,t){return null!=e&&(F(e,0,Z),e=e+this.e+1),O(this,e,t)},n.toFormat=function(e,t,r){var n;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=S;else if("object"!=typeof r)throw Error(G+"Argument not an object: "+r);if(n=this.toFixed(e,t),this.c){var o,i=n.split("."),a=+r.groupSize,s=+r.secondaryGroupSize,c=r.groupSeparator||"",u=i[0],f=i[1],p=this.s<0,l=p?u.slice(1):u,h=l.length;if(s&&(o=a,a=s,h-=s=o),0<a&&0<h){for(o=h%a||a,u=l.substr(0,o);o<h;o+=a)u+=c+l.substr(o,a);0<s&&(u+=c+l.slice(o)),p&&(u="-"+u)}n=f?u+(r.decimalSeparator||"")+((s=+r.fractionGroupSize)?f.replace(new RegExp("\\d{"+s+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):f):u}return(r.prefix||"")+n+(r.suffix||"")},n.toFraction=function(e){var t,r,n,o,i,a,s,c,u,f,p,l,h=this,d=h.c;if(null!=e&&(!(s=new T(e)).isInteger()&&(s.c||1!==s.s)||s.lt(y)))throw Error(G+"Argument "+(s.isInteger()?"out of range: ":"not an integer: ")+D(s));if(!d)return new T(h);for(t=new T(y),u=r=new T(y),n=c=new T(y),l=j(d),i=t.e=l.length-h.e-1,t.c[0]=$[(a=i%X)<0?X+a:a],e=!e||0<s.comparedTo(t)?0<i?t:u:s,a=w,w=1/0,s=new T(l),c.c[0]=0;f=m(s,t,0,1),1!=(o=r.plus(f.times(n))).comparedTo(e);)r=n,n=o,u=c.plus(f.times(o=u)),c=o,t=s.minus(f.times(o=t)),s=o;return o=m(e.minus(r),n,0,1),c=c.plus(o.times(u)),r=r.plus(o.times(n)),c.s=u.s=h.s,p=m(u,n,i*=2,_).minus(h).abs().comparedTo(m(c,r,i,_).minus(h).abs())<1?[u,n]:[c,r],w=a,p},n.toNumber=function(){return+D(this)},n.toPrecision=function(e,t){return null!=e&&F(e,1,Z),O(this,e,t,2)},n.toString=function(e){var t,r=this.s,n=this.e;return null===n?r?(t="Infinity",r<0&&(t="-"+t)):t="NaN":(t=j(this.c),t=null==e?n<=d||o<=n?U(t,n):z(t,n,"0"):(F(e,2,C.length,"Base"),p(z(t,n,"0"),10,e,r,!0)),r<0&&this.c[0]&&(t="-"+t)),t},n.valueOf=n.toJSON=function(){return D(this)},n._isBigNumber=!0,"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf),null!=t&&T.set(t),T}()).default=r.BigNumber=r,e.exports?e.exports=r:(t=t||("undefined"!=typeof self&&self?self:window)).BigNumber=r}),mc=!0,gc=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};nt(this,t),this.config=e,this.context=e.context,this.userId=e.userId,this.videoId=e.videoId,this.id=null,this.factory=null,this.peers={},this.siblings={},this.rpcNonce_=0,this.rpcOutstandingCalls_={},this.txCounter_=0,this.probeTimeout=e.probeTimeout,this.fragmentTimeout=e.fragmentTimeout,this.failoverFactor=e.failoverFactor,this.probeRetry=3,this.firstPeerReq=!0,this.hasReceivedPeers=!1,this.peerReqInterval=12e4,this.rangeNumber=1,this.urlBitrateMap={},this.allowRangeRequests=e.allowRangeRequests,this.useCDN=!1,this.ucn={},this.rangeNumber=1,this.peerReqIntervalId_=void 0,this.segUrlBypassQuery=!0,this.heartbeater_=null,this.reconnectIntervalID_=null,this.pingTestTimeTicker=null,this.useUCN=!1,this.connectionType=void 0,this.receiveMap={},this.hasEnableProbeRace=!0,this.getFragResults=[],this.counterMap={},this.blackList={},this.passRate=.5,this.minBlockNum=50,this.windowSize=10}var e,n,r,c,i,o,a,s,u,f,p,l,h,d,y;return it(t,[{key:"start",value:(y=rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return bn.debug("P2P Start userId=".concat(this.userId,", videoId=").concat(this.videoId)),bn.debug("probeTimeout=".concat(this.probeTimeout,", fragmentTimeout=").concat(this.fragmentTimeout)),e.next=4,this.joinPeerjsServer();case 4:return e.next=6,this.joinPeerGroupServer();case 6:this.peerReqIntervalId_&&clearInterval(this.peerReqIntervalId_),this.peerReqIntervalId_=setInterval(this.getPeers.bind(this),6e3);case 8:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"destroy",value:function(){this.peerReqIntervalId_&&clearInterval(this.peerReqIntervalId_),this.factory&&this.factory.destroy(),this.context=null}},{key:"startPeerReqInterval",value:function(){clearInterval(this.peerReqIntervalId_),this.peerReqIntervalId_=setInterval(this.getPeers.bind(this),this.peerReqInterval)}},{key:"startPingTestTimer",value:function(){this.pingTestTimeTicker=Date.now()}},{key:"makePeerHeartbeater",value:function(e){bn.info("In makePeerHeartbeater for peer ID: ",e.id);var t=0;function r(){t=setTimeout(r,3e4),e.socket._wsOpen()&&(bn.info("Peer (me) sending heartbeat to server!"),e.socket.send({type:"HEARTBEAT"}))}return r(),{start:function(){0===t&&r()},stop:function(){clearTimeout(t),t=0}}}},{key:"stringifyBigNumberValues",value:function(r){var n={};return Object.keys(r).forEach(function(e){var t=r[e];yc.isBigNumber(t)?n[e]=t.toJSON():n[e]=r[e]}),n}},{key:"joinPeerjsServer",value:(d=rt(regeneratorRuntime.mark(function e(){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return bn.debug("joinPeerjsServer"),e.abrupt("return",new Promise(function(t,e){n.factory=new dc({host:n.config.server.host,port:n.config.server.port,secure:n.config.server.secure,debug:0,config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}}),n.factory.on("open",function(e){bn.info("Peer ID is:",e),n.id=e,n.context.trigger(lc.PEER_ID_CHANGED,{id:e}),bn.info("PeerJS open...resolving"),n.heartbeater_=n.makePeerHeartbeater(n.factory),n.reconnectIntervalID_&&clearTimeout(n.reconnectIntervalID_),t()}),n.factory.on("disconnected",function(){bn.info("Peer (me) has been disconneted!")}),n.factory.on("error",function(e){bn.info("Peer (me) connection error: ",e.type),bn.info("Peer (me) will try to connect again...");var t=n,r=!0;n.reconnectIntervalID_&&clearTimeout(n.reconnectIntervalID_),r&&(n.reconnectIntervalID_=setTimeout(function(){bn.info("Peer (me) attempting to reconnect..."),!t.factory||t.factory.destroyed?(t.factory=null,r=!1,t.start()):t.factory.disconnected&&t.factory.reconnect()},5e3))}),n.factory.on("connection",n.setupPeerConnection.bind(n))}));case 2:case"end":return e.stop()}},e)})),function(){return d.apply(this,arguments)})},{key:"joinPeerGroupServer",value:(h=rt(regeneratorRuntime.mark(function e(){var p=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:bn.debug("joinPeerGroupServer"),bn.debug("this.context.socket == "+this.context.socket),this.context.socket.emit("join",{id:this.id,userId:this.userId,videoId:this.videoId}),this.context.socket.emit("getconfig",{id:this.id,videoId:this.videoId}),this.context.socket.on("getpeers_reply",function(e){var t=e.result;p.hasReceivedPeers=!0;var r=e.response,n=r.ucn;if(bn.info("Peers have received status: "+p.hasReceivedPeers),bn.debug("whole msg: ",e),bn.debug("Received getpeers_reply msg=",e.response),bn.debug("Received getpeers_reply ucn =",n),n&&0!==n.length?(p.useUCN=!0,p.ucn={host:n[0].host,stream_map:n[0].stream_map}):(p.useUCN=!1,p.ucn={}),"KOK"===t?p.handlePeerConnection(e.response.peer):bn.error("getpeers_reply error:",e.response),p.firstPeerReq&&(p.startPeerReqInterval(),p.firstPeerReq=!1),p.context.wallet.isReady()){if(n)for(var o=0;o<n.length;o++)if(n[o].auth){var i=n[o].auth,a=i.a!=p.context.wallet.account.user_id?i.a:i.b;p.context.wallet.addAuth(a,i.exp,i.token)}if(r.peer)for(var s=r.peer,c=0;c<s.length;c++)if(s[c].auth){var u=s[c].auth,f=u.a!=p.context.wallet.account.user_id?u.a:u.b;p.context.wallet.addAuth(f,u.exp,u.token)}}}),this.context.socket.on("getconfig_reply",function(e){bn.debug("Received getconfig_reply, msg=",e),p.probeTimeout=e.probeTimeout,p.fragmentTimeout=e.fragmentTimeout,p.probeRetry=e.probeRetry,p.peerReqInterval=e.peerReqInterval,p.failoverFactor=e.failoverFactor,p.useCDN=e.useCDN,p.segUrlBypassQuery=e.segUrlBypassQuery,p.rangeNumber=e.rangeNumber,p.hasEnableProbeRace=e.probePeerRace,void 0!==e.urlBitrateMap&&e.urlBitrateMap instanceof Object&&(p.urlBitrateMap=e.urlBitrateMap),void 0!==e.rangeNumber&&(p.rangeNumber=e.rangeNumber)}),this.context.socket.on("setconfig",function(e){if("all"===e.id||e.id===p.id||e.videoId===p.videoId){if(bn.debug("Received setconfig request, msg="+JSON.stringify(e)),void 0===e.config.useCDN&&void 0===e.config.probeTimeout&&void 0===e.config.fragmentTimeout&&void 0===e.config.probeRetry&&void 0===e.config.rangeNumber&&void 0===e.config.peerReqInterval&&void 0===e.config.failoverFactor&&void 0===e.config.probePeerRace)return void bn.error("configuration message is not supported");if(void 0!==e.config.useCDN&&(p.useCDN=e.config.useCDN),void 0!==e.config.probeRetry&&(p.probeRetry=e.config.probeRetry),void 0!==e.config.failoverFactor&&(p.failoverFactor=e.config.failoverFactor),void 0!==e.config.rangeNumber){var t=e.config.rangeNumber;Number.isInteger(t)&&0<t&&(p.rangeNumber=t)}if(void 0!==e.config.peerReqInterval){var r=e.config.peerReqInterval;Number.isInteger(r)&&1e3<r&&(p.peerReqInterval=r,p.startPeerReqInterval())}if(void 0!==e.config.probeTimeout){var n=e.config.probeTimeout;Number.isInteger(n)&&0<n&&(p.probeTimeout=n)}if(void 0!==e.config.fragmentTimeout){var o=e.config.fragmentTimeout;Number.isInteger(o)&&0<o&&(p.fragmentTimeout=o)}if(void 0!==e.config.rangeNumber){var i=e.config.rangeNumber;Number.isInteger(i)&&0<i&&(p.rangeNumber=i)}void 0!==e.config.segUrlBypassQuery&&(p.segUrlBypassQuery=e.config.segUrlBypassQuery),void 0!==e.config.probePeerRace&&(p.hasEnableProbeRace=e.config.probePeerRace);var a=p.getPeerConfig(),s={id:p.id,config:a};bn.info(s),p.context.socket.emit("setconfig_reply",s)}}),this.context.socket.on("getconfig",function(e){bn.info("Received config from server, msg=",e);var t=p.getPeerConfig(),r={id:p.id,config:t};bn.info(r),p.context.socket.emit("getconfig_reply",r)}),this.context.socket.on("pingtest",function(t){(bn.info("Received pingtest req from server for id=".concat(t.id)),p.id!==t.id)?bn.error("id=".concat(t.id," doesn't match up with peer id=").concat(p.id)):p.sendPingTest().then(function(e){bn.info("pingtest for id=".concat(t.id," results= ").concat(JSON.stringify(e))),p.context.socket.emit("pingtest_reply",{id:p.id,result:e})}).catch(function(e){bn.info("pingtest for id=".concat(t.id," results with error: ").concat(e.message)),p.context.socket.emit("pingtest_reply",{id:p.id,result:e.message})})});case 9:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"handlePeerConnection",value:function(e){if(e){bn.info("latest peers info for  - ",this.id+" total peers: "+e.length);try{for(var t=new Set,r=0;r<e.length;r++){e[r].geo;var n=e[r]._id;t.add(n),this.peers[n]||(bn.info("connect to new peer ",n),this.connectToPeer(n))}for(var o in this.peers)this.peers.hasOwnProperty(o)&&(t.has(o)||(bn.info("old peer ".concat(o," is removed")),delete this.peers[o]))}catch(e){bn.error("caught up exception: ",e.message)}this.updateNumPeers()}}},{key:"setupPeerConnection",value:function(t){var r=this;bn.info("Received incoming connection from",t.peer),(this.peers[t.peer]=t).on("data",function(e){r.peerMessageHandler(e,t)})}},{key:"sendPingTest",value:(l=rt(regeneratorRuntime.mark(function e(){var i,t,r,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in bn.info("start sends pingReq to all its peers, id=".concat(this.id)),this.startPingTestTimer(),i=[],t=function(n){var e=[],t=a.peers[n],r=new Promise(function(e,t){var r=setTimeout(function(){clearTimeout(r),e({id:n,result:"Ping timeout in 1000 ms"})},1e3)});e.push(r);var o=a.makeRPC(t,"pingReq",{id:a.id});e.push(o),i.push(Promise.race(e))},this.peers)t(r);return e.abrupt("return",Promise.all(i));case 6:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"peerMessageHandler",value:function(e,t){var r=t.peer;if(mc)switch(bn.debug("[".concat(r,"] peerMessageHandler: type = "),e.type),e.type){case"rpc_request":var n=e.method;if(bn.debug("[".concat(r,"] RPC request received - ").concat(e.nonce," - ").concat(e.method)),"probeFragment"===n){var o=this[n].call(this,e.arg);o&&"kOKFound"===o.result?(t.send({type:"rpc_response",nonce:e.nonce,result:o}),bn.debug("[".concat(r,"] RPC request ").concat(e.nonce," processed , found in cache, resp sent!")),this.context.playerStats.processFragmentReq(r,"probe_req_accept")):(this.hasEnableProbeRace||(t.send({type:"rpc_response",nonce:e.nonce,result:o}),bn.debug("[".concat(r,"] RPC request ").concat(e.nonce," processed, not cached, reply sent."))),this.context.playerStats.processFragmentReq(r,"probe_req_notFound"))}else if("getFragment"===n)if(this.txCounter_>=this.context.maxConcurrentPeerTxs){var i=e.arg.key;bn.debug("[".concat(r,"] RPC request ").concat(e.nonce," rejected due to peer ").concat(this.id," busy")),t.send({type:"rpc_response",nonce:e.nonce,result:{url:i,result:"kBusy"}}),this.context.playerStats.processFragmentReq(r,"fragment_req_notSent")}else{var a=Math.floor(Date.now());this.txCounter_++,bn.debug("[".concat(r,"] RPC request ").concat(e.nonce," accepted, sending to peer ... "));try{var s=this[n].call(this,e.arg);t.send({type:"rpc_response",nonce:e.nonce,result:s});var c=Math.floor(Date.now());bn.debug("[".concat(r,"] RPC request ").concat(e.nonce," sending Done in ").concat(c-a," ms!")),this.context.playerStats.processFragment(e.arg.key,"toPeer",s.data.byteLength,c-a),this.context.playerStats.processFragmentReq(r,"fragment_req_accept")}catch(e){bn.error("RPC request ".concat(e.message," sending failed!")),this.context.playerStats.processFragmentReq(r,"fragment_req_failSent")}finally{this.txCounter_--}}else if("pingReq"===n)bn.info("[".concat(r,"] Received pingtest req from peer id=").concat(e.arg.id)),t.send({type:"rpc_response",nonce:e.nonce,result:{id:this.id,result:"pingReq_reply"}});else{var u=this[n].call(this,e.arg);t.send({type:"rpc_response",nonce:e.nonce,result:u}),bn.debug("[".concat(r,"] RPC request ").concat(n," processed, Done"))}break;case"rpc_response":bn.debug("[".concat(r,"] RPC response received for"),e.nonce),this.rpcOutstandingCalls_[e.nonce](e.result),delete this.rpcOutstandingCalls_[e.nonce];break;case"payment":bn.debug("[".concat(r,"] payment received "),e),this.handlePayment(e);break;default:bn.error("[".concat(r,"] Unknown message type received: "),e.type)}}},{key:"sendPayment",value:(p=rt(regeneratorRuntime.mark(function e(t,r){var n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r?r.peer:null,bn.debug("[".concat(n,"] sendPayment: invoice: "),t),e.next=4,this.context.wallet.createPayment(t);case 4:o=e.sent,bn.debug("[".concat(n,"] sendPayment: payment: "),o),this.context.trigger(lc.PAYMENT_SENT,{payment:o}),this.context.playerStats.sendPayment(o.amount),r&&r.send({type:"payment",payment:this.stringifyBigNumberValues(o)});case 9:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"handlePayment",value:(f=rt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.context.wallet.receivePayment(t.payment);case 3:this.context.trigger(lc.PAYMENT_RECEIVED,{payment:t.payment}),this.context.playerStats.recvPayment(t.payment.amount),t.payment&&t.payment.error&&(bn.error("Error in received payment. Skip payment:",t.payment.error),this.context.playerStats.walletPaymentError(t.payment.error)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),bn.error("Error submitting payment: ",e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])})),function(e){return f.apply(this,arguments)})},{key:"getFragment",value:function(e){var t=e.key,r=e.peer_id,n=e.userID,o=e.theta_address,i=e.curNum,a=e.totalNum;if(this.context.cache.has(t)){var s=this.context.cache.get(t)[0].data.byteLength,c=Math.floor(s*(i/a)),u=Math.floor(s*((i+1)/a)),f=new Uint8Array(this.context.cache.get(t)[0].data.slice(c,u)),p=this.context.wallet.createInvoice(n,this.videoId);return bn.debug("Fragment found. Sending to peer."),this.context.trigger(lc.TRAFFIC,{type:pc.P2P_OUTBOUND,stats:{size:f.byteLength},peer:{id:r,address:o,userID:n}}),{type:"fragment",url:t,result:"kOK",data:f,invoice:p?this.stringifyBigNumberValues(p):p,totalLength:s}}return bn.debug("No cache found for ",t),{type:"fragment",url:t,result:"kNotFound"}}},{key:"probeFragment",value:function(e){var t=e.key;return this.context.cache.has(t)?(bn.debug("Info peer that fragment ".concat(t," is found at cache ")),{type:"fragment",url:t,peerid:this.id,result:"kOKFound"}):this.hasEnableProbeRace?void 0:(bn.debug("".concat(this.id," responds NotFound for ").concat(t," ")),{type:"fragment",url:t,peerid:this.id,result:"kNotFound"})}},{key:"connectToPeer",value:function(e){if(bn.debug("connectToPeer: ",e),e!==this.id&&!this.peers[e]){var t=this.factory.connect(e);t?(this.peers[e]=t,this.setupPeerConnection(t),this.updateNumPeers(),bn.debug("Connected to peer: ",e)):bn.error("Failed to connect to peer: ",e)}}},{key:"updateNumPeers",value:function(){bn.debug("updateNumPeers");var e=Object.keys(this.peers).length;bn.debug("updateNumPeers :: totalPeers = ",e),this.context.trigger(lc.PEERS_CHANGED,{totalPeers:e})}},{key:"getPeerConfig",value:function(){return{useCDN:this.useCDN,probeRetry:this.probeRetry,peerReqInterval:this.peerReqInterval,probeTimeout:this.probeTimeout,fragmentTimeout:this.fragmentTimeout,failoverFactor:this.failoverFactor,rangeNumber:this.rangeNumber,segUrlBypassQuery:this.segUrlBypassQuery,probePeerRace:this.hasEnableProbeRace}}},{key:"probeFromPeerWithTimeout",value:(u=rt(regeneratorRuntime.mark(function e(t,r,n,o){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(bn.info("hasEnableProbeRace is:",this.hasEnableProbeRace),this.hasEnableProbeRace)return bn.info("IMPROVE DEBUG [P] - Start probing, retry times: ",o),e.next=5,this.probeFromPeerWithRetry(t,r,n,o);e.next=8;break;case 5:return e.abrupt("return",e.sent);case 8:return e.next=10,this._probeFromPeerWithTimeout(t,r);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this)})),function(e,t,r,n){return u.apply(this,arguments)})},{key:"probeFromPeerWithRetry",value:(s=rt(regeneratorRuntime.mark(function e(r,n,o,i){var a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.simpleProbeFromPeerWithTimeout(r,n,o).then(function(e){return bn.info("IMPROVE DEBUG [P] - res in probe, res: ",e),Promise.resolve(e)}).catch(function(){var t=rt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(bn.info("IMPROVE DEBUG [P] - err in probe, res: ",t),"timeout"!==t.result){e.next=13;break}if(bn.info("IMPROVE DEBUG [P] - Retry count and retry times: ",o,i),o<i)return e.next=6,a.probeFromPeerWithRetry(r,n,++o,i);e.next=9;break;case 6:return e.abrupt("return",e.sent);case 9:return bn.info("IMPROVE DEBUG [P] - Probing got timeout ".concat(o," times, return a reject")),e.abrupt("return",Promise.reject(t));case 11:e.next=14;break;case 13:return e.abrupt("return",Promise.reject(t));case 14:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,r,n){return s.apply(this,arguments)})},{key:"simpleProbeFromPeerWithTimeout",value:(a=rt(regeneratorRuntime.mark(function e(t,n,r){var o,i,a,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in bn.debug("probeFromPeerWithTimeout - "),o=[],i=new Promise(function(e,t){var r=setTimeout(function(){clearTimeout(r),t({result:"timeout"})},n)}),o.push(i),1===r&&this.updateBlackList(),this.peers)void 0===this.blackList[a]?(s=this.peers[a],c=this.makeRPC(s,"probeFragment",{key:t}),this.context.playerStats.processFragmentReq(a,"probe_req_sent"),o.push(c)):bn.debug("IMPROVE DEBUG [BL] - forbid probing from a peer in the black list",a);return bn.debug("probeFromPeerWithTimeout requests are out and run all starts"),e.next=9,Promise.race(o).then(function(e){return bn.log("SPLIT DEBUG - res in probe:",e),e?"kOKFound"===e.result?e:void 0:Promise.reject({type:"timeout",msg:"ProbeFromPeerWithTimeout ends with timeout"})});case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)})),function(e,t,r){return a.apply(this,arguments)})},{key:"_probeFromPeerWithTimeout",value:(o=rt(regeneratorRuntime.mark(function e(t,r){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.probeFromPeerWithAllReturn(t,r).then(function(e){var t=!1,r="";return e.forEach(function(e){e.peerid||bn.debug("No peerid",e),"timeout"===e.result?("object"!==et(r)&&"not catched"!==e&&(r="timeout"),n.context.playerStats.processFragmentReq(e.peerid,"probe_req_timeout")):"kNotFound"===e.result?("object"!==et(r)&&(r="not catched"),n.context.playerStats.processFragmentReq(e.peerid,"probe_req_not_cached")):t?n.context.playerStats.processFragmentReq(e.peerid,"probe_req_replied"):(n.context.playerStats.processFragmentReq(e.peerid,"probe_req_replied"),t=!0,r=Promise.resolve(e))}),"object"===et(r)?r:"timeout"===r?Promise.reject({type:"timeout",msg:"ProbeFromPeerWithTimeout ends with "+r}):Promise.reject({type:"notCached",msg:"ProbeFromPeerWithTimeout ends with "+r})}).catch(function(e){return Promise.reject(e)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"probeFromPeerWithAllReturn",value:function(i,a){var s=this;bn.debug("probeFromPeerWithTimeout - ");var c=[];this.updateBlackList();function e(n){if(void 0===s.blackList[n]){var e=[],t=s.peers[n],r=s.makeRPC(t,"probeFragment",{key:i});s.context.playerStats.processFragmentReq(n,"probe_req_sent");var o=new Promise(function(e,t){var r=setTimeout(function(){clearTimeout(r),e({result:"timeout",peerid:n})},a)});e.push(r),e.push(o),c.push(Promise.race(e))}else bn.debug("IMPROVE DEBUG [BL] - forbid probing from a peer in the black list",n)}for(var t in this.peers)e(t);return bn.debug("probeFromPeerWithTimeout requests are out and run all starts"),Promise.all(c)}},{key:"loadFromSpecificPeerWithTimeout",value:(i=rt(regeneratorRuntime.mark(function e(n,t,o,i,a){var s,c,u,f,p,r,l,h=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.peers[t],c=o||this.fragmentTimeout,bn.info("New fragment timeout: ",c),u=new Promise(function(e,t){var r=setTimeout(function(){clearTimeout(r),t("Timeout in "+c+" ms.")},c)}),f=this.context.wallet.account&&this.context.wallet.account.recv_account&&this.context.wallet.account.recv_account.address,bn.log("SPLIT DEBUG - theta address:",f),p=[],r=function(r){var e=[];e.push(u);var t=new Promise(function(e,t){setTimeout(function(){e(h.getFragmentChunks(s,n,f,r,i,a,Date.now(),c))},r*o/10)});e.push(t),p.push(Promise.race(e))},l=0;l<i;l++)r(l);return bn.debug("loadFromSpecificPeerWithTimeout starts, peerid=",t),e.abrupt("return",Promise.all(p));case 11:case"end":return e.stop()}},e,this)})),function(e,t,r,n,o){return i.apply(this,arguments)})},{key:"getFragmentChunks",value:(c=rt(regeneratorRuntime.mark(function e(t,r,n,o,i,a,s,c){var u=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeRPC(t,"getFragment",{key:r,theta_address:n,peer_id:this.id,userID:this.userId,totalNum:i,curNum:o}).then(function(e){if("kOK"===e.result&&(a[o]=e.data,a[i]||(a[i]=e.totalLength),u._checkData(a))){var t=a.slice(0,i);return e.data=t.reduce(function(e,t){return u._appendBuffer(e,t)},new ArrayBuffer),bn.log("IMPROVE DEBUG - res in check data:",e),e}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,r,n,o,i,a,s){return c.apply(this,arguments)})},{key:"loadFromSpecificPeer",value:(r=rt(regeneratorRuntime.mark(function e(t,r){var n,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.peers[r],o=this.context.wallet.account&&this.context.wallet.account.recv_account&&this.context.wallet.account.recv_account.address,e.next=4,this.makeRPC(n,"getFragment",{key:t,theta_address:o,peer_id:this.id,userID:this.userId});case 4:if("kOK"===(i=e.sent).result)return this.context.wallet.sendServiceCert(i.theta_address),e.abrupt("return",i);e.next=10;break;case 10:bn.warn("failed to load fragment from peer",r);case 11:return e.abrupt("return",{url:t,result:"kNotFound"});case 12:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"makeRPC",value:(n=rt(regeneratorRuntime.mark(function e(r,n,o){var i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n+":"+this.rpcNonce_++,e.abrupt("return",new Promise(function(e,t){a.rpcOutstandingCalls_[i]=e,r.send({type:"rpc_request",method:n,arg:o,nonce:i})}));case 2:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"getGeolocation",value:function(){var e=this.context.playerStats.browserType.split("|");return 1<e.length?JSON.parse(e[1]):void 0}},{key:"getConnectionType",value:function(){var e="unknown";return navigator.connection&&(e=navigator.connection.type),e}},{key:"getPeers",value:(e=rt(regeneratorRuntime.mark(function e(){var t,r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.context.playerStats.checkActive()?(t=this.getGeolocation(),this.connectionType=this.getConnectionType(),r={id:this.id,geoLocation:t,connectionType:this.connectionType,userId:this.userId,videoId:this.videoId},bn.log("getPeers:",r),this.hasReceivedPeers=!1,bn.info("Peers have received status: "+this.hasReceivedPeers),this.context.socket.emit("getpeers",r),setTimeout(rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(bn.info("Peers have received status: "+n.hasReceivedPeers),n.hasReceivedPeers){e.next=8;break}return bn.info("Did not receive peers after 5 seconds"),n.context.playerStats.resetStats(),e.next=6,n.joinPeerjsServer();case 6:return e.next=8,n.context.socket.emit("join",{id:n.id,userId:n.userId,videoId:n.videoId});case 8:case"end":return e.stop()}},e)})),5e3)):(bn.info("No download during a getPeer period, disconnect from peer server."),this.context.socket.disconnect());case 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_appendBuffer",value:function(e,t){if(!e.byteLength)return t;if(!t.byteLength)return e;var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}},{key:"shouldSendPayment",value:function(e,t){var r=e.slice(0);delete r[r.length-1],this.receiveMap[[t]]||(this.receiveMap[[t]]=0),bn.log("SPLIT DEBUG - receive map:",this.receiveMap),bn.log("SPLIT DEBUG - inner data in should send payment function:",r);var n=e.length-1,o=0;return r.forEach(function(e){void 0!==e&&o++}),bn.log("SPLIT DEBUG - count/totalNum:",o/n),this.receiveMap[[t]]+=o/n,bn.log("SPLIT DEBUG - receiveMap after calc:",this.receiveMap),1<=this.receiveMap[[t]]&&(this.receiveMap[[t]]--,!0)}},{key:"updateBlackList",value:function(){var r=this,n={};bn.debug("IMPROVE DEBUG [BL] - getFragResults is,",this.getFragResults),this.getFragResults.forEach(function(e){var t=e.id;n[t]||(n[t]={success:0,failed:0,rate:0}),"success"===e.status?n[t].success+=e.segmentNum:n[t].failed+=e.segmentNum,n[t].rate=n[t].success/(n[t].success+n[t].failed)}),bn.debug("IMPROVE DEBUG [BL] - Counter Map :",n),this.counterMap=n;var o=Date.now();Object.keys(this.blackList).forEach(function(e){o-r.blackList[e]>3*r.windowSize*60*1e3&&delete r.blackList[e]}),bn.debug("IMPROVE DEBUG [BL] - Black List after remove:",this.blackList),Object.keys(n).forEach(function(t){r._checkBlackList(n,t)&&(r.blackList[t]=o,r.getFragResults=r.getFragResults.filter(function(e){return e.id!==t}),bn.debug("IMPROVE DEBUG [BL] - getFragResults after remove:",r.getFragResults))}),bn.debug("IMPROVE DEBUG [BL] - Final black list:",this.blackList)}},{key:"updateGetFragResults",value:function(e,t,r){var n=Date.now(),o=60*this.windowSize*1e3,i=this.getFragResults.filter(function(e){return n-e.timestamp<o});i.push({id:e,status:t,timestamp:Date.now(),segmentNum:r}),this.getFragResults=i}},{key:"_checkData",value:function(e){bn.debug("IMPROVE DEBUG - data in check data:",e);for(var t=0;t<e.length;t++)if(void 0===e[t])return!1;return!0}},{key:"_checkBlackList",value:function(e,t){return e[t].rate<=0&&10<=e[t].success+e[t].failed||e[t].rate<=.2&&20<=e[t].success+e[t].failed||e[t].rate<=.3&&30<=e[t].success+e[t].failed||e[t].rate<=.4&&40<=e[t].success+e[t].failed||e[t].rate<=this.passRate&&e[t].success+e[t].failed>=this.minBlockNum}}],[{key:"toggleUseCDN",value:function(){mc=!mc}},{key:"isPeeringEnabled",get:function(){return mc},set:function(e){mc=e}}]),t}(),vc=Pe.f,_c={}.toString,bc="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],wc={f:function(e){return bc&&"[object Window]"==_c.call(e)?function(e){try{return vc(e)}catch(e){return bc.slice()}}(e):vc(u(e))}},kc={f:pe},xc=D.f,Sc=xn.forEach,Cc=R("hidden"),Tc="Symbol",Ec="prototype",Pc=pe("toPrimitive"),Rc=me.set,Ac=me.getterFor(Tc),Oc=Object[Ec],Bc=B.Symbol,Ic=te("JSON","stringify"),Nc=N.f,Dc=D.f,Mc=wc.f,jc=d.f,qc=H("symbols"),Fc=H("op-symbols"),Lc=H("string-to-symbol-registry"),Uc=H("symbol-to-string-registry"),zc=H("wks"),Hc=B.QObject,Wc=!Hc||!Hc[Ec]||!Hc[Ec].findChild,Vc=I&&m(function(){return 7!=wt(Dc({},"a",{get:function(){return Dc(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=Nc(Oc,t);n&&delete Oc[t],Dc(e,t,r),n&&e!==Oc&&Dc(Oc,t,n)}:Dc,Gc=Le?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof Bc},Jc=function(e,t,r){e===Oc&&Jc(Fc,t,r),b(e);var n=f(t,!0);return b(r),l(qc,n)?(r.enumerable?(l(e,Cc)&&e[Cc][n]&&(e[Cc][n]=!1),r=wt(r,{enumerable:A(0,!1)})):(l(e,Cc)||Dc(e,Cc,A(1,{})),e[Cc][n]=!0),Vc(e,n,r)):Dc(e,n,r)},Yc=function(e){var t=f(e,!0),r=jc.call(this,t);return!(this===Oc&&l(qc,t)&&!l(Fc,t))&&(!(r||!l(this,t)||!l(qc,t)||l(this,Cc)&&this[Cc][t])||r)},Xc=function(e){var t=e===Oc,r=Mc(t?Fc:u(e)),n=[];return Sc(r,function(e){!l(qc,e)||t&&!l(Oc,e)||n.push(qc[e])}),n};if(Fe||(ge((Bc=function(e){if(this instanceof Bc)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==e?String(e):void 0,r=P(t),n=function(e){this===Oc&&n.call(Fc,e),l(this,Cc)&&l(this[Cc],r)&&(this[Cc][r]=!1),Vc(this,r,A(1,e))};return I&&Wc&&Vc(Oc,r,{configurable:!0,set:n}),ac(r,t)})[Ec],"toString",function(){return Ac(this).tag}),ge(Bc,"withoutSetter",function(e){return ac(P(e),e)}),d.f=Yc,D.f=Jc,N.f=cc,Pe.f=wc.f=uc,Re.f=Xc,kc.f=function(e){return ac(pe(e),e)},I&&(Dc(Bc[Ec],"description",{configurable:!0,get:function(){return Ac(this).description}}),ge(Oc,"propertyIsEnumerable",Yc,{unsafe:!0}))),ue({global:!0,wrap:!0,forced:!Fe,sham:!Fe},{Symbol:Bc}),Sc(dt(zc),function(e){ic(e)}),ue({target:Tc,stat:!0,forced:!Fe},{for:function(e){var t=String(e);if(l(Lc,t))return Lc[t];var r=Bc(t);return Lc[t]=r,Uc[r]=t,r},keyFor:function(e){if(!Gc(e))throw TypeError(e+" is not a symbol");if(l(Uc,e))return Uc[e]},useSetter:function(){Wc=!0},useSimple:function(){Wc=!1}}),ue({target:"Object",stat:!0,forced:!Fe,sham:!I},{create:function(e,t){return void 0===t?wt(e):sc(wt(e),t)},defineProperty:Jc,defineProperties:sc,getOwnPropertyDescriptor:cc}),ue({target:"Object",stat:!0,forced:!Fe},{getOwnPropertyNames:uc,getOwnPropertySymbols:Xc}),ue({target:"Object",stat:!0,forced:m(function(){Re.f(1)})},{getOwnPropertySymbols:function(e){return Re.f(fe(e))}}),Ic){var Kc=!Fe||m(function(){var e=Bc();return"[null]"!=Ic([e])||"{}"!=Ic({a:e})||"{}"!=Ic(Object(e))});ue({target:"JSON",stat:!0,forced:Kc},{stringify:function(e,t,r){for(var n,o=[e],i=1;i<arguments.length;)o.push(arguments[i++]);if((O(n=t)||void 0!==e)&&!Gc(e))return qe(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!Gc(t))return t}),o[1]=t,Ic.apply(null,o)}})}Bc[Ec][Pc]||M(Bc[Ec],Pc,Bc[Ec].valueOf),Dt(Bc,Tc),J[Cc]=!0;var $c=D.f,Qc=B.Symbol;if(!(!I||"function"!=typeof Qc||"description"in Qc.prototype&&void 0===Qc().description)){var Zc={},eu=function(e){var t=arguments.length<1||void 0===e?void 0:String(e),r=this instanceof eu?new Qc(t):void 0===t?Qc():Qc(t);return""===t&&(Zc[r]=!0),r};se(eu,Qc);var tu=eu.prototype=Qc.prototype;tu.constructor=eu;var ru=tu.toString,nu="Symbol(test)"==String(Qc("test")),ou=/^Symbol\((.*)\)[^)]+$/;$c(tu,"description",{configurable:!0,get:function(){var e=O(this)?this.valueOf():this,t=ru.call(e);if(l(Zc,e))return"";var r=nu?t.slice(7,-1):t.replace(ou,"$1");return""===r?void 0:r}}),ue({global:!0,forced:!0},{Symbol:eu})}ic("iterator");var iu=Se.includes;ue({target:"Array",proto:!0},{includes:function(e,t){return iu(this,e,1<arguments.length?t:void 0)}}),St("includes");var au=pe("match");function su(e){return yc(e).dividedBy(1e9).toNumber()||0}ue({target:"String",proto:!0,forced:!function(t){var r=/./;try{"/./"[t](r)}catch(e){try{return r[au]=!1,"/./"[t](r)}catch(e){}}return!1}("includes")},{includes:function(e,t){return!!~String(p(this)).indexOf(function(e){if(Ca(e))throw TypeError("The method doesn't accept regular expressions");return e}(e),1<arguments.length?t:void 0)}});function cu(e,t){t=t||{};var r,n=typeof e;if("string"==n&&0<e.length)return function(e){if(100<(e=String(e)).length)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"days":case"day":case"d":return r*yu;case"hours":case"hour":case"hrs":case"hr":case"h":return r*du;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"==n&&!1===isNaN(e))return t.long?mu(r=e,yu,"day")||mu(r,du,"hour")||mu(r,6e4,"minute")||mu(r,1e3,"second")||r+" ms":function(e){if(yu<=e)return Math.round(e/yu)+"d";if(du<=e)return Math.round(e/du)+"h";if(6e4<=e)return Math.round(e/6e4)+"m";if(1e3<=e)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}var uu=function(){function r(e,t){nt(this,r),this.context=e,this.client_ip=null,this.videoId=t,this.browserType=this.getBrowserType(),this.resetStats()}var e;return it(r,[{key:"start",value:function(){this.peerStatHandle=setInterval(this.reportStats.bind(this),9e4)}},{key:"destroy",value:function(){this.peerStatHandle&&clearInterval(this.peerStatHandle),this.context=null}},{key:"setContext",value:function(e){this.context=e}},{key:"reportStats",value:function(){this.sendReport()}},{key:"checkActive",value:function(){return bn.info("Checking stats."),bn.info("num_pre_fragment: ".concat(this.num_pre_fragment,", num_fragment: ").concat(this.num_fragment)),(0===this.num_fragment||this.num_pre_fragment!==this.num_fragment)&&(this.num_pre_fragment=this.num_fragment,!0)}},{key:"setFragmentSize",value:function(e){this.fragment_size=e}},{key:"processProbeReq",value:function(e,t){this.avg_probe_reply_time+=t,t>this.max_probe_reply_time&&(this.max_probe_reply_time=t),t<this.min_probe_reply_time&&(this.min_probe_reply_time=t)}},{key:"addToMap",value:function(e,t){if(e.has(t)){var r=e.get(t);r++,e.set(t,r)}else e.set(t,1)}},{key:"lookupBitrateFromUrl",value:function(e){var t=this.context.p2p.urlBitrateMap;for(var r in t)for(var n in t[r])if(e.includes(t[r][n]))return bn.info("resolve url=".concat(e," to bitrate=").concat(r)),r}},{key:"addBitrateMap",value:function(e,t,r){var n=this.lookupBitrateFromUrl(e);if(n)switch(r){case"fromCDN":void 0===this.bitrate_from_cdn_map[n]?this.bitrate_from_cdn_map[n]=t:this.bitrate_from_cdn_map[n]+=t;break;case"fromPeer":void 0===this.bitrate_from_peer_map[n]?this.bitrate_from_peer_map[n]=t:this.bitrate_from_peer_map[n]+=t;break;case"toPeer":void 0===this.bitrate_to_peer_map[n]?this.bitrate_to_peer_map[n]=t:this.bitrate_to_peer_map[n]+=t;break;default:bn.error("invalid result message for addBitrateMap: ".concat(r))}else bn.error("error to lookup bitrate for url=".concat(e," "))}},{key:"processFragmentReq",value:function(e,t){switch(t){case"probe_req_overview_replied":this.num_probe_req_sent++,this.num_probe_req_replied++;break;case"probe_req_overview_timeout":this.num_probe_req_sent++,this.num_probe_req_timeout++;break;case"probe_req_overview_notCached":this.num_probe_req_sent++,this.num_probe_req_notCached++;case"probe_req_sent":this.addToMap(this.probe_sent_map,e);break;case"probe_req_replied":this.addToMap(this.probe_rpl_map,e);break;case"probe_req_timeout":this.addToMap(this.probe_rpl_timeout_map,e);break;case"probe_req_not_cached":this.addToMap(this.probe_rpl_not_cache_map,e);break;case"probe_req_accept":this.num_probe_req_recv++,this.num_probe_req_accept++;break;case"probe_req_notFound":this.num_probe_req_recv++,this.num_probe_req_notFound++;break;case"fragment_req_replied":if(this.num_fragment_req_sent++,this.num_fragment_req_replied++,this.fragment_recv_map.has(e)){var r=this.fragment_recv_map.get(e);r++,this.fragment_recv_map.set(e,r)}else this.fragment_recv_map.set(e,1);break;case"fragment_req_rejected":this.num_fragment_req_sent++,this.num_fragment_req_rejected++;break;case"fragment_req_timeout":this.num_fragment_req_sent++,this.num_fragment_req_timeout++;break;case"fragment_req_accept":if(this.num_fragment_req_recv++,this.num_fragment_req_accept++,this.fragment_sent_map.has(e)){var n=this.fragment_sent_map.get(e);n++,this.fragment_sent_map.set(e,n)}else this.fragment_sent_map.set(e,1);break;case"fragment_req_notSent":this.num_fragment_req_recv++,this.num_fragment_req_notSent++;break;case"fragment_req_failSent":this.num_fragment_req_recv++,this.num_fragment_req_failSent++;break;default:bn.error("invalid result message: ".concat(t))}}},{key:"processFragment",value:function(e,t,r,n){if("toPeer"===t)return this.num_fragment_to_peer++,this.bytes_to_peer+=r,this.avg_to_peer_time+=n,n>this.fragment_size&&this.num_fragment_late_deli_to_peer++,n>this.max_to_peer_time&&(this.max_to_peer_time=n),n<this.min_to_peer_time&&(this.min_to_peer_time=n),void this.addBitrateMap(e,r,"toPeer");0===this.num_fragment?(this.prev_seq=0,this.prev_birate=0):(this.prev_seq=0,this.prev_bitrate<0?this.num_bitrate_down++:0<this.prev_bitrate&&this.num_bitrate_up++,this.prev_bitrate=0),"fromCDN"===t?(this.num_fragment++,this.num_fragment_from_cdn++,this.bytes_from_cdn+=r,this.avg_from_cdn_time+=n,n>this.max_from_cdn_time&&(this.max_from_cdn_time=n),n>this.fragment_size&&this.num_fragment_late_deli_from_cdn++,n<this.min_from_cdn_time&&(this.min_from_cdn_time=n),this.addBitrateMap(e,r,"fromCDN")):"fromPeer"===t?(this.num_fragment++,this.num_fragment_from_peer++,this.bytes_from_peer+=r,this.avg_from_peer_time+=n,n>this.max_from_peer_time&&(this.max_from_peer_time=n),n>this.fragment_size&&this.num_fragment_late_deli_from_peer++,n<this.min_from_peer_time&&(this.min_from_peer_time=n),this.addBitrateMap(e,r,"fromPeer")):bn.error("fragment source type is wrong")}},{key:"sendPayment",value:function(e){this.num_payment_sent++,this.amount_payment_sent=this.amount_payment_sent.plus(e)}},{key:"recvPayment",value:function(e){this.num_payment_recv++,this.amount_payment_recv=this.amount_payment_recv.plus(e)}},{key:"walletTryRecordInitialBalance",value:function(){if(!this.payment_ra_start_gamma_balance&&!this.payment_sa_start_gamma_balance){var e=this.context.wallet.getTFuelBalance();this.payment_sa_start_gamma_balance=e.sa,this.payment_ra_start_gamma_balance=e.ra}}},{key:"walletRPCSucceeded",value:function(e){this.payment_rpc_num_succeeded++,this.payment_rpc_result_map[e]=(this.payment_rpc_result_map[e]||0)+1,this.walletTryRecordInitialBalance()}},{key:"walletRPCFailed",value:function(e){this.payment_rpc_num_failed++,this.payment_rpc_result_map[e]=(this.payment_rpc_result_map[e]||0)+1,this.walletTryRecordInitialBalance()}},{key:"walletPaymentError",value:function(e){if(e&&e.code)switch(e.code){case 1:this.payment_rpc_reserve_succeeded++;break;case 2:this.payment_rpc_reserve_failed++;break;case 3:this.payment_rpc_submit_payment_succeeded++;break;case 4:this.payment_rpc_submit_payment_failed++}}},{key:"walletReserveSucceeded",value:function(){}},{key:"walletReserveFailed",value:function(){}},{key:"walletSubmitPaymentSucceeded",value:function(){}},{key:"walletSubmitPaymentFailed",value:function(){}},{key:"mapToObj",value:function(e){var t={};for(var r in this.context.p2p.peers)e.has(r)&&(t[r]=e.get(r));return t}},{key:"packReport",value:function(){var e=Object.keys(this.context.p2p.peers).length,t=[],r=0,n=0,o=0,i=0,a=this.mapToObj(this.fragment_sent_map),s=this.mapToObj(this.fragment_recv_map),c=this.mapToObj(this.probe_sent_map),u=this.mapToObj(this.probe_rpl_map),f=this.mapToObj(this.probe_rpl_not_cache_map);this.mapToObj(this.probe_rpl_timeout_map);for(var p in this.context.p2p.peers)t.push(p);0<this.num_fragment_from_cdn&&(r=Math.floor(this.avg_from_cdn_time/this.num_fragment_from_cdn)),0<this.num_fragment_from_peer&&(n=Math.floor(this.avg_from_peer_time/this.num_fragment_from_peer)),0<this.num_probe_req_replied&&(o=Math.floor(this.avg_probe_reply_time/this.num_probe_req_replied)),0<this.num_fragment_to_peer&&(i=Math.floor(this.avg_to_peer_time/this.num_fragment_to_peer)),this.report_time=Date.now();var l=this.context.wallet.getTFuelBalance();return this.payment_sa_end_gamma_balance=l.sa,this.payment_ra_end_gamma_balance=l.ra,{id:this.context.p2p.id,user_id:this.context.p2p.userId,client_ip:this.client_ip,device_type:this.browserType,video_id:this.videoId,join_time:Math.floor(this.join_time/1e3),report_time:Math.floor(this.report_time/1e3),peer_ids:JSON.stringify(t),num_peers:e,num_fragment:this.num_fragment,num_fragment_from_cdn:this.num_fragment_from_cdn,num_fragment_from_peer:this.num_fragment_from_peer,num_fragment_to_peer:this.num_fragment_to_peer,num_fragment_missed:this.num_fragment_missed,num_probe_req_sent:this.num_probe_req_sent,num_probe_req_replied:this.num_probe_req_replied,num_probe_req_timeout:this.num_probe_req_timeout,num_fragment_req_sent:this.num_fragment_req_sent,num_fragment_req_replied:this.num_fragment_req_replied,num_fragment_req_rejected:this.num_fragment_req_rejected,num_fragment_req_timeout:this.num_fragment_req_timeout,num_probe_req_recv:this.num_probe_req_recv,num_probe_req_notFound:this.num_probe_req_notFound,num_probe_req_accept:this.num_probe_req_accept,num_fragment_req_recv:this.num_fragment_req_recv,num_fragment_req_notSent:this.num_fragment_req_notSent,num_fragment_req_accept:this.num_fragment_req_accept,num_fragment_req_failSent:this.num_fragment_req_failSent,avg_probe_reply_time:o,max_probe_reply_time:this.max_probe_reply_time,min_probe_reply_time:this.min_probe_reply_time,avg_from_cdn_time:r,max_from_cdn_time:this.max_from_cdn_time,min_from_cdn_time:this.min_from_cdn_time,avg_from_peer_time:n,max_from_peer_time:this.max_from_peer_time,min_from_peer_time:this.min_from_peer_time,avg_to_peer_time:i,max_to_peer_time:this.max_to_peer_time,min_to_peer_time:this.min_to_peer_time,bytes_from_cdn:this.bytes_from_cdn,bytes_from_peer:this.bytes_from_peer,bytes_to_peer:this.bytes_to_peer,num_bitrate_up:this.num_bitrate_up,num_bitrate_down:this.num_bitrate_down,fragment_size:this.fragment_size,num_fragment_late_deli_from_cdn:this.num_fragment_late_deli_from_cdn,num_fragment_late_deli_from_peer:this.num_fragment_late_deli_from_peer,num_fragment_late_deli_to_peer:this.num_fragment_late_deli_to_peer,fragment_sent_map:JSON.stringify(a),fragment_recv_map:JSON.stringify(s),num_payment_sent:this.num_payment_sent,num_payment_recv:this.num_payment_recv,amount_payment_sent:su(this.amount_payment_sent),amount_payment_recv:su(this.amount_payment_recv),payment_sa_start_gamma_balance:su(this.payment_sa_start_gamma_balance),payment_ra_start_gamma_balance:su(this.payment_ra_start_gamma_balance),payment_ra_end_gamma_balance:su(this.payment_ra_end_gamma_balance),payment_sa_end_gamma_balance:su(this.payment_sa_end_gamma_balance),payment_rpc_reserve_succeeded:this.payment_rpc_reserve_succeeded,payment_rpc_reserve_failed:this.payment_rpc_reserve_failed,payment_rpc_submit_payment_succeeded:this.payment_rpc_submit_payment_succeeded,payment_rpc_submit_payment_failed:this.payment_rpc_submit_payment_failed,payment_rpc_num_succeeded:this.payment_rpc_num_succeeded,payment_rpc_num_failed:this.payment_rpc_num_failed,payment_rpc_result_map:JSON.stringify(this.payment_rpc_result_map),probe_recv_map:null,probe_recv_not_cache_map:null,probe_sent_map:JSON.stringify(c),probe_rpl_map:JSON.stringify(u),probe_rpl_not_cache_map:JSON.stringify(f),bitrate_from_cdn_map:JSON.stringify(this.bitrate_from_cdn_map),bitrate_from_peer_map:JSON.stringify(this.bitrate_from_peer_map),bitrate_to_peer_map:JSON.stringify(this.bitrate_to_peer_map)}}},{key:"resetStats",value:function(){this.join_time=Date.now(),this.report_time=0,this.num_fragment=0,this.num_pre_fragment=0,this.num_fragment_from_cdn=0,this.num_fragment_from_peer=0,this.num_fragment_to_peer=0,this.num_fragment_missed=0,this.num_probe_req_sent=0,this.num_probe_req_replied=0,this.num_probe_req_timeout=0,this.num_probe_req_notCached=0,this.num_fragment_req_sent=0,this.num_fragment_req_replied=0,this.num_fragment_req_rejected=0,this.num_fragment_req_timeout=0,this.num_probe_req_recv=0,this.num_probe_req_notFound=0,this.num_probe_req_accept=0,this.num_fragment_req_recv=0,this.num_fragment_req_notSent=0,this.num_fragment_req_accept=0,this.num_fragment_req_failSent=0,this.prev_seq_num=null,this.avg_probe_reply_time=0,this.max_probe_reply_time=0,this.min_probe_reply_time=6e4,this.avg_from_cdn_time=0,this.max_from_cdn_time=0,this.min_from_cdn_time=6e4,this.avg_from_peer_time=0,this.max_from_peer_time=0,this.min_from_peer_time=6e4,this.avg_to_peer_time=0,this.max_to_peer_time=0,this.min_to_peer_time=6e4,this.bytes_from_cdn=0,this.bytes_from_peer=0,this.bytes_to_peer=0,this.num_bitrate_up=0,this.num_bitrate_down=0,this.prev_birate=null,this.fragment_size=4e3,this.num_fragment_late_deli_from_cdn=0,this.num_fragment_late_deli_from_peer=0,this.num_fragment_late_deli_to_peer=0,this.fragment_sent_map=new Map,this.fragment_recv_map=new Map,this.probe_sent_map=new Map,this.probe_rpl_map=new Map,this.probe_rpl_timeout_map=new Map,this.probe_rpl_not_cache_map=new Map,this.num_payment_sent=0,this.num_payment_recv=0,this.amount_payment_sent=yc(0),this.amount_payment_recv=yc(0),this.payment_ra_start_gamma_balance=void 0,this.payment_sa_start_gamma_balance=void 0,this.payment_ra_end_gamma_balance=void 0,this.payment_sa_end_gamma_balance=void 0,this.walletTryRecordInitialBalance(),this.payment_rpc_reserve_succeeded=0,this.payment_rpc_reserve_failed=0,this.payment_rpc_submit_payment_succeeded=0,this.payment_rpc_submit_payment_failed=0,this.payment_rpc_result_map={},this.payment_rpc_num_succeeded=0,this.payment_rpc_num_failed=0,this.bitrate_from_cdn_map={},this.bitrate_from_peer_map={},this.bitrate_to_peer_map={}}},{key:"printStats",value:function(){var e=Object.keys(this.context.p2p.peers).length,t=[];for(var r in this.context.p2p.peers)t.push(r);this.report_time=Date.now(),bn.info("client_ip - ",this.client_ip),bn.info("id - ",this.context.p2p.id),bn.info("browserType - ",this.browserType),bn.info("videoId - ",this.videoId),bn.info("join_time -",new Date(this.join_time)),bn.info("report_time -",new Date(this.report_time)),bn.info("peer_ids - ",t),bn.info("num_peers - ",e),bn.info("---- sender stats ----"),bn.info("num_probe_req_sent - ",this.num_probe_req_sent),bn.info("num_probe_req_replied",this.num_probe_req_replied),bn.info("num_probe_req_timeout - ",this.num_probe_req_timeout),bn.info("num_probe_req_notCached -",this.num_probe_req_notCached),bn.info("num_fragment_req_sent - ",this.num_fragment_req_sent),bn.info("num_fragment_req_timeout",this.num_fragment_req_timeout),bn.info("num_fragment_req_rejected",this.num_fragment_req_rejected),bn.info("num_fragment_req_replied",this.num_fragment_req_replied),bn.info("num_fragment -",this.num_fragment),bn.info("num_fragment_from_cdn -",this.num_fragment_from_cdn),bn.info("num_fragment_from_peer -",this.num_fragment_from_peer),bn.info("num_fragment_missed -",this.num_fragment_missed),bn.info("bytes_from_cdn -",this.bytes_from_cdn),bn.info("bytes_from_peer -",this.bytes_from_peer),bn.info("num_fragment_late_deli_from_cdn - ",this.num_fragment_late_deli_from_cdn),bn.info("num_fragment_late_deli_from_peer - ",this.num_fragment_late_deli_from_peer),bn.info("max_from_cdn_time - ",this.max_from_cdn_time),bn.info("min_from_cdn_time - ",this.min_from_cdn_time),bn.info("max_from_peer_time - ",this.max_from_peer_time),bn.info("min_from_peer_time - ",this.min_from_peer_time),bn.info("max_probe_reply_time - ",this.max_probe_reply_time),bn.info("min_probe_reply_time - ",this.min_probe_reply_time),0<this.num_fragment_from_cdn&&bn.info("avg_from_cdn_time - ",this.avg_from_cdn_time/this.num_fragment_from_cdn),0<this.num_fragment_from_peer&&bn.info("avg_from_peer_time - ",this.avg_from_peer_time/this.num_fragment_from_peer),0<this.num_probe_req_replied&&bn.info("avg_probe_reply_time - ",this.avg_probe_reply_time/this.num_probe_req_replied),bn.info("---- receiver stats ----"),bn.info("num_probe_req_recv - ",this.num_probe_req_recv),bn.info("num_probe_req_accept - ",this.num_probe_req_accept),bn.info("num_probe_req_notFound - ",this.num_probe_req_notFound),bn.info("num_fragment_req_recv - ",this.num_fragment_req_recv),bn.info("num_fragment_req_accept - ",this.num_fragment_req_accept),bn.info("num_fragment_req_notSent - ",this.num_fragment_req_notSent),bn.info("num_fragment_req_failSent - ",this.num_fragment_req_failSent),bn.info("num_fragment_to_peer -",this.num_fragment_to_peer),bn.info("bytes_to_peer -",this.bytes_to_peer),bn.info("num_fragment_late_deli_to_peer - ",this.num_fragment_late_deli_to_peer),bn.info("max_to_peer_time - ",this.max_to_peer_time),bn.info("min_to_peer_time - ",this.min_to_peer_time),0<this.num_fragment_to_peer&&bn.info("avg_to_peer_time - ",this.avg_to_peer_time/this.num_fragment_to_peer),bn.info("---- probe sent counter map ----");var n=!0,o=!1,i=void 0;try{for(var a,s=this.probe_sent_map[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=ft(a.value,2),u=c[0],f=c[1];bn.info(u,f)}}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}bn.info("---- probe got replied counter map ----");var p=!0,l=!1,h=void 0;try{for(var d,y=this.probe_rpl_map[Symbol.iterator]();!(p=(d=y.next()).done);p=!0){var m=ft(d.value,2),g=m[0],v=m[1];bn.info(g,v)}}catch(e){l=!0,h=e}finally{try{p||null==y.return||y.return()}finally{if(l)throw h}}bn.info("---- probe got replied not cached counter map ----");var _=!0,b=!1,w=void 0;try{for(var k,x=this.probe_rpl_not_cache_map[Symbol.iterator]();!(_=(k=x.next()).done);_=!0){var S=ft(k.value,2),C=S[0],T=S[1];bn.info(C,T)}}catch(e){b=!0,w=e}finally{try{_||null==x.return||x.return()}finally{if(b)throw w}}bn.info("---- probe got replied timeout counter map ----");var E=!0,P=!1,R=void 0;try{for(var A,O=this.probe_rpl_timeout_map[Symbol.iterator]();!(E=(A=O.next()).done);E=!0){var B=ft(A.value,2),I=B[0],N=B[1];bn.info(I,N)}}catch(e){P=!0,R=e}finally{try{E||null==O.return||O.return()}finally{if(P)throw R}}bn.info("---- recv counter map ----");var D=!0,M=!1,j=void 0;try{for(var q,F=this.fragment_recv_map[Symbol.iterator]();!(D=(q=F.next()).done);D=!0){var L=ft(q.value,2),U=L[0],z=L[1];bn.info(U,z)}}catch(e){M=!0,j=e}finally{try{D||null==F.return||F.return()}finally{if(M)throw j}}bn.info("---- sent counter map ----");var H=!0,W=!1,V=void 0;try{for(var G,J=this.fragment_sent_map[Symbol.iterator]();!(H=(G=J.next()).done);H=!0){var Y=ft(G.value,2),X=Y[0],K=Y[1];bn.info(X,K)}}catch(e){W=!0,V=e}finally{try{H||null==J.return||J.return()}finally{if(W)throw V}}bn.info("---- birate counter map ----"),bn.info("bitrate_from_cdn_map: ".concat(JSON.stringify(this.bitrate_from_cdn_map))),bn.info("bitrate_from_peer_map: ".concat(JSON.stringify(this.bitrate_from_peer_map))),bn.info("bitrate_to_peer_map: ".concat(JSON.stringify(this.bitrate_to_peer_map)))}},{key:"sendReport",value:(e=rt(regeneratorRuntime.mark(function e(){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){bn.info("---- player stats report ----");try{var r=n.packReport();n.context.socket.emit("clientstats",r),bn.isLoggingEnabled()&&n.printStats(),e("reporting done successfully")}catch(e){bn.error("Exception: error message - ".concat(e.message)),t(e.message)}}));case 1:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"getDeviceType",value:function(){var e="";return navigator.userAgent&&(e=navigator.userAgent.match(/mobile/i)?"Mobile":navigator.userAgent.match(/iPad|Android|Touch/i)?"Tablet":"Desktop"),e}},{key:"getBrowserType",value:function(){var e="unknown";return-1!==(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))?e="Opera":-1!==navigator.userAgent.indexOf("Chrome")?e="Chrome":-1!==navigator.userAgent.indexOf("Safari")?e="Safari":-1!==navigator.userAgent.indexOf("Firefox")?e="Firefox":-1!==navigator.userAgent.indexOf("MSIE")||!0==!!document.documentMode?e="IE":bn.warn("Unknown browser type"),!0===this.context.config.allowGeoLocation&&this.getGeoLocation(),this.getDeviceType()+":"+e}},{key:"getGeoLocation",value:function(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(e){bn.info("[Geolocation frontend] v1"),bn.info(e);var t={type:"success",data:{coords:{accuracy:e.coords.accuracy,latitude:e.coords.latitude,longitude:e.coords.longitude},timestamp:e.timestamp}};this.browserType+="|"+JSON.stringify(t),bn.info("brower type: "+this.browserType),bn.info(t)}.bind(this),function(e){var t="";switch(e.code){case e.PERMISSION_DENIED:t="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:t="Location information is unavailable.";break;case e.TIMEOUT:t="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:t="An unknown error occurred."}bn.warn("[Geolocation frontend] "+t);var r={type:"error",data:t};this.browserType+="|"+JSON.stringify(r)}.bind(this),{enableHighAccuracy:!0,maximumAge:5e4});else{var e="Geolocation is not supported by this browser.";bn.warn("[Geolocation frontend] "+e);var t={type:"error",data:e};this.browserType+="|"+JSON.stringify(t)}}}]),r}(),fu={videoID:null,userID:null,wallet:null,trackerServer:{host:"beta-grouping-1.sliver.tv",port:8700,secure:!0,path:""},peerServer:{host:"beta-grouping-1.sliver.tv",port:8700,secure:!0,path:"/"},useCDN:!1,fragmentSize:6e3,failoverFactor:.7,statsReportInterval:9e4,peerReqInterval:12e4,probeTimeout:600,fragmentTimeout:3e3,maxConcurrentPeerTxs:1,allowGeoLocation:!1,allowRangeRequests:!0,debug:!1},pu=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,lu=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],hu=function(e){var t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));for(var o=pu.exec(e||""),i={},a=14;a--;)i[lu[a]]=o[a]||"";return-1!=r&&-1!=n&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i},du=36e5,yu=864e5;function mu(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var gu=e(function(e,c){function t(e){var n;function s(){if(s.enabled){var o=s,e=+new Date,t=e-(n||e);o.diff=t,o.prev=n,o.curr=e,n=e;for(var i=new Array(arguments.length),r=0;r<i.length;r++)i[r]=arguments[r];i[0]=c.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var a=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;a++;var r=c.formatters[t];if("function"==typeof r){var n=i[a];e=r.call(o,n),i.splice(a,1),a--}return e}),c.formatArgs.call(o,i),(s.log||c.log||console.log.bind(console)).apply(o,i)}}return s.namespace=e,s.enabled=c.enabled(e),s.useColors=c.useColors(),s.color=function(e){var t,r=0;for(t in e)r=(r<<5)-r+e.charCodeAt(t),r|=0;return c.colors[Math.abs(r)%c.colors.length]}(e),s.destroy=r,"function"==typeof c.init&&c.init(s),c.instances.push(s),s}function r(){var e=c.instances.indexOf(this);return-1!==e&&(c.instances.splice(e,1),!0)}(c=e.exports=t.debug=t.default=t).coerce=function(e){return e instanceof Error?e.stack||e.message:e},c.disable=function(){c.enable("")},c.enable=function(e){var t;c.save(e),c.names=[],c.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?c.skips.push(new RegExp("^"+e.substr(1)+"$")):c.names.push(new RegExp("^"+e+"$")));for(t=0;t<c.instances.length;t++){var o=c.instances[t];o.enabled=c.enabled(o.namespace)}},c.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=c.skips.length;t<r;t++)if(c.skips[t].test(e))return!1;for(t=0,r=c.names.length;t<r;t++)if(c.names[t].test(e))return!0;return!1},c.humanize=cu,c.instances=[],c.names=[],c.skips=[],c.formatters={}}),vu=(gu.coerce,gu.disable,gu.enable,gu.enabled,gu.humanize,gu.instances,gu.names,gu.skips,gu.formatters,e(function(e,i){function t(){var e;try{e=i.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(i=e.exports=gu).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},i.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+i.humanize(this.diff),!t)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(o=n))}),e.splice(o,0,r)},i.save=function(e){try{null==e?i.storage.removeItem("debug"):i.storage.debug=e}catch(e){}},i.load=t,i.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},i.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],i.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},i.enable(t())})),_u=(vu.log,vu.formatArgs,vu.save,vu.load,vu.useColors,vu.storage,vu.colors,vu("socket.io-client:url")),bu=function(e,t){var r=e;t=t||_.location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(_u("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),_u("parse %s",e),r=hu(e));r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443"));r.path=r.path||"/";var n=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+n+":"+r.port,r.href=r.protocol+"://"+n+(t&&t.port===r.port?"":":"+r.port),r};var wu=e(function(e){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}(e.exports=r).prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<n.length;o++)if((r=n[o])===t||r.fn===t){n.splice(o,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,o=(r=r.slice(0)).length;n<o;++n)r[n].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),ku={}.toString,xu=Array.isArray||function(e){return"[object Array]"==ku.call(e)},Su=function(e){return Cu&&_.Buffer.isBuffer(e)||Tu&&(e instanceof _.ArrayBuffer||Eu(e))},Cu="function"==typeof _.Buffer&&"function"==typeof _.Buffer.isBuffer,Tu="function"==typeof _.ArrayBuffer,Eu=Tu&&"function"==typeof _.ArrayBuffer.isView?_.ArrayBuffer.isView:function(e){return e.buffer instanceof _.ArrayBuffer};var Pu=Object.prototype.toString,Ru="function"==typeof _.Blob||"[object BlobConstructor]"===Pu.call(_.Blob),Au="function"==typeof _.File||"[object FileConstructor]"===Pu.call(_.File);function Ou(e){var t=e.xdomain,r=e.xscheme,n=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||Mu))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&n)return new XDomainRequest}catch(e){}if(!t)try{return new(_[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}var Bu=function(e){var t=[],r=e.data,n=e;return n.data=function e(t,r){if(!t)return t;{if(Su(t)){var n={_placeholder:!0,num:r.length};return r.push(t),n}if(xu(t)){for(var o=new Array(t.length),i=0;i<t.length;i++)o[i]=e(t[i],r);return o}if("object"==typeof t&&!(t instanceof Date)){var o={};for(var a in t)o[a]=e(t[a],r);return o}}return t}(r,t),n.attachments=t.length,{packet:n,buffers:t}},Iu=function(e,t){return e.data=function e(t,r){if(!t)return t;{if(t&&t._placeholder)return r[t.num];if(xu(t))for(var n=0;n<t.length;n++)t[n]=e(t[n],r);else if("object"==typeof t)for(var o in t)t[o]=e(t[o],r)}return t}(e.data,t),e.attachments=void 0,e},Nu=function(e,s){var c=0,u=e;!function e(t,r,n){if(!t)return t;if(Ru&&t instanceof Blob||Au&&t instanceof File){c++;var o=new FileReader;o.onload=function(){n?n[r]=this.result:u=this.result,--c||s(u)},o.readAsArrayBuffer(t)}else if(xu(t))for(var i=0;i<t.length;i++)e(t[i],i,t);else if("object"==typeof t&&!Su(t))for(var a in t)e(t[a],a,t)}(u),c||s(u)},Du=e(function(e,s){var c=vu("socket.io-parser");function t(){}s.protocol=4,s.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],s.CONNECT=0,s.DISCONNECT=1,s.EVENT=2,s.ACK=3,s.ERROR=4,s.BINARY_EVENT=5,s.BINARY_ACK=6,s.Encoder=t,s.Decoder=r;var n=s.ERROR+'"encode error"';function i(e){var t=""+e.type;if(s.BINARY_EVENT!==e.type&&s.BINARY_ACK!==e.type||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data){var r=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===r)return n;t+=r}return c("encoded %j as %s",e,t),t}function r(){this.reconstructor=null}function o(e){this.reconPack=e,this.buffers=[]}function u(e){return{type:s.ERROR,data:"parser error: "+e}}t.prototype.encode=function(e,t){var o;(c("encoding packet %j",e),s.BINARY_EVENT===e.type||s.BINARY_ACK===e.type)?(o=t,Nu(e,function(e){var t=Bu(e),r=i(t.packet),n=t.buffers;n.unshift(r),o(n)})):t([i(e)])},wu(r.prototype),r.prototype.add=function(e){var t;if("string"==typeof e)t=function(e){var t=0,r={type:Number(e.charAt(0))};if(null==s.types[r.type])return u("unknown packet type "+r.type);if(s.BINARY_EVENT===r.type||s.BINARY_ACK===r.type){for(var n="";"-"!==e.charAt(++t)&&(n+=e.charAt(t),t!=e.length););if(n!=Number(n)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(n)}if("/"===e.charAt(t+1))for(r.nsp="";++t;){if(","===(i=e.charAt(t)))break;if(r.nsp+=i,t===e.length)break}else r.nsp="/";var o=e.charAt(t+1);if(""!==o&&Number(o)==o){for(r.id="";++t;){var i;if(null==(i=e.charAt(t))||Number(i)!=i){--t;break}if(r.id+=e.charAt(t),t===e.length)break}r.id=Number(r.id)}if(e.charAt(++t)){var a=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!(!1!==a&&(r.type===s.ERROR||xu(a))))return u("invalid payload");r.data=a}return c("decoded %s as %j",e,r),r}(e),s.BINARY_EVENT===t.type||s.BINARY_ACK===t.type?(this.reconstructor=new o(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!Su(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},r.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},o.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length!==this.reconPack.attachments)return null;var t=Iu(this.reconPack,this.buffers);return this.finishedReconstruction(),t},o.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}),Mu=(Du.protocol,Du.types,Du.CONNECT,Du.DISCONNECT,Du.EVENT,Du.ACK,Du.ERROR,Du.BINARY_EVENT,Du.BINARY_ACK,Du.Encoder,Du.Decoder,e(function(t){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}})),ju=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t},qu=Object.prototype.toString,Fu="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===qu.call(Blob),Lu="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===qu.call(File),Uu=function e(t){if(!t||"object"!=typeof t)return!1;if(xu(t)){for(var r=0,n=t.length;r<n;r++)if(e(t[r]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||Fu&&t instanceof Blob||Lu&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&e(t[o]))return!0;return!1};function zu(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),n<r&&(r=n),n<=t||r<=t||0===n)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(r-t),a=t,s=0;a<r;a++,s++)i[s]=o[a];return i.buffer}var Hu=function(e,r,n){var o=!1;return n=n||Wu,0===(i.count=e)?r():i;function i(e,t){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,r(e),r=n):0!==i.count||o||r(null,t)}};function Wu(){}var Vu=e(function(g,v){!function(e){var t=v,r=g&&g.exports==t&&g,n="object"==typeof _&&_;n.global!==n&&n.window!==n||(e=n);var i,a,s,c=String.fromCharCode;function u(e){for(var t,r,n=[],o=0,i=e.length;o<i;)55296<=(t=e.charCodeAt(o++))&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function o(e,t){if(55296<=e&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function f(e,t){return c(e>>t&63|128)}function p(e,t){if(0==(4294967168&e))return c(e);var r="";return 0==(4294965248&e)?r=c(e>>6&31|192):0==(4294901760&e)?(o(e,t)||(e=65533),r=c(e>>12&15|224),r+=f(e,6)):0==(4292870144&e)&&(r=c(e>>18&7|240),r+=f(e,12),r+=f(e,6)),r+=c(63&e|128)}function l(){if(a<=s)throw Error("Invalid byte index");var e=255&i[s];if(s++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function h(e){var t,r;if(a<s)throw Error("Invalid byte index");if(s==a)return!1;if(t=255&i[s],s++,0==(128&t))return t;if(192==(224&t)){if(128<=(r=(31&t)<<6|l()))return r;throw Error("Invalid continuation byte")}if(224==(240&t)){if(2048<=(r=(15&t)<<12|l()<<6|l()))return o(r,e)?r:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&65536<=(r=(7&t)<<18|l()<<12|l()<<6|l())&&r<=1114111)return r;throw Error("Invalid UTF-8 detected")}var d={version:"2.1.2",encode:function(e,t){for(var r=!1!==(t=t||{}).strict,n=u(e),o=n.length,i=-1,a="";++i<o;)a+=p(n[i],r);return a},decode:function(e,t){var r=!1!==(t=t||{}).strict;i=u(e),a=i.length,s=0;for(var n,o=[];!1!==(n=h(r));)o.push(n);return function(e){for(var t,r=e.length,n=-1,o="";++n<r;)65535<(t=e[n])&&(o+=c((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=c(t);return o}(o)}};if(t&&!t.nodeType)if(r)r.exports=d;else{var y={}.hasOwnProperty;for(var m in d)y.call(d,m)&&(t[m]=d[m])}else e.utf8=d}(_)}),Gu=e(function(e,t){!function(){for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=new Uint8Array(256),e=0;e<i.length;e++)p[i.charCodeAt(e)]=e;t.encode=function(e){var t,r=new Uint8Array(e),n=r.length,o="";for(t=0;t<n;t+=3)o+=i[r[t]>>2],o+=i[(3&r[t])<<4|r[t+1]>>4],o+=i[(15&r[t+1])<<2|r[t+2]>>6],o+=i[63&r[t+2]];return n%3==2?o=o.substring(0,o.length-1)+"=":n%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,r,n,o,i,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),f=new Uint8Array(u);for(t=0;t<s;t+=4)r=p[e.charCodeAt(t)],n=p[e.charCodeAt(t+1)],o=p[e.charCodeAt(t+2)],i=p[e.charCodeAt(t+3)],f[c++]=r<<2|n>>4,f[c++]=(15&n)<<4|o>>2,f[c++]=(3&o)<<6|63&i;return u}}()}),Ju=(Gu.encode,Gu.decode,_.BlobBuilder||_.WebKitBlobBuilder||_.MSBlobBuilder||_.MozBlobBuilder),Yu=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),Xu=Yu&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),Ku=Ju&&Ju.prototype.append&&Ju.prototype.getBlob;function $u(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var o=new Uint8Array(r.byteLength);o.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=o.buffer}e[t]=n}}}function Qu(e,t){t=t||{};var r=new Ju;$u(e);for(var n=0;n<e.length;n++)r.append(e[n]);return t.type?r.getBlob(t.type):r.getBlob()}function Zu(e,t){return $u(e),new Blob(e,t||{})}var ef=Yu?Xu?_.Blob:Zu:Ku?Qu:void 0,tf=e(function(e,l){var o;_&&_.ArrayBuffer&&(o=Gu);var t="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),r="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),u=t||r;l.protocol=3;var f=l.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},i=ju(f),h={type:"error",data:"parser error"};function a(e,t,r){function n(r,e,n){t(e,function(e,t){o[r]=t,n(e,o)})}for(var o=new Array(e.length),i=Hu(e.length,r),a=0;a<e.length;a++)n(a,e[a],i)}l.encodePacket=function(e,t,r,n){"function"==typeof t&&(n=t,t=!1),"function"==typeof r&&(n=r,r=null);var o,i,a,s=void 0===e.data?void 0:e.data.buffer||e.data;if(_.ArrayBuffer&&s instanceof ArrayBuffer)return function(e,t,r){if(!t)return l.encodeBase64Packet(e,r);var n=e.data,o=new Uint8Array(n),i=new Uint8Array(1+n.byteLength);i[0]=f[e.type];for(var a=0;a<o.length;a++)i[a+1]=o[a];return r(i.buffer)}(e,t,n);if(ef&&s instanceof _.Blob)return function(e,t,r){if(!t)return l.encodeBase64Packet(e,r);if(u)return function(e,t,r){if(!t)return l.encodeBase64Packet(e,r);var n=new FileReader;return n.onload=function(){e.data=n.result,l.encodePacket(e,t,!0,r)},n.readAsArrayBuffer(e.data)}(e,t,r);var n=new Uint8Array(1);n[0]=f[e.type];var o=new ef([n.buffer,e.data]);return r(o)}(e,t,n);if(s&&s.base64)return o=e,i=n,a="b"+l.packets[o.type]+o.data.data,i(a);var c=f[e.type];return void 0!==e.data&&(c+=r?Vu.encode(String(e.data),{strict:!1}):String(e.data)),n(""+c)},l.encodeBase64Packet=function(t,r){var n,o="b"+l.packets[t.type];if(ef&&t.data instanceof _.Blob){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];r(o+e)},i.readAsDataURL(t.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var a=new Uint8Array(t.data),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a[c];n=String.fromCharCode.apply(null,s)}return o+=_.btoa(n),r(o)},l.decodePacket=function(e,t,r){if(void 0===e)return h;if("string"==typeof e){if("b"===e.charAt(0))return l.decodeBase64Packet(e.substr(1),t);if(r&&!1===(e=function(e){try{e=Vu.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return h;var n=e.charAt(0);return Number(n)==n&&i[n]?1<e.length?{type:i[n],data:e.substring(1)}:{type:i[n]}:h}n=new Uint8Array(e)[0];var o=zu(e,1);return ef&&"blob"===t&&(o=new ef([o])),{type:i[n],data:o}},l.decodeBase64Packet=function(e,t){var r=i[e.charAt(0)];if(!o)return{type:r,data:{base64:!0,data:e.substr(1)}};var n=o.decode(e.substr(1));return"blob"===t&&ef&&(n=new ef([n])),{type:r,data:n}},l.encodePayload=function(e,t,r){"function"==typeof t&&(r=t,t=null);var n=Uu(e);if(t&&n)return ef&&!u?l.encodePayloadAsBlob(e,r):l.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");a(e,function(e,r){l.encodePacket(e,!!n&&t,!1,function(e){var t;r(null,(t=e).length+":"+t)})},function(e,t){return r(t.join(""))})},l.decodePayload=function(e,t,r){if("string"!=typeof e)return l.decodePayloadAsBinary(e,t,r);var n;if("function"==typeof t&&(r=t,t=null),""===e)return r(h,0,1);for(var o,i,a="",s=0,c=e.length;s<c;s++){var u=e.charAt(s);if(":"===u){if(""===a||a!=(o=Number(a)))return r(h,0,1);if(a!=(i=e.substr(s+1,o)).length)return r(h,0,1);if(i.length){if(n=l.decodePacket(i,t,!1),h.type===n.type&&h.data===n.data)return r(h,0,1);if(!1===r(n,s+o,c))return}s+=o,a=""}else a+=u}return""!==a?r(h,0,1):void 0},l.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));a(e,function(e,t){l.encodePacket(e,!0,!0,function(e){return t(null,e)})},function(e,t){var r=t.reduce(function(e,t){var r;return e+(r="string"==typeof t?t.length:t.byteLength).toString().length+r+2},0),a=new Uint8Array(r),s=0;return t.forEach(function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);r=n.buffer}a[s++]=t?0:1;var i=r.byteLength.toString();for(o=0;o<i.length;o++)a[s++]=parseInt(i[o]);a[s++]=255;for(n=new Uint8Array(r),o=0;o<n.length;o++)a[s++]=n[o]}),n(a.buffer)})},l.encodePayloadAsBlob=function(e,r){a(e,function(e,s){l.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);e=r.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),i=new Uint8Array(o.length+1);for(n=0;n<o.length;n++)i[n]=parseInt(o[n]);if(i[o.length]=255,ef){var a=new ef([t.buffer,i.buffer,e]);s(null,a)}})},function(e,t){return r(new ef(t))})},l.decodePayloadAsBinary=function(e,r,n){"function"==typeof r&&(n=r,r=null);for(var t=e,o=[];0<t.byteLength;){for(var i=new Uint8Array(t),a=0===i[0],s="",c=1;255!==i[c];c++){if(310<s.length)return n(h,0,1);s+=i[c]}t=zu(t,2+s.length),s=parseInt(s);var u=zu(t,0,s);if(a)try{u=String.fromCharCode.apply(null,new Uint8Array(u))}catch(e){var f=new Uint8Array(u);u="";for(c=0;c<f.length;c++)u+=String.fromCharCode(f[c])}o.push(u),t=zu(t,s)}var p=o.length;o.forEach(function(e,t){n(l.decodePacket(e,r,!0),t,p)})}}),rf=(tf.protocol,tf.packets,tf.encodePacket,tf.encodeBase64Packet,tf.decodePacket,tf.decodeBase64Packet,tf.encodePayload,tf.decodePayload,tf.encodePayloadAsArrayBuffer,tf.encodePayloadAsBlob,tf.decodePayloadAsBinary,nf);function nf(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}wu(nf.prototype),nf.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},nf.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},nf.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},nf.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},nf.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},nf.prototype.onData=function(e){var t=tf.decodePacket(e,this.socket.binaryType);this.onPacket(t)},nf.prototype.onPacket=function(e){this.emit("packet",e)},nf.prototype.onClose=function(){this.readyState="closed",this.emit("close")};function of(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}var af,sf={encode:function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},decode:function(e){for(var t={},r=e.split("&"),n=0,o=r.length;n<o;n++){var i=r[n].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},cf="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),uf=64,ff={},pf=0,lf=0;function hf(e){for(var t="";t=cf[e%uf]+t,0<(e=Math.floor(e/uf)););return t}function df(){var e=hf(+new Date);return e!==af?(pf=0,af=e):e+"."+hf(pf++)}for(;lf<uf;lf++)ff[cf[lf]]=lf;df.encode=hf,df.decode=function(e){var t=0;for(lf=0;lf<e.length;lf++)t=t*uf+ff[e.charAt(lf)];return t};var yf=df,mf=vu("engine.io-client:polling"),gf=_f,vf=null!=new Ou({xdomain:!1}).responseType;function _f(e){var t=e&&e.forceBase64;vf&&!t||(this.supportsBinary=!1),rf.call(this,e)}of(_f,rf),_f.prototype.name="polling",_f.prototype.doOpen=function(){this.poll()},_f.prototype.pause=function(e){var t=this;function r(){mf("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(mf("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){mf("pre-pause polling complete"),--n||r()})),this.writable||(mf("we are currently writing - waiting to pause"),n++,this.once("drain",function(){mf("pre-pause writing complete"),--n||r()}))}else r()},_f.prototype.poll=function(){mf("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},_f.prototype.onData=function(e){var n=this;mf("polling got data %s",e);tf.decodePayload(e,this.socket.binaryType,function(e,t,r){if("opening"===n.readyState&&n.onOpen(),"close"===e.type)return n.onClose(),!1;n.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():mf('ignoring poll - transport state "%s"',this.readyState))},_f.prototype.doClose=function(){var e=this;function t(){mf("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(mf("transport open - closing"),t()):(mf("transport not open - deferring close"),this.once("open",t))},_f.prototype.write=function(e){var t=this;this.writable=!1;function r(){t.writable=!0,t.emit("drain")}tf.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})},_f.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=yf()),this.supportsBinary||e.sid||(e.b64=1),e=sf.encode(e),this.port&&("https"==t&&443!==Number(this.port)||"http"==t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e};var bf=vu("engine.io-client:polling-xhr"),wf=Sf,kf=Cf;function xf(){}function Sf(e){if(gf.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,_.location){var t="https:"===location.protocol,r=location.port;r=r||(t?443:80),this.xd=e.hostname!==_.location.hostname||r!==e.port,this.xs=e.secure!==t}}function Cf(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function Tf(){for(var e in Cf.requests)Cf.requests.hasOwnProperty(e)&&Cf.requests[e].abort()}of(Sf,gf),Sf.prototype.supportsBinary=!0,Sf.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new Cf(e)},Sf.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),o=this;n.on("success",t),n.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=n},Sf.prototype.doPoll=function(){bf("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},wu(Cf.prototype),Cf.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new Ou(e),r=this;try{bf("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var n in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.extraHeaders[n])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");r.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?r.onLoad():setTimeout(function(){r.onError(t.status)},0))},bf("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}_.document&&(this.index=Cf.requestsCount++,Cf.requests[this.index]=this)},Cf.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Cf.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},Cf.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},Cf.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=xf:this.xhr.onreadystatechange=xf,e)try{this.xhr.abort()}catch(e){}_.document&&delete Cf.requests[this.index],this.xhr=null}},Cf.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},Cf.prototype.hasXDR=function(){return void 0!==_.XDomainRequest&&!this.xs&&this.enablesXDR},Cf.prototype.abort=function(){this.cleanup()},Cf.requestsCount=0,Cf.requests={},_.document&&(_.attachEvent?_.attachEvent("onunload",Tf):_.addEventListener&&_.addEventListener("beforeunload",Tf,!1)),wf.Request=kf;var Ef,Pf=Bf,Rf=/\n/g,Af=/\\n/g;function Of(){}function Bf(e){gf.call(this,e),this.query=this.query||{},Ef||(_.___eio||(_.___eio=[]),Ef=_.___eio),this.index=Ef.length;var t=this;Ef.push(function(e){t.onData(e)}),this.query.j=this.index,_.document&&_.addEventListener&&_.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=Of)},!1)}of(Bf,gf),Bf.prototype.supportsBinary=!1,Bf.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),gf.prototype.doClose.call(this)},Bf.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(e,r):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},Bf.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,o=document.createElement("form"),i=document.createElement("textarea"),a=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=a,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function s(){c(),t()}function c(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),c(),e=e.replace(Af,"\\\n"),this.area.value=e.replace(Rf,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&s()}:this.iframe.onload=s};var If,Nf,Df=(If=Object.freeze({__proto__:null,default:{}}))&&If.default||If,Mf=vu("engine.io-client:websocket"),jf=_.WebSocket||_.MozWebSocket;if("undefined"==typeof window)try{Nf=Df}catch(e){}var qf=jf;qf||"undefined"!=typeof window||(qf=Nf);var Ff=Lf;function Lf(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=jf&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(qf=Nf),rf.call(this,e)}of(Lf,rf),Lf.prototype.name="websocket",Lf.prototype.supportsBinary=!0,Lf.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new qf(e,t):new qf(e):new qf(e,t,r)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},Lf.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},Lf.prototype.write=function(e){var n=this;this.writable=!1;for(var o=e.length,t=0,r=o;t<r;t++)!function(r){tf.encodePacket(r,n.supportsBinary,function(e){if(!n.usingBrowserWebSocket){var t={};if(r.options&&(t.compress=r.options.compress),n.perMessageDeflate)("string"==typeof e?_.Buffer.byteLength(e):e.length)<n.perMessageDeflate.threshold&&(t.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(e):n.ws.send(e,t)}catch(e){Mf("websocket closed before onclose event")}--o||i()})}(e[t]);function i(){n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0)}},Lf.prototype.onClose=function(){rf.prototype.onClose.call(this)},Lf.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},Lf.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"==t&&443!==Number(this.port)||"ws"==t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=yf()),this.supportsBinary||(e.b64=1),(e=sf.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},Lf.prototype.check=function(){return!(!qf||"__initialize"in qf&&this.name===Lf.prototype.name)};function Uf(e,t){if(Hf)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}var zf={polling:function(e){var t=!1,r=!1,n=!1!==e.jsonp;if(_.location){var o="https:"===location.protocol,i=location.port;i=i||(o?443:80),t=e.hostname!==location.hostname||i!==e.port,r=e.secure!==o}{if(e.xdomain=t,e.xscheme=r,"open"in new Ou(e)&&!e.forceJSONP)return new wf(e);if(!n)throw new Error("JSONP disabled");return new Pf(e)}},websocket:Ff},Hf=[].indexOf,Wf=vu("engine.io-client:socket"),Vf=Gf;function Gf(e,t){if(!(this instanceof Gf))return new Gf(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=hu(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=hu(t.host).host),this.secure=null!=t.secure?t.secure:_.location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(_.location?location.hostname:"localhost"),this.port=t.port||(_.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=sf.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode;var r="object"==typeof _&&_;r.global===r&&(t.extraHeaders&&0<Object.keys(t.extraHeaders).length&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Gf.priorWebsocketSuccess=!1,wu(Gf.prototype),Gf.protocol=tf.protocol,(Gf.Socket=Gf).Transport=rf,Gf.transports=zf,Gf.parser=tf,Gf.prototype.createTransport=function(e){Wf('creating transport "%s"',e);var t=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(this.query);t.EIO=tf.protocol,t.transport=e;var r=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new zf[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0})},Gf.prototype.open=function(){var e;if(this.rememberUpgrade&&Gf.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},Gf.prototype.setTransport=function(e){Wf("setting transport %s",e.name);var t=this;this.transport&&(Wf("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),(this.transport=e).on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},Gf.prototype.probe=function(r){Wf('probing transport "%s"',r);var n=this.createTransport(r,{probe:1}),o=!1,i=this;function e(){if(i.onlyBinaryUpgrades){var e=!this.supportsBinary&&i.transport.supportsBinary;o=o||e}o||(Wf('probe transport "%s" opened',r),n.send([{type:"ping",data:"probe"}]),n.once("packet",function(e){if(!o)if("pong"===e.type&&"probe"===e.data){if(Wf('probe transport "%s" pong',r),i.upgrading=!0,i.emit("upgrading",n),!n)return;Gf.priorWebsocketSuccess="websocket"===n.name,Wf('pausing current transport "%s"',i.transport.name),i.transport.pause(function(){o||"closed"!==i.readyState&&(Wf("changing transport and sending upgrade packet"),f(),i.setTransport(n),n.send([{type:"upgrade"}]),i.emit("upgrade",n),n=null,i.upgrading=!1,i.flush())})}else{Wf('probe transport "%s" failed',r);var t=new Error("probe error");t.transport=n.name,i.emit("upgradeError",t)}}))}function a(){o||(o=!0,f(),n.close(),n=null)}function t(e){var t=new Error("probe error: "+e);t.transport=n.name,a(),Wf('probe transport "%s" failed because of error: %s',r,e),i.emit("upgradeError",t)}function s(){t("transport closed")}function c(){t("socket closed")}function u(e){n&&e.name!==n.name&&(Wf('"%s" works - aborting "%s"',e.name,n.name),a())}function f(){n.removeListener("open",e),n.removeListener("error",t),n.removeListener("close",s),i.removeListener("close",c),i.removeListener("upgrading",u)}Gf.priorWebsocketSuccess=!1,n.once("open",e),n.once("error",t),n.once("close",s),this.once("close",c),this.once("upgrading",u),n.open()},Gf.prototype.onOpen=function(){if(Wf("socket open"),this.readyState="open",Gf.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Wf("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Gf.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Wf('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else Wf('packet received with socket readyState "%s"',this.readyState)},Gf.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Gf.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},Gf.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){Wf("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},Gf.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},Gf.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emit("drain"):this.flush()},Gf.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Wf("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Gf.prototype.write=Gf.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},Gf.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var o={type:e,data:t,options:r};this.emit("packetCreate",o),this.writeBuffer.push(o),n&&this.once("flush",n),this.flush()}},Gf.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){(this.upgrading?n:t)()}):(this.upgrading?n:t)()}function t(){e.onClose("forced close"),Wf("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},Gf.prototype.onError=function(e){Wf("socket error %j",e),Gf.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Gf.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Wf('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},Gf.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~Uf(this.transports,e[r])&&t.push(e[r]);return t};var Jf=Vf,Yf=tf;Jf.parser=Yf;var Xf=function(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r};var Kf=function(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}};function $f(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=Qf.call(arguments,2);return function(){return t.apply(e,r.concat(Qf.call(arguments)))}}var Qf=[].slice,Zf=e(function(e,t){var o=vu("socket.io-client:socket");e.exports=r;var n={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},i=wu.prototype.emit;function r(e,t,r){this.io=e,this.nsp=t,(this.json=this).ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}wu(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[Kf(e,"open",$f(this,"onopen")),Kf(e,"packet",$f(this,"onpacket")),Kf(e,"close",$f(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},r.prototype.send=function(){var e=Xf(arguments);return e.unshift("message"),this.emit.apply(this,e),this},r.prototype.emit=function(e){if(n.hasOwnProperty(e))return i.apply(this,arguments),this;var t=Xf(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:Uu(t))?Du.BINARY_EVENT:Du.EVENT,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(o("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},r.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},r.prototype.onopen=function(){if(o("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?sf.encode(this.query):this.query;o("sending connect packet with query %s",e),this.packet({type:Du.CONNECT,query:e})}else this.packet({type:Du.CONNECT})},r.prototype.onclose=function(e){o("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},r.prototype.onpacket=function(e){var t=e.nsp===this.nsp,r=e.type===Du.ERROR&&"/"===e.nsp;if(t||r)switch(e.type){case Du.CONNECT:this.onconnect();break;case Du.EVENT:case Du.BINARY_EVENT:this.onevent(e);break;case Du.ACK:case Du.BINARY_ACK:this.onack(e);break;case Du.DISCONNECT:this.ondisconnect();break;case Du.ERROR:this.emit("error",e.data)}},r.prototype.onevent=function(e){var t=e.data||[];o("emitting event %j",t),null!=e.id&&(o("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?i.apply(this,t):this.receiveBuffer.push(t)},r.prototype.ack=function(t){var r=this,n=!1;return function(){if(!n){n=!0;var e=Xf(arguments);o("sending ack %j",e),r.packet({type:Uu(e)?Du.BINARY_ACK:Du.ACK,id:t,data:e})}}},r.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(o("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):o("bad ack %s",e.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)i.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){o("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(o("performing disconnect (%s)",this.nsp),this.packet({type:Du.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(e){return this.flags.compress=e,this},r.prototype.binary=function(e){return this.flags.binary=e,this}}),ep=tp;function tp(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}tp.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},tp.prototype.reset=function(){this.attempts=0},tp.prototype.setMin=function(e){this.ms=e},tp.prototype.setMax=function(e){this.max=e},tp.prototype.setJitter=function(e){this.jitter=e};var rp=vu("socket.io-client:manager"),np=Object.prototype.hasOwnProperty,op=ip;function ip(e,t){if(!(this instanceof ip))return new ip(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new ep({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||Du;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}ip.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)np.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},ip.prototype.updateSocketIds=function(){for(var e in this.nsps)np.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},ip.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},wu(ip.prototype),ip.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},ip.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},ip.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},ip.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},ip.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},ip.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},ip.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},ip.prototype.open=ip.prototype.connect=function(r,e){if(rp("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;rp("opening %s",this.uri),this.engine=Jf(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var o=Kf(t,"open",function(){n.onopen(),r&&r()}),i=Kf(t,"error",function(e){if(rp("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",e),r){var t=new Error("Connection error");t.data=e,r(t)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;rp("connect attempt will timeout after %d",a);var s=setTimeout(function(){rp("connect attempt timed out after %d",a),o.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(o),this.subs.push(i),this},ip.prototype.onopen=function(){rp("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(Kf(e,"data",$f(this,"ondata"))),this.subs.push(Kf(e,"ping",$f(this,"onping"))),this.subs.push(Kf(e,"pong",$f(this,"onpong"))),this.subs.push(Kf(e,"error",$f(this,"onerror"))),this.subs.push(Kf(e,"close",$f(this,"onclose"))),this.subs.push(Kf(this.decoder,"decoded",$f(this,"ondecoded")))},ip.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},ip.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},ip.prototype.ondata=function(e){this.decoder.add(e)},ip.prototype.ondecoded=function(e){this.emit("packet",e)},ip.prototype.onerror=function(e){rp("error",e),this.emitAll("error",e)},ip.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new Zf(this,e,t),this.nsps[e]=r;var n=this;r.on("connecting",o),r.on("connect",function(){r.id=n.generateId(e)}),this.autoConnect&&o()}function o(){~Uf(n.connecting,r)||n.connecting.push(r)}return r},ip.prototype.destroy=function(e){var t=Uf(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},ip.prototype.packet=function(r){rp("writing packet %j",r);var n=this;r.query&&0===r.type&&(r.nsp+="?"+r.query),n.encoding?n.packetBuffer.push(r):(n.encoding=!0,this.encoder.encode(r,function(e){for(var t=0;t<e.length;t++)n.engine.write(e[t],r.options);n.encoding=!1,n.processPacketQueue()}))},ip.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},ip.prototype.cleanup=function(){rp("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},ip.prototype.close=ip.prototype.disconnect=function(){rp("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},ip.prototype.onclose=function(e){rp("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},ip.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)rp("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();rp("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var r=setTimeout(function(){t.skipReconnect||(rp("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(rp("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(rp("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(r)}})}},ip.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var ap=e(function(e,t){var c=vu("socket.io-client");e.exports=t=r;var u=t.managers={};function r(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,n=bu(e),o=n.source,i=n.id,a=n.path,s=u[i]&&a in u[i].nsps;return r=t.forceNew||t["force new connection"]||!1===t.multiplex||s?(c("ignoring socket cache for %s",o),op(o,t)):(u[i]||(c("new io instance for %s",o),u[i]=op(o,t)),u[i]),n.query&&!t.query&&(t.query=n.query),r.socket(n.path,t)}t.protocol=Du.protocol,t.connect=r,t.Manager=op,t.Socket=Zf}),sp=(ap.managers,ap.protocol,ap.connect,ap.Manager,ap.Socket,Object.assign),cp=Object.defineProperty,up=!sp||m(function(){if(I&&1!==sp({b:1},sp(cp({},"a",{enumerable:!0,get:function(){cp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=sp({},e)[r]||dt(sp({},t)).join("")!=n})?function(e,t){for(var r=fe(e),n=arguments.length,o=1,i=Re.f,a=d.f;o<n;)for(var s,c=w(arguments[o++]),u=i?dt(c).concat(i(c)):dt(c),f=u.length,p=0;p<f;)s=u[p++],I&&!a.call(c,s)||(r[s]=c[s]);return r}:sp;ue({target:"Object",stat:!0,forced:Object.assign!==up},{assign:up});function fp(r,n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(n,e)}}function pp(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var lp=Object.prototype.toString;function hp(e){return"[object Array]"===lp.call(e)}function dp(e){return null!==e&&"object"==typeof e}function yp(e){return"[object Function]"===lp.call(e)}function mp(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),hp(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function gp(e,t,r,n,o){var i,a,s,c,u,f=new Error(e);return a=t,s=r,c=n,u=o,(i=f).config=a,s&&(i.code=s),i.request=c,i.response=u,i}var vp={isArray:hp,isArrayBuffer:function(e){return"[object ArrayBuffer]"===lp.call(e)},isBuffer:function(e){return null!=e&&(pp(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&pp(t.slice(0,0))||!!e._isBuffer);var t},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:dp,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===lp.call(e)},isFile:function(e){return"[object File]"===lp.call(e)},isBlob:function(e){return"[object Blob]"===lp.call(e)},isFunction:yp,isStream:function(e){return dp(e)&&yp(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:mp,merge:function r(){var n={};function e(e,t){"object"==typeof n[t]&&"object"==typeof e?n[t]=r(n[t],e):n[t]=e}for(var t=0,o=arguments.length;t<o;t++)mp(arguments[t],e);return n},extend:function(r,e,n){return mp(e,function(e,t){r[t]=n&&"function"==typeof e?fp(e,n):e}),r},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}};function _p(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var bp,wp,kp,xp=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Sp=vp.isStandardBrowserEnv()?(wp=/(msie|trident)/i.test(navigator.userAgent),kp=document.createElement("a"),bp=Cp(window.location.href),function(e){var t=vp.isString(e)?Cp(e):e;return t.protocol===bp.protocol&&t.host===bp.host}):function(){return!0};function Cp(e){var t=e;return wp&&(kp.setAttribute("href",t),t=kp.href),kp.setAttribute("href",t),{href:kp.href,protocol:kp.protocol?kp.protocol.replace(/:$/,""):"",host:kp.host,search:kp.search?kp.search.replace(/^\?/,""):"",hash:kp.hash?kp.hash.replace(/^#/,""):"",hostname:kp.hostname,port:kp.port,pathname:"/"===kp.pathname.charAt(0)?kp.pathname:"/"+kp.pathname}}function Tp(){this.message="String contains an invalid character"}(Tp.prototype=new Error).code=5,Tp.prototype.name="InvalidCharacterError";function Ep(e){for(var t,r,n=String(e),o="",i=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.charAt(0|i)||(a="=",i%1);o+=a.charAt(63&t>>8-i%1*8)){if(255<(r=n.charCodeAt(i+=.75)))throw new Tp;t=t<<8|r}return o}function Pp(y){return new Promise(function(p,l){var r=y.data,n=y.headers;vp.isFormData(r)&&delete n["Content-Type"];var h=new XMLHttpRequest,e="onreadystatechange",d=!1;if("test"===process.env.NODE_ENV||"undefined"==typeof window||!window.XDomainRequest||"withCredentials"in h||Sp(y.url)||(h=new window.XDomainRequest,e="onload",d=!0,h.onprogress=function(){},h.ontimeout=function(){}),y.auth){var t=y.auth.username||"",o=y.auth.password||"";n.Authorization="Basic "+Ap(t+":"+o)}if(h.open(y.method.toUpperCase(),function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(vp.isURLSearchParams(t))n=t.toString();else{var o=[];vp.forEach(t,function(e,t){null!=e&&(vp.isArray(e)?t+="[]":e=[e],vp.forEach(e,function(e){vp.isDate(e)?e=e.toISOString():vp.isObject(e)&&(e=JSON.stringify(e)),o.push(_p(t)+"="+_p(e))}))}),n=o.join("&")}return n&&(e+=(-1===e.indexOf("?")?"?":"&")+n),e}(y.url,y.params,y.paramsSerializer),!0),h.timeout=y.timeout,h[e]=function(){if(h&&(4===h.readyState||d)&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))){var e,t,r,n,o,i,a,s,c,u="getAllResponseHeaders"in h?(e=h.getAllResponseHeaders(),o={},e&&vp.forEach(e.split("\n"),function(e){if(n=e.indexOf(":"),t=vp.trim(e.substr(0,n)).toLowerCase(),r=vp.trim(e.substr(n+1)),t){if(o[t]&&0<=xp.indexOf(t))return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}}),o):null,f={data:y.responseType&&"text"!==y.responseType?h.response:h.responseText,status:1223===h.status?204:h.status,statusText:1223===h.status?"No Content":h.statusText,headers:u,config:y,request:h};i=p,a=l,c=(s=f).config.validateStatus,s.status&&c&&!c(s.status)?a(gp("Request failed with status code "+s.status,s.config,null,s.request,s)):i(s),h=null}},h.onerror=function(){l(gp("Network Error",y,null,h)),h=null},h.ontimeout=function(){l(gp("timeout of "+y.timeout+"ms exceeded",y,"ECONNABORTED",h)),h=null},vp.isStandardBrowserEnv()){var i=Rp,a=(y.withCredentials||Sp(y.url))&&y.xsrfCookieName?i.read(y.xsrfCookieName):void 0;a&&(n[y.xsrfHeaderName]=a)}if("setRequestHeader"in h&&vp.forEach(n,function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete n[t]:h.setRequestHeader(t,e)}),y.withCredentials&&(h.withCredentials=!0),y.responseType)try{h.responseType=y.responseType}catch(e){if("json"!==y.responseType)throw e}"function"==typeof y.onDownloadProgress&&h.addEventListener("progress",y.onDownloadProgress),"function"==typeof y.onUploadProgress&&h.upload&&h.upload.addEventListener("progress",y.onUploadProgress),y.cancelToken&&y.cancelToken.promise.then(function(e){h&&(h.abort(),l(e),h=null)}),void 0===r&&(r=null),h.send(r)})}var Rp=vp.isStandardBrowserEnv()?{write:function(e,t,r,n,o,i){var a=[];a.push(e+"="+encodeURIComponent(t)),vp.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),vp.isString(n)&&a.push("path="+n),vp.isString(o)&&a.push("domain="+o),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Ap="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||Ep,Op={"Content-Type":"application/x-www-form-urlencoded"};function Bp(e,t){!vp.isUndefined(e)&&vp.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Ip,Np={adapter:("undefined"!=typeof XMLHttpRequest?Ip=Pp:"undefined"!=typeof process&&(Ip=Pp),Ip),transformRequest:[function(e,t){var r,n;return r=t,n="Content-Type",vp.forEach(r,function(e,t){t!==n&&t.toUpperCase()===n.toUpperCase()&&(r[n]=e,delete r[t])}),vp.isFormData(e)||vp.isArrayBuffer(e)||vp.isBuffer(e)||vp.isStream(e)||vp.isFile(e)||vp.isBlob(e)?e:vp.isArrayBufferView(e)?e.buffer:vp.isURLSearchParams(e)?(Bp(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):vp.isObject(e)?(Bp(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&e<300}};Np.headers={common:{Accept:"application/json, text/plain, */*"}},vp.forEach(["delete","get","head"],function(e){Np.headers[e]={}}),vp.forEach(["post","put","patch"],function(e){Np.headers[e]=vp.merge(Op)});var Dp=Np;function Mp(){this.handlers=[]}Mp.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},Mp.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Mp.prototype.forEach=function(t){vp.forEach(this.handlers,function(e){null!==e&&t(e)})};function jp(t,r,e){return vp.forEach(e,function(e){t=e(t,r)}),t}function qp(e){return!(!e||!e.__CANCEL__)}var Fp=Mp;function Lp(e){e.cancelToken&&e.cancelToken.throwIfRequested()}function Up(t){var e,r,n;return Lp(t),t.baseURL&&(n=t.url,!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(n))&&(t.url=(e=t.baseURL,(r=t.url)?e.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):e)),t.headers=t.headers||{},t.data=jp(t.data,t.headers,t.transformRequest),t.headers=vp.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),vp.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||Dp.adapter)(t).then(function(e){return Lp(t),e.data=jp(e.data,e.headers,t.transformResponse),e},function(e){return qp(e)||(Lp(t),e&&e.response&&(e.response.data=jp(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}function zp(e){this.defaults=e,this.interceptors={request:new Fp,response:new Fp}}zp.prototype.request=function(e,t){"string"==typeof e&&(e=vp.merge({url:e},t)),(e=vp.merge(Dp,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var r=[Up,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){r.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){r.push(e.fulfilled,e.rejected)});r.length;)n=n.then(r.shift(),r.shift());return n},vp.forEach(["delete","get","head","options"],function(r){zp.prototype[r]=function(e,t){return this.request(vp.merge(t||{},{method:r,url:e}))}}),vp.forEach(["post","put","patch"],function(n){zp.prototype[n]=function(e,t,r){return this.request(vp.merge(r||{},{method:n,url:e,data:t}))}});var Hp=zp;function Wp(e){this.message=e}Wp.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Wp.prototype.__CANCEL__=!0;var Vp=Wp;function Gp(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var r=this;e(function(e){r.reason||(r.reason=new Vp(e),t(r.reason))})}Gp.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Gp.source=function(){var t;return{token:new Gp(function(e){t=e}),cancel:t}};var Jp=Gp;function Yp(e){var t=new Hp(e),r=fp(Hp.prototype.request,t);return vp.extend(r,Hp.prototype,t),vp.extend(r,t),r}var Xp=Yp(Dp);Xp.Axios=Hp,Xp.create=function(e){return Yp(vp.merge(Dp,e))},Xp.Cancel=Vp,Xp.CancelToken=Jp,Xp.isCancel=qp,Xp.all=function(e){return Promise.all(e)},Xp.spread=function(t){return function(e){return t.apply(null,e)}};var Kp=Xp,$p=Xp;Kp.default=$p;var Qp=Kp,Zp=null;"undefined"!=typeof WebSocket?Zp=WebSocket:"undefined"!=typeof MozWebSocket?Zp=MozWebSocket:void 0!==_?Zp=_.WebSocket||_.MozWebSocket:"undefined"!=typeof window?Zp=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(Zp=self.WebSocket||self.MozWebSocket);var el=Zp;function tl(e,t){return rl.apply(this,arguments)}function rl(){return(rl=rt(regeneratorRuntime.mark(function e(r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){return setTimeout(function(){if(n)return t(n);e()},r)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var nl="ws_connection_timeout",ol="rpc_timeout",il=function(){function t(e){nt(this,t),this.config=e}var e,r,n,o,i;return it(t,[{key:"getAuth",value:(i=rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{headers:this.config.auth&&this.config.auth.headers||{},args:this.config.auth&&this.config.auth.args||{}});case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"makeRPC",value:(o=rt(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw"Not implemented";case 1:case"end":return e.stop()}},e)})),function(e,t){return o.apply(this,arguments)})},{key:"start",value:(n=rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"stop",value:(r=rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"destroy",value:(e=rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})}]),t}(),al=function(){function r(e){var t;return nt(this,r),(t=ut(this,st(r).call(this,e))).config=e||{},t.endpoint=t.config.url||"http://localhost:20000/rpc",t}var n;return at(r,il),it(r,[{key:"makeRPC",value:(n=rt(regeneratorRuntime.mark(function e(t,r){var n,o,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAuth();case 2:return n=e.sent,o=Object.assign({"Content-Type":"application/json"},n.headers),r=Object.assign({},r,n.args),i={jsonrpc:"2.0",method:t,params:[r],id:"1"},e.next=8,Qp.request({url:this.endpoint,method:"post",headers:o,data:i});case 8:if(200!=(a=e.sent).status)throw"Request failed: ".concat(a.statusCode);e.next=11;break;case 11:if(a.data){e.next=13;break}throw"Empty server response";case 13:if(a.data.error)throw"Server error: ".concat(JSON.stringify(a.data.error));e.next=16;break;case 16:return e.abrupt("return",a.data.result);case 17:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})}]),r}(),sl=function(){function r(e){var t;return nt(this,r),(t=ut(this,st(r).call(this,e))).config=e||{},t.endpoint=t.config.url||"ws://localhost:20000/ws",t.queuedCalls=[],t.pendingCalls={},t.callID=0,t.errorCount={},t}var n,o,e,t;return at(r,il),it(r,[{key:"start",value:(t=rt(regeneratorRuntime.mark(function e(){var t,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Promise(function(e,t){r.client=new el(r.endpoint),r.client.onopen=function(){r.errorCount[nl]=0,r.dequeueCalls(),e()},r.client.onclose=function(){r.client=null},r.client.onerror=function(){r.client=null},r.client.onmessage=r.onResponse.bind(r)}),e.next=3,Promise.race([tl(3e4,{key:nl}),t]);case 3:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})},{key:"stop",value:function(){this.client&&(this.client.close(),this.client=null)}},{key:"destroy",value:function(){this.stop(),this.destroyed=!0}},{key:"onResponse",value:function(t){var e={};try{e=JSON.parse(t.data)}catch(e){o(t.data)}if(this.pendingCalls[e.id]){var r=ft(this.pendingCalls[e.id],2),n=r[0],o=r[1];e.error?o(e.error):n(e.result)}}},{key:"dequeueCalls",value:function(){var e=this.queuedCalls;this.queuedCalls=[];for(var t=0;t<e.length;t++){var r=e[t];this.makeRPC(r[0],r[1])}}},{key:"reconnect",value:(e=rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client){e.next=4;break}return bn.info("WebSocketProvider: reconnecting because the client was null!"),e.next=4,this.start();case 4:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"makeRPC",value:(o=rt(regeneratorRuntime.mark(function e(i,a){var s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var r=rt(regeneratorRuntime.mark(function e(t,r){var n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s.destroyed)return e.abrupt("return");e.next=3;break;case 3:return e.prev=3,e.next=6,s._RPC(i,a);case 6:return n=e.sent,s.errorCount["".concat(ol,":").concat(i)]=0,t(n),e.abrupt("return");case 12:if(e.prev=12,e.t0=e.catch(3),e.t0.key){e.next=17;break}return r(e.t0),e.abrupt("return");case 17:if(s.errorCount[e.t0.key]=(s.errorCount[e.t0.key]||0)+1,1==(o=s.errorCount[e.t0.key]))return e.abrupt("continue",0);e.next=21;break;case 21:if(o%30==5){try{s.client.close()}catch(e){}s.client=null}if(2==o||10==o||100==o)return r("Error  ".concat(e.t0.key," occurred ").concat(o," times in a row")),e.abrupt("return");e.next=25;break;case 25:return e.abrupt("return");case 26:e.next=0;break;case 28:case"end":return e.stop()}},e,null,[[3,12]])}));return function(e,t){return r.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)})),function(e,t){return o.apply(this,arguments)})},{key:"_RPC",value:(n=rt(regeneratorRuntime.mark(function e(a,s){var c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var r=rt(regeneratorRuntime.mark(function e(t,r){var n,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c.destroyed&&r(null),e.next=4,c.getAuth();case 4:if(n=e.sent,c.client){e.next=8;break}return e.next=8,c.reconnect();case 8:if(c.client&&c.client.readyState===el.OPEN){e.next=11;break}return c.queuedCalls.push([a,s]),e.abrupt("return");case 11:return o=new Promise(function(e,t){s=Object.assign({},s,n.args);var r={jsonrpc:"2.0",method:a,params:[s],id:c.callID++};c.pendingCalls[r.id]=[e,t],c.client.send(JSON.stringify(r))}),e.next=14,Promise.race([tl(12e4,{key:"".concat(ol,":").concat(a)}),o]);case 14:i=e.sent,t(i),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),r(e.t0);case 21:case"end":return e.stop()}},e,null,[[0,18]])}));return function(e,t){return r.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)})}]),r}(),cl={},ul="Server error",fl=function(){function t(e){nt(this,t),this.config=Object.assign({},cl,e),this.provider=this.config.provider,this.account=null,this.auth={}}var o,e,r,n,i,a,s,c,u;return it(t,[{key:"setContext",value:function(e){this.context=e}},{key:"setProvider",value:function(e){this.provider=e}},{key:"start",value:(u=rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._update_timer=setInterval(this._getAccount.bind(this),6e4),e.next=3,this._getAccount();case 3:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"stop",value:function(){clearInterval(this._update_timer),this.provider&&(this.provider.destroy(),this.provider=null)}},{key:"destroy",value:function(){this.stop(),this.context=null}},{key:"getAccount",value:(c=rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._getAccount());case 1:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"isReady",value:function(){return!!this.account}},{key:"_removeExpiredTokens",value:function(){for(var e in this.auth)this.auth[e].exp<=Math.floor(Date.now()/1e3)&&delete this.auth[e]}},{key:"addAuth",value:function(e,t,r){e&&(this._removeExpiredTokens(),(!this.auth[e]||this.auth[e].exp<t)&&(this.auth[e]={exp:t,token:r}))}},{key:"getAuth",value:function(e){return this._removeExpiredTokens(),this.auth[e]}},{key:"createInvoice",value:function(e,t){if(!this.account)return null;var r={resourceId:t,userId:this.account.user_id,partnerId:this.account.partner_id,address:this.account.recv_account.address,auth:this.getAuth(e),v:"2"};return bn.log("createInvoice(): remoteUserID: ".concat(e,", invoice: ").concat(JSON.stringify(r))),r}},{key:"_buildPaymentError",value:function(e,t){return{amount:new yc(0),accumulatedAmount:new yc(0),error:{code:e,msg:t}}}},{key:"createPayment",value:(s=rt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",this._buildPaymentError(4,"No invoice recevied"));case 2:if(this.account){e.next=4;break}return e.abrupt("return",this._buildPaymentError(3,"User not logged in"));case 4:return e.next=6,this.createPayment2(t);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"createPayment2",value:(a=rt(regeneratorRuntime.mark(function e(t){var r,n,o,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.resourceId,n=t.address,o=t.v,bn.log("createPayment2(): invoice: ".concat(JSON.stringify(t))),a=t.auth||this.getAuth(t.userId),e.prev=3,e.next=6,this._createPayment(n,r,t.v,a&&a.token);case 6:if((i=e.sent)&&i.tx){e.next=9;break}return e.abrupt("return",this._buildPaymentError(1,ul));case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(3),bn.log("createPayment2(): error: failed to create payment: ",e.t0),e.abrupt("return",this._buildPaymentError(1,ul+":"+JSON.stringify(e.t0)));case 15:return e.abrupt("return",{resourceId:r,sourceAddress:this.account.recv_account.address,sourceUserId:this.account.user_id,sourcePartnerId:this.account.partner_id,targetAddress:n,amount:new yc(i.amount||0),accumulatedAmount:new yc(i.tx.source.coins.tfuelwei),paymentHex:i.payment,reserveSequence:new yc(i.tx.reserve_sequence),paymentSequence:new yc(i.tx.payment_sequence),auth:this.getAuth(t.userId),v:o,error:null});case 16:case"end":return e.stop()}},e,this,[[3,11]])})),function(e){return a.apply(this,arguments)})},{key:"receivePayment",value:(i=rt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})},{key:"getTFuelBalance",value:function(){function e(e){return null!=e.coins?e.coins.tfuelwei:-1}return this.account?{sa:e(this.account.send_account),ra:e(this.account.recv_account)}:{sa:-1,ra:-1}}},{key:"_makeRPC",value:(n=rt(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.provider){e.next=2;break}throw"No provider is set.";case 2:return e.next=4,this.config.provider.makeRPC(t,r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"_RPC",value:(r=rt(regeneratorRuntime.mark(function e(t,r){var n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._makeRPC(t,r);case 3:return n=e.sent,this.context&&(this.context.playerStats.walletRPCSucceeded("".concat(t,":ok")),"theta.ReserveFund"==t?this.context.playerStats.walletReserveSucceeded():"theta.SubmitServicePayment"==t&&this.context.playerStats.walletSubmitPaymentSucceeded()),e.abrupt("return",n);case 8:throw e.prev=8,e.t0=e.catch(0),this.context&&(o=e.t0.message||"unknown_error",this.context.playerStats.walletRPCFailed("".concat(t,":").concat(o)),"theta.ReserveFund"==t?this.context.playerStats.walletReserveFailed():"theta.SubmitServicePayment"==t&&this.context.playerStats.walletSubmitPaymentFailed()),bn.error("_RPC(): ".concat(JSON.stringify(e.t0))),e.t0;case 13:case"end":return e.stop()}},e,this,[[0,8]])})),function(e,t){return r.apply(this,arguments)})},{key:"_getAccount",value:(e=rt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._RPC("theta.GetAccount");case 2:return t=e.sent,this.account=t,this.context&&this.context.trigger(lc.ACCOUNT_UPDATED,{account:t}),e.abrupt("return",this.account);case 6:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_createPayment",value:(o=rt(regeneratorRuntime.mark(function e(t,r,n,o){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._RPC("theta.CreateServicePayment",{to:t,resource_id:r,v:n,auth:o});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,r,n){return o.apply(this,arguments)})}]),t}();return function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};nt(this,a);var t=a.DefaultConfig;for(var r in t)r in e||(e[r]=t[r]);!0===e.debug&&a.setDebug(!0);var n=((this.config=e).trackerServer.secure?"https://":"http://")+e.trackerServer.host+":"+e.trackerServer.port+e.trackerServer.path;this.socket=ap(n),this.cache=new wn,this.cache.start(),this.p2p=new gc({context:this,userId:e.userId,videoId:e.videoId,probeTimeout:e.probeTimeout,fragmentTimeout:Math.floor(e.fragmentSize*e.failoverFactor),allowRangeRequests:e.allowRangeRequests,server:{host:e.peerServer.host,port:e.peerServer.port,secure:e.peerServer.secure}}),this.p2p.start();var o=null;if(!e.wallet){var i=new(function(){function e(){return nt(this,e),ut(this,st(e).apply(this,arguments))}var t;return at(e,a.WalletWebSocketProvider),it(e,[{key:"getAuth",value:(t=rt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})}]),e}());o=new a.Wallet({provider:i})}this.wallet=e.wallet||o,this.wallet.setContext(this),this.playerStats=new uu(this,e.videoId),this.playerStats.setFragmentSize(e.fragmentSize),this.playerStats.start(),this.eventHandlers_={},this.widgetConnected=!1}return it(a,null,[{key:"registerPlugin",value:function(e,t){a.plugins_||(a.plugins_={}),a.plugins_[e]=t}},{key:"getPlugin",value:function(e){if(e)return a.plugins_&&a.plugins_[e]?a.plugins_[e]:void 0}},{key:"getLogger",value:function(){return bn}},{key:"setDebug",value:function(e){bn.setLoggingEnabled(e)}},{key:"toggleUseCDN",value:function(){a.HlsJsFragmentLoader.toggleUseCDN(),a.P2P.toggleUseCDN()}},{key:"Events",get:function(){return lc}},{key:"TrafficType",get:function(){return pc}},{key:"Wallet",get:function(){return fl}},{key:"WalletWebSocketProvider",get:function(){return sl}},{key:"HTTPProvider",get:function(){return al}},{key:"HlsJsFragmentLoader",get:function(){return a.getPlugin("hlsjs")}},{key:"P2P",get:function(){return gc}},{key:"DefaultConfig",get:function(){return fu}},{key:"isPeeringEnabled",get:function(){return a.P2P.isPeeringEnabled},set:function(e){a.HlsJsFragmentLoader.isPeeringEnabled=e,a.P2P.isPeeringEnabled=e}}]),it(a,[{key:"start",value:function(){}},{key:"addEventListener",value:function(e,t){this.eventHandlers_.hasOwnProperty(e)?this.eventHandlers_[e].push(t):this.eventHandlers_[e]=[t]}},{key:"removeEventListener",value:function(e,t){if(this.eventHandlers_.hasOwnProperty(e)){var r=this.eventHandlers_[e].indexOf(t);-1!==r&&this.eventHandlers_[e].splice(r,1)}}},{key:"trigger",value:function(e,t){if(bn.log("Trigger Event.name:",e),this.eventHandlers_.hasOwnProperty(e)){for(var r=this.eventHandlers_[e],n=r.length,o=0;o<n;o++){(0,r[o])(t)}if(this.widgetConnected)for(var i=[window.parent,window],a=0;a<i.length;a++){var s=i[a];s&&s.postMessage({event:e,data:t},"*")}}}},{key:"connectWidget",value:function(){this.widgetConnected=!0}},{key:"disconnectWidget",value:function(){this.widgetConnected=!1}},{key:"destroy",value:function(){this.socket&&(this.socket.close(),this.socket=null),this.cache&&(this.cache.destroy(),this.cache=null),this.playerStats&&(this.playerStats.destroy(),this.playerStats=null),this.p2p&&(this.p2p.destroy(),this.p2p=null),this.wallet&&(this.wallet.destroy(),this.wallet=null),this.config=null,this.eventHandlers_=null}}]),a}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Theta=t()});
